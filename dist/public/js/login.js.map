{"version":3,"sources":["../../../public/js/login.js"],"names":["VM","Vue","el","data","name","phone","inputType","password","passwordConfirm","eyeText","remember","validateCode","now_date","Date","methods","init","validate","page_type","getCookieParams","_this","$http","get","then","GeeTest","res","body","initGeetest","gt","challenge","offline","success","new_captcha","lang","product","width","captchaObj","appendTo","onSuccess","result","getValidate","geetest_validate","onError","showpassword","e","blur","alert","submitForm","type","post","console","log","code","ok","window","location","redirect","getQueryString","form","alertSuccess","alertError","msg","thirdPartyLogin","a","document","createElement","style","display","$refs","loginLinkBox","appendChild","setAttribute","getTime","click","reg","RegExp","r","search","substr","match","unescape","alertMessage","$message","showClose","message","alertWarning","key","cookieValues","cookie","decodeURIComponent"],"mappings":"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","file":"login.js","sourcesContent":["const VM = new Vue({\n    el:'#app-login',\n    data:{\n        name: '',\n        phone: '',\n        inputType: 'password',\n        password: '',\n        passwordConfirm: '',\n        eyeText : '&#xe61e;',\n        remember: false,\n        validateCode: '',\n        now_date: new Date()\n    },\n    methods:{\n        init:function(){\n            this.validate();\n            if(page_type == 'login'){\n                this.name = this.getCookieParams('name');\n                this.password = this.getCookieParams('password');\n            }\n        },\n        validate:function(){\n            const _this = this;\n            this.$http.get('/api/gettest').then(res=>{\n                // console.log(res);\n                let GeeTest = res.body;\n                initGeetest({\n                    gt: GeeTest.gt,\n                    challenge: GeeTest.challenge,\n                    offline: GeeTest.success,\n                    new_captcha: GeeTest.new_captcha,\n                    lang:'zh-cn',\n                    product: 'popup',\n                    width:'100%'\n                },captchaObj=>{\n                    // console.log(captchaObj);\n                    captchaObj.appendTo('#captcha-block');\n                    captchaObj.onSuccess(()=>{\n                        let result = captchaObj.getValidate();\n                        _this.validateCode = result.geetest_validate;\n                    });\n                    captchaObj.onError(()=>{\n\n                    });\n                });\n            });\n        },\n        showpassword:function(e){\n            if(this.eyeText == '&#xe61e;'){\n                this.eyeText = '&#xe629;';\n                this.inputType = 'text';\n            }else{\n                this.eyeText = '&#xe61e;';\n                this.inputType = 'password';\n            }\n        },\n        blur:function(e){\n            if(this.passwordConfirm != this.password){\n                alert('两次输入密码不同');\n                return false;\n            }\n        },\n        submitForm:function(e,type){\n            if(type == 'signup'){ //signup\n                this.$http.post('/api/signup',{name:this.name,phone:this.phone,password:this.password,passwordConfirm:this.passwordConfirm}).then((res)=>{\n                    if(!res) throw console.log(res);\n                    if(res.body.code == 0 && res.body.ok == false){\n                        window.location = '/register';\n                    }else{\n                        window.location = '/login';\n                    }\n                });\n            }else{ // signin\n                let redirect = this.getQueryString('redirect_uri');\n                this.$http.post('/api/signin',{name:this.name,password:this.password,validateCode:this.validateCode,form:'login',remember:this.remember,redirect:(redirect ? redirect : '')}).then((res)=>{\n                    if(!res) throw console.log(res);\n                    if(res.body.code == 1){             // 登录成功\n                        this.alertSuccess('登录成功，正在跳转');\n                        if(redirect){\n                            window.location = redirect;\n                        }else{\n                            window.location = '/';\n                        }\n                    }else if(res.body.code == 2){       // 未注册\n                        this.alertError(res.body.msg);\n                        window.location = '/register';\n                    }else{                              // 登录失败，显示各种错误信息\n                        this.alertError(res.body.msg);\n                    }\n                });\n            }\n        },\n        thirdPartyLogin:function(e, type){\n            let a = document.createElement('a');\n            a.style.display = 'none';\n            // a.target = '_blank';\n            this.$refs.loginLinkBox.appendChild(a);\n            a.setAttribute('href','https://github.com/login/oauth/authorize?client_id=5fe59ee126edbea8f3df&state='+this.now_date.getTime()+'&redirect_uri=https://blog.mcloudhub.com/api/github');\n            a.click();\n            // a.parentNode.removeChild(a);\n        },\n        getQueryString:function (name) {\n            let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\",\"i\");\n            let r = window.location.search.substr(1).match(reg);\n            return r!=null ? unescape(r[2]): null;\n        },\n        alertMessage(msg) {\n            this.$message({\n                showClose: true,\n                message: msg\n            });\n        },\n        alertSuccess(msg) {\n            this.$message({\n                showClose: true,\n                message: msg,\n                type: 'success'\n            });\n        },\n        alertWarning(msg) {\n            this.$message({\n                showClose: true,\n                message: msg,\n                type: 'warning'\n            });\n        },\n        alertError(msg) {\n            this.$message({\n                showClose: true,\n                message: msg,\n                type: 'error'\n            });\n        },\n        getCookieParams:function (key) {    // 通过正则匹配获取cookie中保存值\n            var reg = new RegExp(\"(^|;) ?\"+key+\"=([^;]*)(;|$)\",\"i\");\n            var cookieValues = document.cookie.match(reg);\n            return cookieValues ? decodeURIComponent(cookieValues[2]) : null;\n        }\n    }\n});\nVM.init();"]}