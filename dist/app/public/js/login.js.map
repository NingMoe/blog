{"version":3,"sources":["../../../../app/public/js/login.js"],"names":["VM","Vue","el","data","name","phone","inputType","password","passwordConfirm","eyeText","remember","validateCode","now_date","Date","methods","init","validate","page_type","getCookieParams","_this","$http","get","then","GeeTest","res","body","initGeetest","gt","challenge","offline","success","new_captcha","lang","product","width","captchaObj","appendTo","onSuccess","result","getValidate","geetest_validate","onError","showpassword","e","blur","alert","submitForm","type","post","console","log","code","ok","window","location","redirect","getQueryString","form","alertSuccess","alertError","msg","thirdPartyLogin","a","document","createElement","style","display","$refs","loginLinkBox","appendChild","setAttribute","getTime","click","reg","RegExp","r","search","substr","match","unescape","alertMessage","$message","showClose","message","alertWarning","key","cookieValues","cookie","decodeURIComponent"],"mappings":"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","file":"login.js","sourcesContent":["const VM = new Vue({\n    el: '#app-login',\n    data: {\n        name: '',\n        phone: '',\n        inputType: 'password',\n        password: '',\n        passwordConfirm: '',\n        eyeText: '&#xe61e;',\n        remember: false,\n        validateCode: '',\n        now_date: new Date()\n    },\n    methods: {\n        init: function() {\n            this.validate();\n            if (page_type == 'login') {\n                this.name = this.getCookieParams('name');\n                this.password = this.getCookieParams('password');\n            }\n        },\n        validate: function() {\n            const _this = this;\n            this.$http.get('/api/gettest').then(res => {\n                // console.log(res);\n                let GeeTest = res.body;\n                initGeetest({\n                    gt: GeeTest.gt,\n                    challenge: GeeTest.challenge,\n                    offline: GeeTest.success,\n                    new_captcha: GeeTest.new_captcha,\n                    lang: 'zh-cn',\n                    product: 'popup',\n                    width: '100%'\n                }, captchaObj => {\n                    // console.log(captchaObj);\n                    captchaObj.appendTo('#captcha-block');\n                    captchaObj.onSuccess(() => {\n                        let result = captchaObj.getValidate();\n                        _this.validateCode = result.geetest_validate;\n                    });\n                    captchaObj.onError(() => {\n\n                    });\n                });\n            });\n        },\n        showpassword: function(e) {\n            if (this.eyeText == '&#xe61e;') {\n                this.eyeText = '&#xe629;';\n                this.inputType = 'text';\n            } else {\n                this.eyeText = '&#xe61e;';\n                this.inputType = 'password';\n            }\n        },\n        blur: function(e) {\n            if (this.passwordConfirm != this.password) {\n                alert('两次输入密码不同');\n                return false;\n            }\n        },\n        submitForm: function(e, type) {\n            if (type == 'signup') { //signup\n                this.$http.post('/api/signup', { name: this.name, phone: this.phone, password: this.password, passwordConfirm: this.passwordConfirm }).then((res) => {\n                    if (!res) throw console.log(res);\n                    if (res.body.code == 0 && res.body.ok == false) {\n                        window.location = '/register';\n                    } else {\n                        window.location = '/login';\n                    }\n                });\n            } else { // signin\n                let redirect = this.getQueryString('redirect_uri');\n                this.$http.post('/api/signin', { name: this.name, password: this.password, validateCode: this.validateCode, form: 'login', remember: this.remember, redirect: (redirect ? redirect : '') }).then((res) => {\n                    if (!res) throw console.log(res);\n                    if (res.body.code == 1) { // 登录成功\n                        this.alertSuccess('登录成功，正在跳转');\n                        if (redirect) {\n                            window.location = redirect;\n                        } else {\n                            window.location = '/';\n                        }\n                    } else if (res.body.code == 2) { // 未注册\n                        this.alertError(res.body.msg);\n                        window.location = '/register';\n                    } else { // 登录失败，显示各种错误信息\n                        this.alertError(res.body.msg);\n                    }\n                });\n            }\n        },\n        thirdPartyLogin: function(e, type) {\n            let a = document.createElement('a');\n            a.style.display = 'none';\n            // a.target = '_blank';\n            this.$refs.loginLinkBox.appendChild(a);\n            a.setAttribute('href', 'https://github.com/login/oauth/authorize?client_id=5fe59ee126edbea8f3df&state=' + this.now_date.getTime() + '&redirect_uri=https://blog.mcloudhub.com/api/github');\n            a.click();\n            // a.parentNode.removeChild(a);\n        },\n        getQueryString: function(name) {\n            let reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n            let r = window.location.search.substr(1).match(reg);\n            return r != null ? unescape(r[2]) : null;\n        },\n        alertMessage(msg) {\n            this.$message({\n                showClose: true,\n                message: msg\n            });\n        },\n        alertSuccess(msg) {\n            this.$message({\n                showClose: true,\n                message: msg,\n                type: 'success'\n            });\n        },\n        alertWarning(msg) {\n            this.$message({\n                showClose: true,\n                message: msg,\n                type: 'warning'\n            });\n        },\n        alertError(msg) {\n            this.$message({\n                showClose: true,\n                message: msg,\n                type: 'error'\n            });\n        },\n        getCookieParams: function(key) { // 通过正则匹配获取cookie中保存值\n            var reg = new RegExp(\"(^|;) ?\" + key + \"=([^;]*)(;|$)\", \"i\");\n            var cookieValues = document.cookie.match(reg);\n            return cookieValues ? decodeURIComponent(cookieValues[2]) : null;\n        }\n    }\n});\nVM.init();\n"]}