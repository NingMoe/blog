{"version":3,"sources":["../../../../../../../../../app/public/js/marked/lib/codemirror/addon/fold/xml-fold.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","Pos","cmp","a","b","line","ch","nameStartChar","nameChar","xmlTagStart","RegExp","Iter","cm","range","text","getLine","min","from","firstLine","max","to","lastLine","tagAt","iter","type","getTokenTypeAt","test","nextLine","prevLine","length","toTagEnd","gt","indexOf","lastSlash","lastIndexOf","selfClose","slice","toTagStart","lt","lastIndex","match","exec","index","toNextTag","found","toPrevTag","findMatchingClose","tag","stack","next","end","startLine","startCh","i","push","findMatchingOpen","prev","endLine","endCh","start","registerHelper","openTag","close","findMatchingTag","pos","here","open","at","findEnclosingTag","forward","scanForClosingTag","name"],"mappings":"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","file":"xml-fold.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  var Pos = CodeMirror.Pos;\n  function cmp(a, b) { return a.line - b.line || a.ch - b.ch; }\n\n  var nameStartChar = \"A-Z_a-z\\\\u00C0-\\\\u00D6\\\\u00D8-\\\\u00F6\\\\u00F8-\\\\u02FF\\\\u0370-\\\\u037D\\\\u037F-\\\\u1FFF\\\\u200C-\\\\u200D\\\\u2070-\\\\u218F\\\\u2C00-\\\\u2FEF\\\\u3001-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFFD\";\n  var nameChar = nameStartChar + \"\\-\\:\\.0-9\\\\u00B7\\\\u0300-\\\\u036F\\\\u203F-\\\\u2040\";\n  var xmlTagStart = new RegExp(\"<(/?)([\" + nameStartChar + \"][\" + nameChar + \"]*)\", \"g\");\n\n  function Iter(cm, line, ch, range) {\n    this.line = line; this.ch = ch;\n    this.cm = cm; this.text = cm.getLine(line);\n    this.min = range ? range.from : cm.firstLine();\n    this.max = range ? range.to - 1 : cm.lastLine();\n  }\n\n  function tagAt(iter, ch) {\n    var type = iter.cm.getTokenTypeAt(Pos(iter.line, ch));\n    return type && /\\btag\\b/.test(type);\n  }\n\n  function nextLine(iter) {\n    if (iter.line >= iter.max) return;\n    iter.ch = 0;\n    iter.text = iter.cm.getLine(++iter.line);\n    return true;\n  }\n  function prevLine(iter) {\n    if (iter.line <= iter.min) return;\n    iter.text = iter.cm.getLine(--iter.line);\n    iter.ch = iter.text.length;\n    return true;\n  }\n\n  function toTagEnd(iter) {\n    for (;;) {\n      var gt = iter.text.indexOf(\">\", iter.ch);\n      if (gt == -1) { if (nextLine(iter)) continue; else return; }\n      if (!tagAt(iter, gt + 1)) { iter.ch = gt + 1; continue; }\n      var lastSlash = iter.text.lastIndexOf(\"/\", gt);\n      var selfClose = lastSlash > -1 && !/\\S/.test(iter.text.slice(lastSlash + 1, gt));\n      iter.ch = gt + 1;\n      return selfClose ? \"selfClose\" : \"regular\";\n    }\n  }\n  function toTagStart(iter) {\n    for (;;) {\n      var lt = iter.ch ? iter.text.lastIndexOf(\"<\", iter.ch - 1) : -1;\n      if (lt == -1) { if (prevLine(iter)) continue; else return; }\n      if (!tagAt(iter, lt + 1)) { iter.ch = lt; continue; }\n      xmlTagStart.lastIndex = lt;\n      iter.ch = lt;\n      var match = xmlTagStart.exec(iter.text);\n      if (match && match.index == lt) return match;\n    }\n  }\n\n  function toNextTag(iter) {\n    for (;;) {\n      xmlTagStart.lastIndex = iter.ch;\n      var found = xmlTagStart.exec(iter.text);\n      if (!found) { if (nextLine(iter)) continue; else return; }\n      if (!tagAt(iter, found.index + 1)) { iter.ch = found.index + 1; continue; }\n      iter.ch = found.index + found[0].length;\n      return found;\n    }\n  }\n  function toPrevTag(iter) {\n    for (;;) {\n      var gt = iter.ch ? iter.text.lastIndexOf(\">\", iter.ch - 1) : -1;\n      if (gt == -1) { if (prevLine(iter)) continue; else return; }\n      if (!tagAt(iter, gt + 1)) { iter.ch = gt; continue; }\n      var lastSlash = iter.text.lastIndexOf(\"/\", gt);\n      var selfClose = lastSlash > -1 && !/\\S/.test(iter.text.slice(lastSlash + 1, gt));\n      iter.ch = gt + 1;\n      return selfClose ? \"selfClose\" : \"regular\";\n    }\n  }\n\n  function findMatchingClose(iter, tag) {\n    var stack = [];\n    for (;;) {\n      var next = toNextTag(iter), end, startLine = iter.line, startCh = iter.ch - (next ? next[0].length : 0);\n      if (!next || !(end = toTagEnd(iter))) return;\n      if (end == \"selfClose\") continue;\n      if (next[1]) { // closing tag\n        for (var i = stack.length - 1; i >= 0; --i) if (stack[i] == next[2]) {\n          stack.length = i;\n          break;\n        }\n        if (i < 0 && (!tag || tag == next[2])) return {\n          tag: next[2],\n          from: Pos(startLine, startCh),\n          to: Pos(iter.line, iter.ch)\n        };\n      } else { // opening tag\n        stack.push(next[2]);\n      }\n    }\n  }\n  function findMatchingOpen(iter, tag) {\n    var stack = [];\n    for (;;) {\n      var prev = toPrevTag(iter);\n      if (!prev) return;\n      if (prev == \"selfClose\") { toTagStart(iter); continue; }\n      var endLine = iter.line, endCh = iter.ch;\n      var start = toTagStart(iter);\n      if (!start) return;\n      if (start[1]) { // closing tag\n        stack.push(start[2]);\n      } else { // opening tag\n        for (var i = stack.length - 1; i >= 0; --i) if (stack[i] == start[2]) {\n          stack.length = i;\n          break;\n        }\n        if (i < 0 && (!tag || tag == start[2])) return {\n          tag: start[2],\n          from: Pos(iter.line, iter.ch),\n          to: Pos(endLine, endCh)\n        };\n      }\n    }\n  }\n\n  CodeMirror.registerHelper(\"fold\", \"xml\", function(cm, start) {\n    var iter = new Iter(cm, start.line, 0);\n    for (;;) {\n      var openTag = toNextTag(iter), end;\n      if (!openTag || iter.line != start.line || !(end = toTagEnd(iter))) return;\n      if (!openTag[1] && end != \"selfClose\") {\n        var start = Pos(iter.line, iter.ch);\n        var close = findMatchingClose(iter, openTag[2]);\n        return close && {from: start, to: close.from};\n      }\n    }\n  });\n  CodeMirror.findMatchingTag = function(cm, pos, range) {\n    var iter = new Iter(cm, pos.line, pos.ch, range);\n    if (iter.text.indexOf(\">\") == -1 && iter.text.indexOf(\"<\") == -1) return;\n    var end = toTagEnd(iter), to = end && Pos(iter.line, iter.ch);\n    var start = end && toTagStart(iter);\n    if (!end || !start || cmp(iter, pos) > 0) return;\n    var here = {from: Pos(iter.line, iter.ch), to: to, tag: start[2]};\n    if (end == \"selfClose\") return {open: here, close: null, at: \"open\"};\n\n    if (start[1]) { // closing tag\n      return {open: findMatchingOpen(iter, start[2]), close: here, at: \"close\"};\n    } else { // opening tag\n      iter = new Iter(cm, to.line, to.ch, range);\n      return {open: here, close: findMatchingClose(iter, start[2]), at: \"open\"};\n    }\n  };\n\n  CodeMirror.findEnclosingTag = function(cm, pos, range) {\n    var iter = new Iter(cm, pos.line, pos.ch, range);\n    for (;;) {\n      var open = findMatchingOpen(iter);\n      if (!open) break;\n      var forward = new Iter(cm, pos.line, pos.ch, range);\n      var close = findMatchingClose(forward, open.tag);\n      if (close) return {open: open, close: close};\n    }\n  };\n\n  // Used by addon/edit/closetag.js\n  CodeMirror.scanForClosingTag = function(cm, pos, name, end) {\n    var iter = new Iter(cm, pos.line, pos.ch, end ? {from: 0, to: end} : null);\n    return findMatchingClose(iter, name);\n  };\n});\n"]}