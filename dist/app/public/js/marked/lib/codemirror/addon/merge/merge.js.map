{"version":3,"sources":["../../../../../../../../../app/public/js/marked/lib/codemirror/addon/merge/merge.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","diff_match_patch","Pos","svgNS","DiffView","mv","type","classes","chunk","start","end","insert","del","connect","prototype","constructor","init","pane","orig","options","edit","copyObj","value","readOnly","allowEditingOriginals","diff","getDiff","asString","chunks","getChunks","diffOutOfDate","dealigned","showDifferences","forceUpdate","registerUpdate","setScrollLock","registerScroll","setShowDifferences","val","ensureDiff","dv","getValue","signal","updating","from","to","marked","debounceChange","updatingFast","update","mode","svg","clear","copyButtons","clearMarks","updateMarks","DIFF_INSERT","DIFF_DELETE","makeConnections","alignChunks","setDealign","fast","set","clearTimeout","setTimeout","change","_cm","text","length","line","on","syncScroll","lockScroll","editor","other","now","Date","state","scrollSetBy","scrollSetAt","sInfo","getScrollInfo","targetPos","top","halfScreen","clientHeight","midY","mid","lineAtHeight","around","chunkBoundariesAround","off","getOffsets","offOther","ratio","bot","botDist","mix","height","otherInfo","botDistOther","scrollTo","left","after","lastLine","heightAtLine","before","action","lockButton","innerHTML","arr","i","mark","TextMarker","parent","removeLineClass","vp","getViewport","operation","markChanges","marks","pos","clipPos","cls","markChunk","bfrom","Math","max","bto","min","addLineClass","push","chunkStart","part","tp","str","DIFF_EQUAL","cleanFrom","startOfLineClean","moveOver","cleanTo","endOfLineClean","a","posMax","b","posMin","posEq","markText","className","w","gap","offsetWidth","attrs","offsetHeight","vpEdit","vpOrig","sTopEdit","sTopOrig","ch","editFrom","editTo","origFrom","origTo","drawConnectorsForChunk","getMatchingOrigLine","editLine","editStart","origStart","findAlignedLines","linesToAlign","j","align","splice","force","curOp","right","aligners","cm","scroll","ln","alignLines","lines","maxOffset","offset","padAbove","size","above","elt","document","createElement","style","minWidth","addLineWidget","flip","topLpx","topRpx","tmp","botLpx","botRpx","curveTop","curveBot","appendChild","createElementNS","copy","editOriginals","title","topReverse","copyReverse","copyChunk","replaceRange","getRange","MergeView","node","origLeft","origRight","hasLeft","hasRight","panes","wrap","self","leftPane","buildGap","editPane","rightPane","wrapElt","collapseIdentical","collapseIdenticalStretches","onResize","window","resizeInterval","setInterval","p","parentNode","body","clearInterval","lock","lockWrap","gapElts","revertButtons","e","target","srcElement","unshift","createSVGRect","constuctor","rightOriginal","leftOriginal","rightChunks","leftChunks","obj","dmp","diff_main","diff_cleanupSemantic","startEdit","startOrig","startOff","cleanFromEdit","cleanFromOrig","endOff","cleanToEdit","cleanToOrig","next","charCodeAt","last","n","nInEdit","beforeE","afterE","beforeO","afterO","fromLocal","toLocal","collapseSingle","widget","inclusiveLeft","inclusiveRight","replacedWith","clearOnEnter","addEventListener","collapseStretch","editors","unclearNearChunks","margin","l","firstLine","onCollapse","tag","content","cssText","createTextNode","count","childNodes","removeChild","firstChild","arguments","setAttribute","prop","hasOwnProperty","out","at","nl","indexOf"],"mappings":"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","file":"merge.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n// declare global: diff_match_patch, DIFF_INSERT, DIFF_DELETE, DIFF_EQUAL\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"diff_match_patch\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"diff_match_patch\"], mod);\n  else // Plain browser env\n    mod(CodeMirror, diff_match_patch);\n})(function(CodeMirror, diff_match_patch) {\n  \"use strict\";\n  var Pos = CodeMirror.Pos;\n  var svgNS = \"http://www.w3.org/2000/svg\";\n\n  function DiffView(mv, type) {\n    this.mv = mv;\n    this.type = type;\n    this.classes = type == \"left\"\n      ? {chunk: \"CodeMirror-merge-l-chunk\",\n         start: \"CodeMirror-merge-l-chunk-start\",\n         end: \"CodeMirror-merge-l-chunk-end\",\n         insert: \"CodeMirror-merge-l-inserted\",\n         del: \"CodeMirror-merge-l-deleted\",\n         connect: \"CodeMirror-merge-l-connect\"}\n      : {chunk: \"CodeMirror-merge-r-chunk\",\n         start: \"CodeMirror-merge-r-chunk-start\",\n         end: \"CodeMirror-merge-r-chunk-end\",\n         insert: \"CodeMirror-merge-r-inserted\",\n         del: \"CodeMirror-merge-r-deleted\",\n         connect: \"CodeMirror-merge-r-connect\"};\n  }\n\n  DiffView.prototype = {\n    constructor: DiffView,\n    init: function(pane, orig, options) {\n      this.edit = this.mv.edit;\n      this.orig = CodeMirror(pane, copyObj({value: orig, readOnly: !this.mv.options.allowEditingOriginals}, copyObj(options)));\n\n      this.diff = getDiff(asString(orig), asString(options.value));\n      this.chunks = getChunks(this.diff);\n      this.diffOutOfDate = this.dealigned = false;\n\n      this.showDifferences = options.showDifferences !== false;\n      this.forceUpdate = registerUpdate(this);\n      setScrollLock(this, true, false);\n      registerScroll(this);\n    },\n    setShowDifferences: function(val) {\n      val = val !== false;\n      if (val != this.showDifferences) {\n        this.showDifferences = val;\n        this.forceUpdate(\"full\");\n      }\n    }\n  };\n\n  function ensureDiff(dv) {\n    if (dv.diffOutOfDate) {\n      dv.diff = getDiff(dv.orig.getValue(), dv.edit.getValue());\n      dv.chunks = getChunks(dv.diff);\n      dv.diffOutOfDate = false;\n      CodeMirror.signal(dv.edit, \"updateDiff\", dv.diff);\n    }\n  }\n\n  var updating = false;\n  function registerUpdate(dv) {\n    var edit = {from: 0, to: 0, marked: []};\n    var orig = {from: 0, to: 0, marked: []};\n    var debounceChange, updatingFast = false;\n    function update(mode) {\n      updating = true;\n      updatingFast = false;\n      if (mode == \"full\") {\n        if (dv.svg) clear(dv.svg);\n        if (dv.copyButtons) clear(dv.copyButtons);\n        clearMarks(dv.edit, edit.marked, dv.classes);\n        clearMarks(dv.orig, orig.marked, dv.classes);\n        edit.from = edit.to = orig.from = orig.to = 0;\n      }\n      ensureDiff(dv);\n      if (dv.showDifferences) {\n        updateMarks(dv.edit, dv.diff, edit, DIFF_INSERT, dv.classes);\n        updateMarks(dv.orig, dv.diff, orig, DIFF_DELETE, dv.classes);\n      }\n      makeConnections(dv);\n\n      if (dv.mv.options.connect == \"align\")\n        alignChunks(dv);\n      updating = false;\n    }\n    function setDealign(fast) {\n      if (updating) return;\n      dv.dealigned = true;\n      set(fast);\n    }\n    function set(fast) {\n      if (updating || updatingFast) return;\n      clearTimeout(debounceChange);\n      if (fast === true) updatingFast = true;\n      debounceChange = setTimeout(update, fast === true ? 20 : 250);\n    }\n    function change(_cm, change) {\n      if (!dv.diffOutOfDate) {\n        dv.diffOutOfDate = true;\n        edit.from = edit.to = orig.from = orig.to = 0;\n      }\n      // Update faster when a line was added/removed\n      setDealign(change.text.length - 1 != change.to.line - change.from.line);\n    }\n    dv.edit.on(\"change\", change);\n    dv.orig.on(\"change\", change);\n    dv.edit.on(\"markerAdded\", setDealign);\n    dv.edit.on(\"markerCleared\", setDealign);\n    dv.orig.on(\"markerAdded\", setDealign);\n    dv.orig.on(\"markerCleared\", setDealign);\n    dv.edit.on(\"viewportChange\", function() { set(false); });\n    dv.orig.on(\"viewportChange\", function() { set(false); });\n    update();\n    return update;\n  }\n\n  function registerScroll(dv) {\n    dv.edit.on(\"scroll\", function() {\n      syncScroll(dv, DIFF_INSERT) && makeConnections(dv);\n    });\n    dv.orig.on(\"scroll\", function() {\n      syncScroll(dv, DIFF_DELETE) && makeConnections(dv);\n    });\n  }\n\n  function syncScroll(dv, type) {\n    // Change handler will do a refresh after a timeout when diff is out of date\n    if (dv.diffOutOfDate) return false;\n    if (!dv.lockScroll) return true;\n    var editor, other, now = +new Date;\n    if (type == DIFF_INSERT) { editor = dv.edit; other = dv.orig; }\n    else { editor = dv.orig; other = dv.edit; }\n    // Don't take action if the position of this editor was recently set\n    // (to prevent feedback loops)\n    if (editor.state.scrollSetBy == dv && (editor.state.scrollSetAt || 0) + 50 > now) return false;\n\n    var sInfo = editor.getScrollInfo();\n    if (dv.mv.options.connect == \"align\") {\n      targetPos = sInfo.top;\n    } else {\n      var halfScreen = .5 * sInfo.clientHeight, midY = sInfo.top + halfScreen;\n      var mid = editor.lineAtHeight(midY, \"local\");\n      var around = chunkBoundariesAround(dv.chunks, mid, type == DIFF_INSERT);\n      var off = getOffsets(editor, type == DIFF_INSERT ? around.edit : around.orig);\n      var offOther = getOffsets(other, type == DIFF_INSERT ? around.orig : around.edit);\n      var ratio = (midY - off.top) / (off.bot - off.top);\n      var targetPos = (offOther.top - halfScreen) + ratio * (offOther.bot - offOther.top);\n\n      var botDist, mix;\n      // Some careful tweaking to make sure no space is left out of view\n      // when scrolling to top or bottom.\n      if (targetPos > sInfo.top && (mix = sInfo.top / halfScreen) < 1) {\n        targetPos = targetPos * mix + sInfo.top * (1 - mix);\n      } else if ((botDist = sInfo.height - sInfo.clientHeight - sInfo.top) < halfScreen) {\n        var otherInfo = other.getScrollInfo();\n        var botDistOther = otherInfo.height - otherInfo.clientHeight - targetPos;\n        if (botDistOther > botDist && (mix = botDist / halfScreen) < 1)\n          targetPos = targetPos * mix + (otherInfo.height - otherInfo.clientHeight - botDist) * (1 - mix);\n      }\n    }\n\n    other.scrollTo(sInfo.left, targetPos);\n    other.state.scrollSetAt = now;\n    other.state.scrollSetBy = dv;\n    return true;\n  }\n\n  function getOffsets(editor, around) {\n    var bot = around.after;\n    if (bot == null) bot = editor.lastLine() + 1;\n    return {top: editor.heightAtLine(around.before || 0, \"local\"),\n            bot: editor.heightAtLine(bot, \"local\")};\n  }\n\n  function setScrollLock(dv, val, action) {\n    dv.lockScroll = val;\n    if (val && action != false) syncScroll(dv, DIFF_INSERT) && makeConnections(dv);\n    dv.lockButton.innerHTML = val ? \"\\u21db\\u21da\" : \"\\u21db&nbsp;&nbsp;\\u21da\";\n  }\n\n  // Updating the marks for editor content\n\n  function clearMarks(editor, arr, classes) {\n    for (var i = 0; i < arr.length; ++i) {\n      var mark = arr[i];\n      if (mark instanceof CodeMirror.TextMarker) {\n        mark.clear();\n      } else if (mark.parent) {\n        editor.removeLineClass(mark, \"background\", classes.chunk);\n        editor.removeLineClass(mark, \"background\", classes.start);\n        editor.removeLineClass(mark, \"background\", classes.end);\n      }\n    }\n    arr.length = 0;\n  }\n\n  // FIXME maybe add a margin around viewport to prevent too many updates\n  function updateMarks(editor, diff, state, type, classes) {\n    var vp = editor.getViewport();\n    editor.operation(function() {\n      if (state.from == state.to || vp.from - state.to > 20 || state.from - vp.to > 20) {\n        clearMarks(editor, state.marked, classes);\n        markChanges(editor, diff, type, state.marked, vp.from, vp.to, classes);\n        state.from = vp.from; state.to = vp.to;\n      } else {\n        if (vp.from < state.from) {\n          markChanges(editor, diff, type, state.marked, vp.from, state.from, classes);\n          state.from = vp.from;\n        }\n        if (vp.to > state.to) {\n          markChanges(editor, diff, type, state.marked, state.to, vp.to, classes);\n          state.to = vp.to;\n        }\n      }\n    });\n  }\n\n  function markChanges(editor, diff, type, marks, from, to, classes) {\n    var pos = Pos(0, 0);\n    var top = Pos(from, 0), bot = editor.clipPos(Pos(to - 1));\n    var cls = type == DIFF_DELETE ? classes.del : classes.insert;\n    function markChunk(start, end) {\n      var bfrom = Math.max(from, start), bto = Math.min(to, end);\n      for (var i = bfrom; i < bto; ++i) {\n        var line = editor.addLineClass(i, \"background\", classes.chunk);\n        if (i == start) editor.addLineClass(line, \"background\", classes.start);\n        if (i == end - 1) editor.addLineClass(line, \"background\", classes.end);\n        marks.push(line);\n      }\n      // When the chunk is empty, make sure a horizontal line shows up\n      if (start == end && bfrom == end && bto == end) {\n        if (bfrom)\n          marks.push(editor.addLineClass(bfrom - 1, \"background\", classes.end));\n        else\n          marks.push(editor.addLineClass(bfrom, \"background\", classes.start));\n      }\n    }\n\n    var chunkStart = 0;\n    for (var i = 0; i < diff.length; ++i) {\n      var part = diff[i], tp = part[0], str = part[1];\n      if (tp == DIFF_EQUAL) {\n        var cleanFrom = pos.line + (startOfLineClean(diff, i) ? 0 : 1);\n        moveOver(pos, str);\n        var cleanTo = pos.line + (endOfLineClean(diff, i) ? 1 : 0);\n        if (cleanTo > cleanFrom) {\n          if (i) markChunk(chunkStart, cleanFrom);\n          chunkStart = cleanTo;\n        }\n      } else {\n        if (tp == type) {\n          var end = moveOver(pos, str, true);\n          var a = posMax(top, pos), b = posMin(bot, end);\n          if (!posEq(a, b))\n            marks.push(editor.markText(a, b, {className: cls}));\n          pos = end;\n        }\n      }\n    }\n    if (chunkStart <= pos.line) markChunk(chunkStart, pos.line + 1);\n  }\n\n  // Updating the gap between editor and original\n\n  function makeConnections(dv) {\n    if (!dv.showDifferences) return;\n\n    if (dv.svg) {\n      clear(dv.svg);\n      var w = dv.gap.offsetWidth;\n      attrs(dv.svg, \"width\", w, \"height\", dv.gap.offsetHeight);\n    }\n    if (dv.copyButtons) clear(dv.copyButtons);\n\n    var vpEdit = dv.edit.getViewport(), vpOrig = dv.orig.getViewport();\n    var sTopEdit = dv.edit.getScrollInfo().top, sTopOrig = dv.orig.getScrollInfo().top;\n    for (var i = 0; i < dv.chunks.length; i++) {\n      var ch = dv.chunks[i];\n      if (ch.editFrom <= vpEdit.to && ch.editTo >= vpEdit.from &&\n          ch.origFrom <= vpOrig.to && ch.origTo >= vpOrig.from)\n        drawConnectorsForChunk(dv, ch, sTopOrig, sTopEdit, w);\n    }\n  }\n\n  function getMatchingOrigLine(editLine, chunks) {\n    var editStart = 0, origStart = 0;\n    for (var i = 0; i < chunks.length; i++) {\n      var chunk = chunks[i];\n      if (chunk.editTo > editLine && chunk.editFrom <= editLine) return null;\n      if (chunk.editFrom > editLine) break;\n      editStart = chunk.editTo;\n      origStart = chunk.origTo;\n    }\n    return origStart + (editLine - editStart);\n  }\n\n  function findAlignedLines(dv, other) {\n    var linesToAlign = [];\n    for (var i = 0; i < dv.chunks.length; i++) {\n      var chunk = dv.chunks[i];\n      linesToAlign.push([chunk.origTo, chunk.editTo, other ? getMatchingOrigLine(chunk.editTo, other.chunks) : null]);\n    }\n    if (other) {\n      for (var i = 0; i < other.chunks.length; i++) {\n        var chunk = other.chunks[i];\n        for (var j = 0; j < linesToAlign.length; j++) {\n          var align = linesToAlign[j];\n          if (align[1] == chunk.editTo) {\n            j = -1;\n            break;\n          } else if (align[1] > chunk.editTo) {\n            break;\n          }\n        }\n        if (j > -1)\n          linesToAlign.splice(j - 1, 0, [getMatchingOrigLine(chunk.editTo, dv.chunks), chunk.editTo, chunk.origTo]);\n      }\n    }\n    return linesToAlign;\n  }\n\n  function alignChunks(dv, force) {\n    if (!dv.dealigned && !force) return;\n    if (!dv.orig.curOp) return dv.orig.operation(function() {\n      alignChunks(dv, force);\n    });\n\n    dv.dealigned = false;\n    var other = dv.mv.left == dv ? dv.mv.right : dv.mv.left;\n    if (other) {\n      ensureDiff(other);\n      other.dealigned = false;\n    }\n    var linesToAlign = findAlignedLines(dv, other);\n\n    // Clear old aligners\n    var aligners = dv.mv.aligners;\n    for (var i = 0; i < aligners.length; i++)\n      aligners[i].clear();\n    aligners.length = 0;\n\n    var cm = [dv.orig, dv.edit], scroll = [];\n    if (other) cm.push(other.orig);\n    for (var i = 0; i < cm.length; i++)\n      scroll.push(cm[i].getScrollInfo().top);\n\n    for (var ln = 0; ln < linesToAlign.length; ln++)\n      alignLines(cm, linesToAlign[ln], aligners);\n\n    for (var i = 0; i < cm.length; i++)\n      cm[i].scrollTo(null, scroll[i]);\n  }\n\n  function alignLines(cm, lines, aligners) {\n    var maxOffset = 0, offset = [];\n    for (var i = 0; i < cm.length; i++) if (lines[i] != null) {\n      var off = cm[i].heightAtLine(lines[i], \"local\");\n      offset[i] = off;\n      maxOffset = Math.max(maxOffset, off);\n    }\n    for (var i = 0; i < cm.length; i++) if (lines[i] != null) {\n      var diff = maxOffset - offset[i];\n      if (diff > 1)\n        aligners.push(padAbove(cm[i], lines[i], diff));\n    }\n  }\n\n  function padAbove(cm, line, size) {\n    var above = true;\n    if (line > cm.lastLine()) {\n      line--;\n      above = false;\n    }\n    var elt = document.createElement(\"div\");\n    elt.className = \"CodeMirror-merge-spacer\";\n    elt.style.height = size + \"px\"; elt.style.minWidth = \"1px\";\n    return cm.addLineWidget(line, elt, {height: size, above: above});\n  }\n\n  function drawConnectorsForChunk(dv, chunk, sTopOrig, sTopEdit, w) {\n    var flip = dv.type == \"left\";\n    var top = dv.orig.heightAtLine(chunk.origFrom, \"local\") - sTopOrig;\n    if (dv.svg) {\n      var topLpx = top;\n      var topRpx = dv.edit.heightAtLine(chunk.editFrom, \"local\") - sTopEdit;\n      if (flip) { var tmp = topLpx; topLpx = topRpx; topRpx = tmp; }\n      var botLpx = dv.orig.heightAtLine(chunk.origTo, \"local\") - sTopOrig;\n      var botRpx = dv.edit.heightAtLine(chunk.editTo, \"local\") - sTopEdit;\n      if (flip) { var tmp = botLpx; botLpx = botRpx; botRpx = tmp; }\n      var curveTop = \" C \" + w/2 + \" \" + topRpx + \" \" + w/2 + \" \" + topLpx + \" \" + (w + 2) + \" \" + topLpx;\n      var curveBot = \" C \" + w/2 + \" \" + botLpx + \" \" + w/2 + \" \" + botRpx + \" -1 \" + botRpx;\n      attrs(dv.svg.appendChild(document.createElementNS(svgNS, \"path\")),\n            \"d\", \"M -1 \" + topRpx + curveTop + \" L \" + (w + 2) + \" \" + botLpx + curveBot + \" z\",\n            \"class\", dv.classes.connect);\n    }\n    if (dv.copyButtons) {\n      var copy = dv.copyButtons.appendChild(elt(\"div\", dv.type == \"left\" ? \"\\u21dd\" : \"\\u21dc\",\n                                                \"CodeMirror-merge-copy\"));\n      var editOriginals = dv.mv.options.allowEditingOriginals;\n      copy.title = editOriginals ? \"Push to left\" : \"Revert chunk\";\n      copy.chunk = chunk;\n      copy.style.top = top + \"px\";\n\n      if (editOriginals) {\n        var topReverse = dv.orig.heightAtLine(chunk.editFrom, \"local\") - sTopEdit;\n        var copyReverse = dv.copyButtons.appendChild(elt(\"div\", dv.type == \"right\" ? \"\\u21dd\" : \"\\u21dc\",\n                                                         \"CodeMirror-merge-copy-reverse\"));\n        copyReverse.title = \"Push to right\";\n        copyReverse.chunk = {editFrom: chunk.origFrom, editTo: chunk.origTo,\n                             origFrom: chunk.editFrom, origTo: chunk.editTo};\n        copyReverse.style.top = topReverse + \"px\";\n        dv.type == \"right\" ? copyReverse.style.left = \"2px\" : copyReverse.style.right = \"2px\";\n      }\n    }\n  }\n\n  function copyChunk(dv, to, from, chunk) {\n    if (dv.diffOutOfDate) return;\n    to.replaceRange(from.getRange(Pos(chunk.origFrom, 0), Pos(chunk.origTo, 0)),\n                         Pos(chunk.editFrom, 0), Pos(chunk.editTo, 0));\n  }\n\n  // Merge view, containing 0, 1, or 2 diff views.\n\n  var MergeView = CodeMirror.MergeView = function(node, options) {\n    if (!(this instanceof MergeView)) return new MergeView(node, options);\n\n    this.options = options;\n    var origLeft = options.origLeft, origRight = options.origRight == null ? options.orig : options.origRight;\n\n    var hasLeft = origLeft != null, hasRight = origRight != null;\n    var panes = 1 + (hasLeft ? 1 : 0) + (hasRight ? 1 : 0);\n    var wrap = [], left = this.left = null, right = this.right = null;\n    var self = this;\n\n    if (hasLeft) {\n      left = this.left = new DiffView(this, \"left\");\n      var leftPane = elt(\"div\", null, \"CodeMirror-merge-pane\");\n      wrap.push(leftPane);\n      wrap.push(buildGap(left));\n    }\n\n    var editPane = elt(\"div\", null, \"CodeMirror-merge-pane\");\n    wrap.push(editPane);\n\n    if (hasRight) {\n      right = this.right = new DiffView(this, \"right\");\n      wrap.push(buildGap(right));\n      var rightPane = elt(\"div\", null, \"CodeMirror-merge-pane\");\n      wrap.push(rightPane);\n    }\n\n    (hasRight ? rightPane : editPane).className += \" CodeMirror-merge-pane-rightmost\";\n\n    wrap.push(elt(\"div\", null, null, \"height: 0; clear: both;\"));\n\n    var wrapElt = this.wrap = node.appendChild(elt(\"div\", wrap, \"CodeMirror-merge CodeMirror-merge-\" + panes + \"pane\"));\n    this.edit = CodeMirror(editPane, copyObj(options));\n\n    if (left) left.init(leftPane, origLeft, options);\n    if (right) right.init(rightPane, origRight, options);\n\n    if (options.collapseIdentical) {\n      updating = true;\n      this.editor().operation(function() {\n        collapseIdenticalStretches(self, options.collapseIdentical);\n      });\n      updating = false;\n    }\n    if (options.connect == \"align\") {\n      this.aligners = [];\n      alignChunks(this.left || this.right, true);\n    }\n\n    var onResize = function() {\n      if (left) makeConnections(left);\n      if (right) makeConnections(right);\n    };\n    CodeMirror.on(window, \"resize\", onResize);\n    var resizeInterval = setInterval(function() {\n      for (var p = wrapElt.parentNode; p && p != document.body; p = p.parentNode) {}\n      if (!p) { clearInterval(resizeInterval); CodeMirror.off(window, \"resize\", onResize); }\n    }, 5000);\n  };\n\n  function buildGap(dv) {\n    var lock = dv.lockButton = elt(\"div\", null, \"CodeMirror-merge-scrolllock\");\n    lock.title = \"Toggle locked scrolling\";\n    var lockWrap = elt(\"div\", [lock], \"CodeMirror-merge-scrolllock-wrap\");\n    CodeMirror.on(lock, \"click\", function() { setScrollLock(dv, !dv.lockScroll); });\n    var gapElts = [lockWrap];\n    if (dv.mv.options.revertButtons !== false) {\n      dv.copyButtons = elt(\"div\", null, \"CodeMirror-merge-copybuttons-\" + dv.type);\n      CodeMirror.on(dv.copyButtons, \"click\", function(e) {\n        var node = e.target || e.srcElement;\n        if (!node.chunk) return;\n        if (node.className == \"CodeMirror-merge-copy-reverse\") {\n          copyChunk(dv, dv.orig, dv.edit, node.chunk);\n          return;\n        }\n        copyChunk(dv, dv.edit, dv.orig, node.chunk);\n      });\n      gapElts.unshift(dv.copyButtons);\n    }\n    if (dv.mv.options.connect != \"align\") {\n      var svg = document.createElementNS && document.createElementNS(svgNS, \"svg\");\n      if (svg && !svg.createSVGRect) svg = null;\n      dv.svg = svg;\n      if (svg) gapElts.push(svg);\n    }\n\n    return dv.gap = elt(\"div\", gapElts, \"CodeMirror-merge-gap\");\n  }\n\n  MergeView.prototype = {\n    constuctor: MergeView,\n    editor: function() { return this.edit; },\n    rightOriginal: function() { return this.right && this.right.orig; },\n    leftOriginal: function() { return this.left && this.left.orig; },\n    setShowDifferences: function(val) {\n      if (this.right) this.right.setShowDifferences(val);\n      if (this.left) this.left.setShowDifferences(val);\n    },\n    rightChunks: function() {\n      if (this.right) { ensureDiff(this.right); return this.right.chunks; }\n    },\n    leftChunks: function() {\n      if (this.left) { ensureDiff(this.left); return this.left.chunks; }\n    }\n  };\n\n  function asString(obj) {\n    if (typeof obj == \"string\") return obj;\n    else return obj.getValue();\n  }\n\n  // Operations on diffs\n\n  var dmp = new diff_match_patch();\n  function getDiff(a, b) {\n    var diff = dmp.diff_main(a, b);\n    dmp.diff_cleanupSemantic(diff);\n    // The library sometimes leaves in empty parts, which confuse the algorithm\n    for (var i = 0; i < diff.length; ++i) {\n      var part = diff[i];\n      if (!part[1]) {\n        diff.splice(i--, 1);\n      } else if (i && diff[i - 1][0] == part[0]) {\n        diff.splice(i--, 1);\n        diff[i][1] += part[1];\n      }\n    }\n    return diff;\n  }\n\n  function getChunks(diff) {\n    var chunks = [];\n    var startEdit = 0, startOrig = 0;\n    var edit = Pos(0, 0), orig = Pos(0, 0);\n    for (var i = 0; i < diff.length; ++i) {\n      var part = diff[i], tp = part[0];\n      if (tp == DIFF_EQUAL) {\n        var startOff = startOfLineClean(diff, i) ? 0 : 1;\n        var cleanFromEdit = edit.line + startOff, cleanFromOrig = orig.line + startOff;\n        moveOver(edit, part[1], null, orig);\n        var endOff = endOfLineClean(diff, i) ? 1 : 0;\n        var cleanToEdit = edit.line + endOff, cleanToOrig = orig.line + endOff;\n        if (cleanToEdit > cleanFromEdit) {\n          if (i) chunks.push({origFrom: startOrig, origTo: cleanFromOrig,\n                              editFrom: startEdit, editTo: cleanFromEdit});\n          startEdit = cleanToEdit; startOrig = cleanToOrig;\n        }\n      } else {\n        moveOver(tp == DIFF_INSERT ? edit : orig, part[1]);\n      }\n    }\n    if (startEdit <= edit.line || startOrig <= orig.line)\n      chunks.push({origFrom: startOrig, origTo: orig.line + 1,\n                   editFrom: startEdit, editTo: edit.line + 1});\n    return chunks;\n  }\n\n  function endOfLineClean(diff, i) {\n    if (i == diff.length - 1) return true;\n    var next = diff[i + 1][1];\n    if (next.length == 1 || next.charCodeAt(0) != 10) return false;\n    if (i == diff.length - 2) return true;\n    next = diff[i + 2][1];\n    return next.length > 1 && next.charCodeAt(0) == 10;\n  }\n\n  function startOfLineClean(diff, i) {\n    if (i == 0) return true;\n    var last = diff[i - 1][1];\n    if (last.charCodeAt(last.length - 1) != 10) return false;\n    if (i == 1) return true;\n    last = diff[i - 2][1];\n    return last.charCodeAt(last.length - 1) == 10;\n  }\n\n  function chunkBoundariesAround(chunks, n, nInEdit) {\n    var beforeE, afterE, beforeO, afterO;\n    for (var i = 0; i < chunks.length; i++) {\n      var chunk = chunks[i];\n      var fromLocal = nInEdit ? chunk.editFrom : chunk.origFrom;\n      var toLocal = nInEdit ? chunk.editTo : chunk.origTo;\n      if (afterE == null) {\n        if (fromLocal > n) { afterE = chunk.editFrom; afterO = chunk.origFrom; }\n        else if (toLocal > n) { afterE = chunk.editTo; afterO = chunk.origTo; }\n      }\n      if (toLocal <= n) { beforeE = chunk.editTo; beforeO = chunk.origTo; }\n      else if (fromLocal <= n) { beforeE = chunk.editFrom; beforeO = chunk.origFrom; }\n    }\n    return {edit: {before: beforeE, after: afterE}, orig: {before: beforeO, after: afterO}};\n  }\n\n  function collapseSingle(cm, from, to) {\n    cm.addLineClass(from, \"wrap\", \"CodeMirror-merge-collapsed-line\");\n    var widget = document.createElement(\"span\");\n    widget.className = \"CodeMirror-merge-collapsed-widget\";\n    widget.title = \"Identical text collapsed. Click to expand.\";\n    var mark = cm.markText(Pos(from, 0), Pos(to - 1), {\n      inclusiveLeft: true,\n      inclusiveRight: true,\n      replacedWith: widget,\n      clearOnEnter: true\n    });\n    function clear() {\n      mark.clear();\n      cm.removeLineClass(from, \"wrap\", \"CodeMirror-merge-collapsed-line\");\n    }\n    widget.addEventListener(\"click\", clear);\n    return {mark: mark, clear: clear};\n  }\n\n  function collapseStretch(size, editors) {\n    var marks = [];\n    function clear() {\n      for (var i = 0; i < marks.length; i++) marks[i].clear();\n    }\n    for (var i = 0; i < editors.length; i++) {\n      var editor = editors[i];\n      var mark = collapseSingle(editor.cm, editor.line, editor.line + size);\n      marks.push(mark);\n      mark.mark.on(\"clear\", clear);\n    }\n    return marks[0].mark;\n  }\n\n  function unclearNearChunks(dv, margin, off, clear) {\n    for (var i = 0; i < dv.chunks.length; i++) {\n      var chunk = dv.chunks[i];\n      for (var l = chunk.editFrom - margin; l < chunk.editTo + margin; l++) {\n        var pos = l + off;\n        if (pos >= 0 && pos < clear.length) clear[pos] = false;\n      }\n    }\n  }\n\n  function collapseIdenticalStretches(mv, margin) {\n    if (typeof margin != \"number\") margin = 2;\n    var clear = [], edit = mv.editor(), off = edit.firstLine();\n    for (var l = off, e = edit.lastLine(); l <= e; l++) clear.push(true);\n    if (mv.left) unclearNearChunks(mv.left, margin, off, clear);\n    if (mv.right) unclearNearChunks(mv.right, margin, off, clear);\n\n    for (var i = 0; i < clear.length; i++) {\n      if (clear[i]) {\n        var line = i + off;\n        for (var size = 1; i < clear.length - 1 && clear[i + 1]; i++, size++) {}\n        if (size > margin) {\n          var editors = [{line: line, cm: edit}];\n          if (mv.left) editors.push({line: getMatchingOrigLine(line, mv.left.chunks), cm: mv.left.orig});\n          if (mv.right) editors.push({line: getMatchingOrigLine(line, mv.right.chunks), cm: mv.right.orig});\n          var mark = collapseStretch(size, editors);\n          if (mv.options.onCollapse) mv.options.onCollapse(mv, line, size, mark);\n        }\n      }\n    }\n  }\n\n  // General utilities\n\n  function elt(tag, content, className, style) {\n    var e = document.createElement(tag);\n    if (className) e.className = className;\n    if (style) e.style.cssText = style;\n    if (typeof content == \"string\") e.appendChild(document.createTextNode(content));\n    else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);\n    return e;\n  }\n\n  function clear(node) {\n    for (var count = node.childNodes.length; count > 0; --count)\n      node.removeChild(node.firstChild);\n  }\n\n  function attrs(elt) {\n    for (var i = 1; i < arguments.length; i += 2)\n      elt.setAttribute(arguments[i], arguments[i+1]);\n  }\n\n  function copyObj(obj, target) {\n    if (!target) target = {};\n    for (var prop in obj) if (obj.hasOwnProperty(prop)) target[prop] = obj[prop];\n    return target;\n  }\n\n  function moveOver(pos, str, copy, other) {\n    var out = copy ? Pos(pos.line, pos.ch) : pos, at = 0;\n    for (;;) {\n      var nl = str.indexOf(\"\\n\", at);\n      if (nl == -1) break;\n      ++out.line;\n      if (other) ++other.line;\n      at = nl + 1;\n    }\n    out.ch = (at ? 0 : out.ch) + (str.length - at);\n    if (other) other.ch = (at ? 0 : other.ch) + (str.length - at);\n    return out;\n  }\n\n  function posMin(a, b) { return (a.line - b.line || a.ch - b.ch) < 0 ? a : b; }\n  function posMax(a, b) { return (a.line - b.line || a.ch - b.ch) > 0 ? a : b; }\n  function posEq(a, b) { return a.line == b.line && a.ch == b.ch; }\n});\n"]}