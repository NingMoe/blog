{"version":3,"sources":["../../../../../../../../../app/public/js/marked/lib/codemirror/addon/scroll/annotatescrollbar.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","defineExtension","options","className","Annotation","defineOption","cm","buttonHeight","scrollButtonHeight","getOption","annotations","doRedraw","doUpdate","div","getWrapperElement","appendChild","document","createElement","style","cssText","computeScale","scheduleRedraw","delay","clearTimeout","self","setTimeout","redraw","on","resizeHandler","listenForChanges","changeHandler","prototype","hScale","clientHeight","display","barHeight","heightAtLine","lastLine","update","compute","frag","createDocumentFragment","anns","barWidth","i","nextTop","length","ann","top","charCoords","from","bottom","to","height","Math","max","elt","textContent","clear","off","parentNode","removeChild"],"mappings":"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","file":"annotatescrollbar.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  CodeMirror.defineExtension(\"annotateScrollbar\", function(options) {\n    if (typeof options == \"string\") options = {className: options};\n    return new Annotation(this, options);\n  });\n\n  CodeMirror.defineOption(\"scrollButtonHeight\", 0);\n\n  function Annotation(cm, options) {\n    this.cm = cm;\n    this.options = options;\n    this.buttonHeight = options.scrollButtonHeight || cm.getOption(\"scrollButtonHeight\");\n    this.annotations = [];\n    this.doRedraw = this.doUpdate = null;\n    this.div = cm.getWrapperElement().appendChild(document.createElement(\"div\"));\n    this.div.style.cssText = \"position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none\";\n    this.computeScale();\n\n    function scheduleRedraw(delay) {\n      clearTimeout(self.doRedraw);\n      self.doRedraw = setTimeout(function() { self.redraw(); }, delay);\n    }\n\n    var self = this;\n    cm.on(\"refresh\", this.resizeHandler = function() {\n      clearTimeout(self.doUpdate);\n      self.doUpdate = setTimeout(function() {\n        if (self.computeScale()) scheduleRedraw(20);\n      }, 100);\n    });\n    cm.on(\"markerAdded\", this.resizeHandler);\n    cm.on(\"markerCleared\", this.resizeHandler);\n    if (options.listenForChanges !== false)\n      cm.on(\"change\", this.changeHandler = function() {\n        scheduleRedraw(250);\n      });\n  }\n\n  Annotation.prototype.computeScale = function() {\n    var cm = this.cm;\n    var hScale = (cm.getWrapperElement().clientHeight - cm.display.barHeight - this.buttonHeight * 2) /\n      cm.heightAtLine(cm.lastLine() + 1, \"local\");\n    if (hScale != this.hScale) {\n      this.hScale = hScale;\n      return true;\n    }\n  };\n\n  Annotation.prototype.update = function(annotations) {\n    this.annotations = annotations;\n    this.redraw();\n  };\n\n  Annotation.prototype.redraw = function(compute) {\n    if (compute !== false) this.computeScale();\n    var cm = this.cm, hScale = this.hScale;\n\n    var frag = document.createDocumentFragment(), anns = this.annotations;\n    if (cm.display.barWidth) for (var i = 0, nextTop; i < anns.length; i++) {\n      var ann = anns[i];\n      var top = nextTop || cm.charCoords(ann.from, \"local\").top * hScale;\n      var bottom = cm.charCoords(ann.to, \"local\").bottom * hScale;\n      while (i < anns.length - 1) {\n        nextTop = cm.charCoords(anns[i + 1].from, \"local\").top * hScale;\n        if (nextTop > bottom + .9) break;\n        ann = anns[++i];\n        bottom = cm.charCoords(ann.to, \"local\").bottom * hScale;\n      }\n      if (bottom == top) continue;\n      var height = Math.max(bottom - top, 3);\n\n      var elt = frag.appendChild(document.createElement(\"div\"));\n      elt.style.cssText = \"position: absolute; right: 0px; width: \" + Math.max(cm.display.barWidth - 1, 2) + \"px; top: \"\n        + (top + this.buttonHeight) + \"px; height: \" + height + \"px\";\n      elt.className = this.options.className;\n    }\n    this.div.textContent = \"\";\n    this.div.appendChild(frag);\n  };\n\n  Annotation.prototype.clear = function() {\n    this.cm.off(\"refresh\", this.resizeHandler);\n    this.cm.off(\"markerAdded\", this.resizeHandler);\n    this.cm.off(\"markerCleared\", this.resizeHandler);\n    if (this.changeHandler) this.cm.off(\"change\", this.changeHandler);\n    this.div.parentNode.removeChild(this.div);\n  };\n});\n"]}