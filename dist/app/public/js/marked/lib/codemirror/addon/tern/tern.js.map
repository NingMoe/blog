{"version":3,"sources":["../../../../../../../../../app/public/js/marked/lib/codemirror/addon/tern/tern.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","TernServer","options","self","plugins","doc_comment","useWorker","server","WorkerServer","tern","Server","getFile","name","c","async","defs","docs","Object","create","trackChange","doc","change","cachedArgHints","activeArgHints","jumpStack","getHint","cm","hint","prototype","addDoc","data","changed","addFile","docValue","on","delDoc","id","found","resolveDoc","off","delFile","hideDoc","closeArgHints","sendDoc","complete","showHint","showType","pos","showContextInfo","showDocs","updateArgHints","jumpToDef","jumpBack","rename","selectName","request","query","findDoc","getDoc","buildRequest","error","responseFilter","destroy","worker","terminate","Pos","cls","bigDoc","ts","buf","n","cur","i","Doc","argHints","cmpPos","start","to","from","line","end","text","length","lineCount","setTimeout","files","type","window","console","types","urls","showError","completions","after","getRange","ch","completion","className","typeToIcon","guess","push","displayText","obj","list","tooltip","remove","node","content","completionTip","makeTooltip","parentNode","getBoundingClientRect","right","pageXOffset","top","pageYOffset","suffix","test","queryName","typeTip","tip","elt","appendChild","document","createTextNode","url","child","href","target","tempTooltip","somethingSelected","state","getTokenAt","getCursor","inner","innerMode","getMode","mode","lex","lexical","info","argPos","tabSize","getOption","e","Math","max","str","getLine","extra","tab","indexOf","column","charAt","cache","showArgHints","preferFunction","parseFnType","exprName","tp","args","arg","rettype","place","cursorCoords","bottom","skipMatching","upto","depth","next","slice","match","varName","req","variable","file","open","localDoc","findContext","moveTo","atInterestingExpression","dialog","pop","curDoc","setSelection","switchToDoc","before","context","contextOffset","split","startLine","cursor","getSearchCursor","nearest","nearestDist","Infinity","findNext","dist","abs","tok","token","string","newName","fullDocs","applyChanges","changes","ranges","refs","ref","anchor","head","setSelections","nextChangeOrig","perFile","known","chs","sort","a","b","origin","replaceRange","offsetLines","allowFragments","lineCharPositions","startPos","getFragmentAround","minIndent","minLine","endLine","p","min","fn","search","indent","countColumn","lastLine","tagname","createElement","arguments","f","openDialog","prompt","ternTooltip","where","maybeClear","old","mouseOnTip","clear","fadeOut","contains","relatedTarget","toElement","x","y","style","left","body","removeChild","opacity","msg","String","val","getValue","fileFilter","Worker","workerScript","postMessage","scripts","workerDeps","msgId","pending","send","onmessage","err","log","message","onerror"],"mappings":";;;;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,UAASA,GAAT,EAAc;AACb,MAAI,QAAOC,OAAP,yCAAOA,OAAP,MAAkB,QAAlB,IAA8B,QAAOC,MAAP,yCAAOA,MAAP,MAAiB,QAAnD,EAA6D;AAC3DF,QAAIG,QAAQ,sBAAR,CAAJ,EADF,KAEK,IAAI,OAAOC,MAAP,IAAiB,UAAjB,IAA+BA,OAAOC,GAA1C,EAA+C;AAClDD,WAAO,CAAC,sBAAD,CAAP,EAAiCJ,GAAjC,EADG,KAEA;AACHA,QAAIM,UAAJ;AACH,CAPD,EAOG,UAASA,UAAT,EAAqB;AACtB;AACA;;AAEAA,aAAWC,UAAX,GAAwB,UAASC,OAAT,EAAkB;AACxC,QAAIC,OAAO,IAAX;AACA,SAAKD,OAAL,GAAeA,WAAW,EAA1B;AACA,QAAIE,UAAU,KAAKF,OAAL,CAAaE,OAAb,KAAyB,KAAKF,OAAL,CAAaE,OAAb,GAAuB,EAAhD,CAAd;AACA,QAAI,CAACA,QAAQC,WAAb,EAA0BD,QAAQC,WAAR,GAAsB,IAAtB;AAC1B,QAAI,KAAKH,OAAL,CAAaI,SAAjB,EAA4B;AAC1B,WAAKC,MAAL,GAAc,IAAIC,YAAJ,CAAiB,IAAjB,CAAd;AACD,KAFD,MAEO;AACL,WAAKD,MAAL,GAAc,IAAIE,KAAKC,MAAT,CAAgB;AAC5BC,iBAAS,iBAASC,IAAT,EAAeC,CAAf,EAAkB;AAAE,iBAAOF,SAAQR,IAAR,EAAcS,IAAd,EAAoBC,CAApB,CAAP;AAAgC,SADjC;AAE5BC,eAAO,IAFqB;AAG5BC,cAAM,KAAKb,OAAL,CAAaa,IAAb,IAAqB,EAHC;AAI5BX,iBAASA;AAJmB,OAAhB,CAAd;AAMD;AACD,SAAKY,IAAL,GAAYC,OAAOC,MAAP,CAAc,IAAd,CAAZ;AACA,SAAKC,WAAL,GAAmB,UAASC,GAAT,EAAcC,MAAd,EAAsB;AAAEF,kBAAYhB,IAAZ,EAAkBiB,GAAlB,EAAuBC,MAAvB;AAAiC,KAA5E;;AAEA,SAAKC,cAAL,GAAsB,IAAtB;AACA,SAAKC,cAAL,GAAsB,IAAtB;AACA,SAAKC,SAAL,GAAiB,EAAjB;;AAEA,SAAKC,OAAL,GAAe,UAASC,EAAT,EAAab,CAAb,EAAgB;AAAE,aAAOc,KAAKxB,IAAL,EAAWuB,EAAX,EAAeb,CAAf,CAAP;AAA2B,KAA5D;AACA,SAAKY,OAAL,CAAaX,KAAb,GAAqB,IAArB;AACD,GAxBD;;AA0BAd,aAAWC,UAAX,CAAsB2B,SAAtB,GAAkC;AAChCC,YAAQ,gBAASjB,IAAT,EAAeQ,GAAf,EAAoB;AAC1B,UAAIU,OAAO,EAACV,KAAKA,GAAN,EAAWR,MAAMA,IAAjB,EAAuBmB,SAAS,IAAhC,EAAX;AACA,WAAKxB,MAAL,CAAYyB,OAAZ,CAAoBpB,IAApB,EAA0BqB,SAAS,IAAT,EAAeH,IAAf,CAA1B;AACA9B,iBAAWkC,EAAX,CAAcd,GAAd,EAAmB,QAAnB,EAA6B,KAAKD,WAAlC;AACA,aAAO,KAAKH,IAAL,CAAUJ,IAAV,IAAkBkB,IAAzB;AACD,KAN+B;;AAQhCK,YAAQ,gBAASC,EAAT,EAAa;AACnB,UAAIC,QAAQC,WAAW,IAAX,EAAiBF,EAAjB,CAAZ;AACA,UAAI,CAACC,KAAL,EAAY;AACZrC,iBAAWuC,GAAX,CAAeF,MAAMjB,GAArB,EAA0B,QAA1B,EAAoC,KAAKD,WAAzC;AACA,aAAO,KAAKH,IAAL,CAAUqB,MAAMzB,IAAhB,CAAP;AACA,WAAKL,MAAL,CAAYiC,OAAZ,CAAoBH,MAAMzB,IAA1B;AACD,KAd+B;;AAgBhC6B,aAAS,iBAASL,EAAT,EAAa;AACpBM,oBAAc,IAAd;AACA,UAAIL,QAAQC,WAAW,IAAX,EAAiBF,EAAjB,CAAZ;AACA,UAAIC,SAASA,MAAMN,OAAnB,EAA4BY,QAAQ,IAAR,EAAcN,KAAd;AAC7B,KApB+B;;AAsBhCO,cAAU,kBAASlB,EAAT,EAAa;AACrBA,SAAGmB,QAAH,CAAY,EAAClB,MAAM,KAAKF,OAAZ,EAAZ;AACD,KAxB+B;;AA0BhCqB,cAAU,kBAASpB,EAAT,EAAaqB,GAAb,EAAkBlC,CAAlB,EAAqB;AAAEmC,sBAAgB,IAAhB,EAAsBtB,EAAtB,EAA0BqB,GAA1B,EAA+B,MAA/B,EAAuClC,CAAvC;AAA4C,KA1B7C;;AA4BhCoC,cAAU,kBAASvB,EAAT,EAAaqB,GAAb,EAAkBlC,CAAlB,EAAqB;AAAEmC,sBAAgB,IAAhB,EAAsBtB,EAAtB,EAA0BqB,GAA1B,EAA+B,eAA/B,EAAgDlC,CAAhD;AAAqD,KA5BtD;;AA8BhCqC,oBAAgB,wBAASxB,EAAT,EAAa;AAAEwB,sBAAe,IAAf,EAAqBxB,EAArB;AAA2B,KA9B1B;;AAgChCyB,eAAW,mBAASzB,EAAT,EAAa;AAAEyB,iBAAU,IAAV,EAAgBzB,EAAhB;AAAsB,KAhChB;;AAkChC0B,cAAU,kBAAS1B,EAAT,EAAa;AAAE0B,gBAAS,IAAT,EAAe1B,EAAf;AAAqB,KAlCd;;AAoChC2B,YAAQ,gBAAS3B,EAAT,EAAa;AAAE2B,cAAO,IAAP,EAAa3B,EAAb;AAAmB,KApCV;;AAsChC4B,gBAAY,oBAAS5B,EAAT,EAAa;AAAE4B,kBAAW,IAAX,EAAiB5B,EAAjB;AAAuB,KAtClB;;AAwChC6B,aAAS,iBAAU7B,EAAV,EAAc8B,KAAd,EAAqB3C,CAArB,EAAwBkC,GAAxB,EAA6B;AACpC,UAAI5C,OAAO,IAAX;AACA,UAAIiB,MAAMqC,QAAQ,IAAR,EAAc/B,GAAGgC,MAAH,EAAd,CAAV;AACA,UAAIH,UAAUI,aAAa,IAAb,EAAmBvC,GAAnB,EAAwBoC,KAAxB,EAA+BT,GAA/B,CAAd;;AAEA,WAAKxC,MAAL,CAAYgD,OAAZ,CAAoBA,OAApB,EAA6B,UAAUK,KAAV,EAAiB9B,IAAjB,EAAuB;AAClD,YAAI,CAAC8B,KAAD,IAAUzD,KAAKD,OAAL,CAAa2D,cAA3B,EACE/B,OAAO3B,KAAKD,OAAL,CAAa2D,cAAb,CAA4BzC,GAA5B,EAAiCoC,KAAjC,EAAwCD,OAAxC,EAAiDK,KAAjD,EAAwD9B,IAAxD,CAAP;AACFjB,UAAE+C,KAAF,EAAS9B,IAAT;AACD,OAJD;AAKD,KAlD+B;;AAoDhCgC,aAAS,mBAAY;AACnB,UAAI,KAAKC,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYC,SAAZ;AACA,aAAKD,MAAL,GAAc,IAAd;AACD;AACF;AAzD+B,GAAlC;;AA4DA,MAAIE,MAAMjE,WAAWiE,GAArB;AACA,MAAIC,MAAM,kBAAV;AACA,MAAIC,SAAS,GAAb;;AAEA,WAASxD,QAAT,CAAiByD,EAAjB,EAAqBxD,IAArB,EAA2BC,CAA3B,EAA8B;AAC5B,QAAIwD,MAAMD,GAAGpD,IAAH,CAAQJ,IAAR,CAAV;AACA,QAAIyD,GAAJ,EACExD,EAAEoB,SAASmC,EAAT,EAAaC,GAAb,CAAF,EADF,KAEK,IAAID,GAAGlE,OAAH,CAAWS,OAAf,EACHyD,GAAGlE,OAAH,CAAWS,OAAX,CAAmBC,IAAnB,EAAyBC,CAAzB,EADG,KAGHA,EAAE,IAAF;AACH;;AAED,WAAS4C,OAAT,CAAiBW,EAAjB,EAAqBhD,GAArB,EAA0BR,IAA1B,EAAgC;AAC9B,SAAK,IAAI0D,CAAT,IAAcF,GAAGpD,IAAjB,EAAuB;AACrB,UAAIuD,MAAMH,GAAGpD,IAAH,CAAQsD,CAAR,CAAV;AACA,UAAIC,IAAInD,GAAJ,IAAWA,GAAf,EAAoB,OAAOmD,GAAP;AACrB;AACD,QAAI,CAAC3D,IAAL,EAAW,KAAK,IAAI4D,IAAI,CAAb,GAAiB,EAAEA,CAAnB,EAAsB;AAC/BF,UAAI,UAAUE,KAAK,EAAf,IAAqB,GAAzB;AACA,UAAI,CAACJ,GAAGpD,IAAH,CAAQsD,CAAR,CAAL,EAAiB;AAAE1D,eAAO0D,CAAP,CAAU;AAAQ;AACtC;AACD,WAAOF,GAAGvC,MAAH,CAAUjB,IAAV,EAAgBQ,GAAhB,CAAP;AACD;;AAED,WAASkB,UAAT,CAAoB8B,EAApB,EAAwBhC,EAAxB,EAA4B;AAC1B,QAAI,OAAOA,EAAP,IAAa,QAAjB,EAA2B,OAAOgC,GAAGpD,IAAH,CAAQoB,EAAR,CAAP;AAC3B,QAAIA,cAAcpC,UAAlB,EAA8BoC,KAAKA,GAAGsB,MAAH,EAAL;AAC9B,QAAItB,cAAcpC,WAAWyE,GAA7B,EAAkC,OAAOhB,QAAQW,EAAR,EAAYhC,EAAZ,CAAP;AACnC;;AAED,WAASjB,WAAT,CAAqBiD,EAArB,EAAyBhD,GAAzB,EAA8BC,MAA9B,EAAsC;AACpC,QAAIS,OAAO2B,QAAQW,EAAR,EAAYhD,GAAZ,CAAX;;AAEA,QAAIsD,WAAWN,GAAG9C,cAAlB;AACA,QAAIoD,YAAYA,SAAStD,GAAT,IAAgBA,GAA5B,IAAmCuD,OAAOD,SAASE,KAAhB,EAAuBvD,OAAOwD,EAA9B,KAAqC,CAA5E,EACET,GAAG9C,cAAH,GAAoB,IAApB;;AAEF,QAAIS,UAAUD,KAAKC,OAAnB;AACA,QAAIA,WAAW,IAAf,EACED,KAAKC,OAAL,GAAeA,UAAU,EAAC+C,MAAMzD,OAAOyD,IAAP,CAAYC,IAAnB,EAAyBF,IAAIxD,OAAOyD,IAAP,CAAYC,IAAzC,EAAzB;AACF,QAAIC,MAAM3D,OAAOyD,IAAP,CAAYC,IAAZ,IAAoB1D,OAAO4D,IAAP,CAAYC,MAAZ,GAAqB,CAAzC,CAAV;AACA,QAAI7D,OAAOyD,IAAP,CAAYC,IAAZ,GAAmBhD,QAAQ8C,EAA/B,EAAmC9C,QAAQ8C,EAAR,GAAa9C,QAAQ8C,EAAR,IAAcxD,OAAOwD,EAAP,CAAUE,IAAV,GAAiBC,GAA/B,CAAb;AACnC,QAAIA,OAAOjD,QAAQ8C,EAAnB,EAAuB9C,QAAQ8C,EAAR,GAAaG,MAAM,CAAnB;AACvB,QAAIjD,QAAQ+C,IAAR,GAAezD,OAAOyD,IAAP,CAAYC,IAA/B,EAAqChD,QAAQ+C,IAAR,GAAezD,OAAOyD,IAAP,CAAYC,IAA3B;;AAErC,QAAI3D,IAAI+D,SAAJ,KAAkBhB,MAAlB,IAA4B9C,OAAOwD,EAAP,GAAY9C,QAAQ+C,IAApB,GAA2B,GAA3D,EAAgEM,WAAW,YAAW;AACpF,UAAItD,KAAKC,OAAL,IAAgBD,KAAKC,OAAL,CAAa8C,EAAb,GAAkB/C,KAAKC,OAAL,CAAa+C,IAA/B,GAAsC,GAA1D,EAA+DnC,QAAQyB,EAAR,EAAYtC,IAAZ;AAChE,KAF+D,EAE7D,GAF6D;AAGjE;;AAED,WAASa,OAAT,CAAiByB,EAAjB,EAAqBhD,GAArB,EAA0B;AACxBgD,OAAG7D,MAAH,CAAUgD,OAAV,CAAkB,EAAC8B,OAAO,CAAC,EAACC,MAAM,MAAP,EAAe1E,MAAMQ,IAAIR,IAAzB,EAA+BqE,MAAMhD,SAASmC,EAAT,EAAahD,GAAb,CAArC,EAAD,CAAR,EAAlB,EAAsF,UAASwC,KAAT,EAAgB;AACpG,UAAIA,KAAJ,EAAW2B,OAAOC,OAAP,CAAe5B,KAAf,CAAqBA,KAArB,EAAX,KACKxC,IAAIW,OAAJ,GAAc,IAAd;AACN,KAHD;AAID;;AAED;;AAEA,WAASJ,IAAT,CAAcyC,EAAd,EAAkB1C,EAAlB,EAAsBb,CAAtB,EAAyB;AACvBuD,OAAGb,OAAH,CAAW7B,EAAX,EAAe,EAAC4D,MAAM,aAAP,EAAsBG,OAAO,IAA7B,EAAmCzE,MAAM,IAAzC,EAA+C0E,MAAM,IAArD,EAAf,EAA2E,UAAS9B,KAAT,EAAgB9B,IAAhB,EAAsB;AAC/F,UAAI8B,KAAJ,EAAW,OAAO+B,UAAUvB,EAAV,EAAc1C,EAAd,EAAkBkC,KAAlB,CAAP;AACX,UAAIgC,cAAc,EAAlB;AAAA,UAAsBC,QAAQ,EAA9B;AACA,UAAIf,OAAOhD,KAAK8C,KAAhB;AAAA,UAAuBC,KAAK/C,KAAKkD,GAAjC;AACA,UAAItD,GAAGoE,QAAH,CAAY7B,IAAIa,KAAKC,IAAT,EAAeD,KAAKiB,EAAL,GAAU,CAAzB,CAAZ,EAAyCjB,IAAzC,KAAkD,KAAlD,IACApD,GAAGoE,QAAH,CAAYjB,EAAZ,EAAgBZ,IAAIY,GAAGE,IAAP,EAAaF,GAAGkB,EAAH,GAAQ,CAArB,CAAhB,KAA4C,KADhD,EAEEF,QAAQ,KAAR;;AAEF,WAAK,IAAIrB,IAAI,CAAb,EAAgBA,IAAI1C,KAAK8D,WAAL,CAAiBV,MAArC,EAA6C,EAAEV,CAA/C,EAAkD;AAChD,YAAIwB,aAAalE,KAAK8D,WAAL,CAAiBpB,CAAjB,CAAjB;AAAA,YAAsCyB,YAAYC,WAAWF,WAAWV,IAAtB,CAAlD;AACA,YAAIxD,KAAKqE,KAAT,EAAgBF,aAAa,MAAM/B,GAAN,GAAY,OAAzB;AAChB0B,oBAAYQ,IAAZ,CAAiB,EAACnB,MAAMe,WAAWpF,IAAX,GAAkBiF,KAAzB;AACCQ,uBAAaL,WAAWpF,IADzB;AAECqF,qBAAWA,SAFZ;AAGCnE,gBAAMkE,UAHP,EAAjB;AAID;;AAED,UAAIM,MAAM,EAACxB,MAAMA,IAAP,EAAaD,IAAIA,EAAjB,EAAqB0B,MAAMX,WAA3B,EAAV;AACA,UAAIY,UAAU,IAAd;AACAxG,iBAAWkC,EAAX,CAAcoE,GAAd,EAAmB,OAAnB,EAA4B,YAAW;AAAEG,eAAOD,OAAP;AAAkB,OAA3D;AACAxG,iBAAWkC,EAAX,CAAcoE,GAAd,EAAmB,QAAnB,EAA6B,YAAW;AAAEG,eAAOD,OAAP;AAAkB,OAA5D;AACAxG,iBAAWkC,EAAX,CAAcoE,GAAd,EAAmB,QAAnB,EAA6B,UAAS/B,GAAT,EAAcmC,IAAd,EAAoB;AAC/CD,eAAOD,OAAP;AACA,YAAIG,UAAUvC,GAAGlE,OAAH,CAAW0G,aAAX,GAA2BxC,GAAGlE,OAAH,CAAW0G,aAAX,CAAyBrC,IAAIzC,IAA7B,CAA3B,GAAgEyC,IAAIzC,IAAJ,CAASV,GAAvF;AACA,YAAIuF,OAAJ,EAAa;AACXH,oBAAUK,YAAYH,KAAKI,UAAL,CAAgBC,qBAAhB,GAAwCC,KAAxC,GAAgDzB,OAAO0B,WAAnE,EACYP,KAAKK,qBAAL,GAA6BG,GAA7B,GAAmC3B,OAAO4B,WADtD,EACmER,OADnE,CAAV;AAEAH,kBAAQP,SAAR,IAAqB,MAAM/B,GAAN,GAAY,UAAjC;AACD;AACF,OARD;AASArD,QAAEyF,GAAF;AACD,KA/BD;AAgCD;;AAED,WAASJ,UAAT,CAAoBZ,IAApB,EAA0B;AACxB,QAAI8B,MAAJ;AACA,QAAI9B,QAAQ,GAAZ,EAAiB8B,SAAS,SAAT,CAAjB,KACK,IAAI9B,QAAQ,QAAR,IAAoBA,QAAQ,QAA5B,IAAwCA,QAAQ,MAApD,EAA4D8B,SAAS9B,IAAT,CAA5D,KACA,IAAI,QAAQ+B,IAAR,CAAa/B,IAAb,CAAJ,EAAwB8B,SAAS,IAAT,CAAxB,KACA,IAAI,MAAMC,IAAN,CAAW/B,IAAX,CAAJ,EAAsB8B,SAAS,OAAT,CAAtB,KACAA,SAAS,QAAT;AACL,WAAOlD,MAAM,aAAN,GAAsBA,GAAtB,GAA4B,aAA5B,GAA4CkD,MAAnD;AACD;;AAED;;AAEA,WAASpE,eAAT,CAAyBoB,EAAzB,EAA6B1C,EAA7B,EAAiCqB,GAAjC,EAAsCuE,SAAtC,EAAiDzG,CAAjD,EAAoD;AAClDuD,OAAGb,OAAH,CAAW7B,EAAX,EAAe4F,SAAf,EAA0B,UAAS1D,KAAT,EAAgB9B,IAAhB,EAAsB;AAC9C,UAAI8B,KAAJ,EAAW,OAAO+B,UAAUvB,EAAV,EAAc1C,EAAd,EAAkBkC,KAAlB,CAAP;AACX,UAAIQ,GAAGlE,OAAH,CAAWqH,OAAf,EAAwB;AACtB,YAAIC,MAAMpD,GAAGlE,OAAH,CAAWqH,OAAX,CAAmBzF,IAAnB,CAAV;AACD,OAFD,MAEO;AACL,YAAI0F,MAAMC,IAAI,MAAJ,EAAY,IAAZ,EAAkBA,IAAI,QAAJ,EAAc,IAAd,EAAoB3F,KAAKwD,IAAL,IAAa,WAAjC,CAAlB,CAAV;AACA,YAAIxD,KAAKV,GAAT,EACEoG,IAAIE,WAAJ,CAAgBC,SAASC,cAAT,CAAwB,QAAQ9F,KAAKV,GAArC,CAAhB;AACF,YAAIU,KAAK+F,GAAT,EAAc;AACZL,cAAIE,WAAJ,CAAgBC,SAASC,cAAT,CAAwB,GAAxB,CAAhB;AACA,cAAIE,QAAQN,IAAIE,WAAJ,CAAgBD,IAAI,GAAJ,EAAS,IAAT,EAAe,QAAf,CAAhB,CAAZ;AACAK,gBAAMC,IAAN,GAAajG,KAAK+F,GAAlB;AACAC,gBAAME,MAAN,GAAe,QAAf;AACD;AACF;AACDC,kBAAYvG,EAAZ,EAAgB8F,GAAhB;AACA,UAAI3G,CAAJ,EAAOA;AACR,KAjBD,EAiBGkC,GAjBH;AAkBD;;AAED;;AAEA,WAASG,eAAT,CAAwBkB,EAAxB,EAA4B1C,EAA5B,EAAgC;AAC9BgB,kBAAc0B,EAAd;;AAEA,QAAI1C,GAAGwG,iBAAH,EAAJ,EAA4B;AAC5B,QAAIC,QAAQzG,GAAG0G,UAAH,CAAc1G,GAAG2G,SAAH,EAAd,EAA8BF,KAA1C;AACA,QAAIG,QAAQtI,WAAWuI,SAAX,CAAqB7G,GAAG8G,OAAH,EAArB,EAAmCL,KAAnC,CAAZ;AACA,QAAIG,MAAMG,IAAN,CAAW7H,IAAX,IAAmB,YAAvB,EAAqC;AACrC,QAAI8H,MAAMJ,MAAMH,KAAN,CAAYQ,OAAtB;AACA,QAAID,IAAIE,IAAJ,IAAY,MAAhB,EAAwB;;AAExB,QAAI7C,EAAJ;AAAA,QAAQ8C,SAASH,IAAI3F,GAAJ,IAAW,CAA5B;AAAA,QAA+B+F,UAAUpH,GAAGqH,SAAH,CAAa,SAAb,CAAzC;AACA,SAAK,IAAIhE,OAAOrD,GAAG2G,SAAH,GAAetD,IAA1B,EAAgCiE,IAAIC,KAAKC,GAAL,CAAS,CAAT,EAAYnE,OAAO,CAAnB,CAApC,EAA2D1C,QAAQ,KAAxE,EAA+E0C,QAAQiE,CAAvF,EAA0F,EAAEjE,IAA5F,EAAkG;AAChG,UAAIoE,MAAMzH,GAAG0H,OAAH,CAAWrE,IAAX,CAAV;AAAA,UAA4BsE,QAAQ,CAApC;AACA,WAAK,IAAItG,MAAM,CAAf,IAAoB;AAClB,YAAIuG,MAAMH,IAAII,OAAJ,CAAY,IAAZ,EAAkBxG,GAAlB,CAAV;AACA,YAAIuG,OAAO,CAAC,CAAZ,EAAe;AACfD,iBAASP,UAAU,CAACQ,MAAMD,KAAP,IAAgBP,OAA1B,GAAoC,CAA7C;AACA/F,cAAMuG,MAAM,CAAZ;AACD;AACDvD,WAAK2C,IAAIc,MAAJ,GAAaH,KAAlB;AACA,UAAIF,IAAIM,MAAJ,CAAW1D,EAAX,KAAkB,GAAtB,EAA2B;AAAC1D,gBAAQ,IAAR,CAAc;AAAO;AAClD;AACD,QAAI,CAACA,KAAL,EAAY;;AAEZ,QAAIuC,QAAQX,IAAIc,IAAJ,EAAUgB,EAAV,CAAZ;AACA,QAAI2D,QAAQtF,GAAG9C,cAAf;AACA,QAAIoI,SAASA,MAAMtI,GAAN,IAAaM,GAAGgC,MAAH,EAAtB,IAAqCiB,OAAOC,KAAP,EAAc8E,MAAM9E,KAApB,KAA8B,CAAvE,EACE,OAAO+E,aAAavF,EAAb,EAAiB1C,EAAjB,EAAqBmH,MAArB,CAAP;;AAEFzE,OAAGb,OAAH,CAAW7B,EAAX,EAAe,EAAC4D,MAAM,MAAP,EAAesE,gBAAgB,IAA/B,EAAqC5E,KAAKJ,KAA1C,EAAf,EAAiE,UAAShB,KAAT,EAAgB9B,IAAhB,EAAsB;AACrF,UAAI8B,SAAS,CAAC9B,KAAKwD,IAAf,IAAuB,CAAE,OAAD,CAAU+B,IAAV,CAAevF,KAAKwD,IAApB,CAA5B,EAAuD;AACvDlB,SAAG9C,cAAH,GAAoB;AAClBsD,eAAO7B,GADW;AAElBuC,cAAMuE,YAAY/H,KAAKwD,IAAjB,CAFY;AAGlB1E,cAAMkB,KAAKgI,QAAL,IAAiBhI,KAAKlB,IAAtB,IAA8B,IAHlB;AAIlBuF,eAAOrE,KAAKqE,KAJM;AAKlB/E,aAAKM,GAAGgC,MAAH;AALa,OAApB;AAOAiG,mBAAavF,EAAb,EAAiB1C,EAAjB,EAAqBmH,MAArB;AACD,KAVD;AAWD;;AAED,WAASc,YAAT,CAAsBvF,EAAtB,EAA0B1C,EAA1B,EAA8BqB,GAA9B,EAAmC;AACjCL,kBAAc0B,EAAd;;AAEA,QAAIsF,QAAQtF,GAAG9C,cAAf;AAAA,QAA+ByI,KAAKL,MAAMpE,IAA1C;AACA,QAAIkC,MAAMC,IAAI,MAAJ,EAAYiC,MAAMvD,KAAN,GAAcjC,MAAM,aAApB,GAAoC,IAAhD,EACIuD,IAAI,MAAJ,EAAYvD,MAAM,OAAlB,EAA2BwF,MAAM9I,IAAjC,CADJ,EAC4C,GAD5C,CAAV;AAEA,SAAK,IAAI4D,IAAI,CAAb,EAAgBA,IAAIuF,GAAGC,IAAH,CAAQ9E,MAA5B,EAAoC,EAAEV,CAAtC,EAAyC;AACvC,UAAIA,CAAJ,EAAOgD,IAAIE,WAAJ,CAAgBC,SAASC,cAAT,CAAwB,IAAxB,CAAhB;AACP,UAAIqC,MAAMF,GAAGC,IAAH,CAAQxF,CAAR,CAAV;AACAgD,UAAIE,WAAJ,CAAgBD,IAAI,MAAJ,EAAYvD,MAAM,MAAN,IAAgBM,KAAKzB,GAAL,GAAW,MAAMmB,GAAN,GAAY,cAAvB,GAAwC,EAAxD,CAAZ,EAAyE+F,IAAIrJ,IAAJ,IAAY,GAArF,CAAhB;AACA,UAAIqJ,IAAI3E,IAAJ,IAAY,GAAhB,EAAqB;AACnBkC,YAAIE,WAAJ,CAAgBC,SAASC,cAAT,CAAwB,OAAxB,CAAhB;AACAJ,YAAIE,WAAJ,CAAgBD,IAAI,MAAJ,EAAYvD,MAAM,MAAlB,EAA0B+F,IAAI3E,IAA9B,CAAhB;AACD;AACF;AACDkC,QAAIE,WAAJ,CAAgBC,SAASC,cAAT,CAAwBmC,GAAGG,OAAH,GAAa,UAAb,GAA4B,GAApD,CAAhB;AACA,QAAIH,GAAGG,OAAP,EAAgB1C,IAAIE,WAAJ,CAAgBD,IAAI,MAAJ,EAAYvD,MAAM,MAAlB,EAA0B6F,GAAGG,OAA7B,CAAhB;AAChB,QAAIC,QAAQzI,GAAG0I,YAAH,CAAgB,IAAhB,EAAsB,MAAtB,CAAZ;AACAhG,OAAG7C,cAAH,GAAoBsF,YAAYsD,MAAMnD,KAAN,GAAc,CAA1B,EAA6BmD,MAAME,MAAnC,EAA2C7C,GAA3C,CAApB;AACD;;AAED,WAASqC,WAAT,CAAqB5E,IAArB,EAA2B;AACzB,QAAI+E,OAAO,EAAX;AAAA,QAAejH,MAAM,CAArB;;AAEA,aAASuH,YAAT,CAAsBC,IAAtB,EAA4B;AAC1B,UAAIC,QAAQ,CAAZ;AAAA,UAAe5F,QAAQ7B,GAAvB;AACA,eAAS;AACP,YAAI0H,OAAOxF,KAAKwE,MAAL,CAAY1G,GAAZ,CAAX;AACA,YAAIwH,KAAKlD,IAAL,CAAUoD,IAAV,KAAmB,CAACD,KAAxB,EAA+B,OAAOvF,KAAKyF,KAAL,CAAW9F,KAAX,EAAkB7B,GAAlB,CAAP;AAC/B,YAAI,UAAUsE,IAAV,CAAeoD,IAAf,CAAJ,EAA0B,EAAED,KAAF,CAA1B,KACK,IAAI,UAAUnD,IAAV,CAAeoD,IAAf,CAAJ,EAA0B,EAAED,KAAF;AAC/B,UAAEzH,GAAF;AACD;AACF;;AAED;AACA,QAAIkC,KAAKwE,MAAL,CAAY1G,GAAZ,KAAoB,GAAxB,EAA6B,SAAS;AACpC,UAAInC,OAAOqE,KAAKyF,KAAL,CAAW3H,GAAX,EAAgB4H,KAAhB,CAAsB,mBAAtB,CAAX;AACA,UAAI/J,IAAJ,EAAU;AACRmC,eAAOnC,KAAK,CAAL,EAAQsE,MAAf;AACAtE,eAAOA,KAAK,CAAL,CAAP;AACD;AACDoJ,WAAK5D,IAAL,CAAU,EAACxF,MAAMA,IAAP,EAAa0E,MAAMgF,aAAa,OAAb,CAAnB,EAAV;AACA,UAAIrF,KAAKwE,MAAL,CAAY1G,GAAZ,KAAoB,GAAxB,EAA6B;AAC7BA,aAAO,CAAP;AACD;;AAED,QAAImH,UAAUjF,KAAKyF,KAAL,CAAW3H,GAAX,EAAgB4H,KAAhB,CAAsB,cAAtB,CAAd;;AAEA,WAAO,EAACX,MAAMA,IAAP,EAAaE,SAASA,WAAWA,QAAQ,CAAR,CAAjC,EAAP;AACD;;AAED;;AAEA,WAAS/G,UAAT,CAAmBiB,EAAnB,EAAuB1C,EAAvB,EAA2B;AACzB,aAAS4G,KAAT,CAAesC,OAAf,EAAwB;AACtB,UAAIC,MAAM,EAACvF,MAAM,YAAP,EAAqBwF,UAAUF,WAAW,IAA1C,EAAV;AACA,UAAIxJ,MAAMqC,QAAQW,EAAR,EAAY1C,GAAGgC,MAAH,EAAZ,CAAV;AACAU,SAAG7D,MAAH,CAAUgD,OAAV,CAAkBI,aAAaS,EAAb,EAAiBhD,GAAjB,EAAsByJ,GAAtB,CAAlB,EAA8C,UAASjH,KAAT,EAAgB9B,IAAhB,EAAsB;AAClE,YAAI8B,KAAJ,EAAW,OAAO+B,UAAUvB,EAAV,EAAc1C,EAAd,EAAkBkC,KAAlB,CAAP;AACX,YAAI,CAAC9B,KAAKiJ,IAAN,IAAcjJ,KAAK+F,GAAvB,EAA4B;AAAEtC,iBAAOyF,IAAP,CAAYlJ,KAAK+F,GAAjB,EAAuB;AAAS;;AAE9D,YAAI/F,KAAKiJ,IAAT,EAAe;AACb,cAAIE,WAAW7G,GAAGpD,IAAH,CAAQc,KAAKiJ,IAAb,CAAf;AAAA,cAAmC1I,KAAnC;AACA,cAAI4I,aAAa5I,QAAQ6I,YAAYD,SAAS7J,GAArB,EAA0BU,IAA1B,CAArB,CAAJ,EAA2D;AACzDsC,eAAG5C,SAAH,CAAa4E,IAAb,CAAkB,EAAC2E,MAAM3J,IAAIR,IAAX;AACCgE,qBAAOlD,GAAG2G,SAAH,CAAa,MAAb,CADR;AAECrD,mBAAKtD,GAAG2G,SAAH,CAAa,IAAb,CAFN,EAAlB;AAGA8C,mBAAO/G,EAAP,EAAWhD,GAAX,EAAgB6J,QAAhB,EAA0B5I,MAAMuC,KAAhC,EAAuCvC,MAAM2C,GAA7C;AACA;AACD;AACF;AACDW,kBAAUvB,EAAV,EAAc1C,EAAd,EAAkB,8BAAlB;AACD,OAfD;AAgBD;;AAED,QAAI,CAAC0J,wBAAwB1J,EAAxB,CAAL,EACE2J,OAAO3J,EAAP,EAAW,kBAAX,EAA+B,UAASd,IAAT,EAAe;AAAE,UAAIA,IAAJ,EAAU0H,MAAM1H,IAAN;AAAc,KAAxE,EADF,KAGE0H;AACH;;AAED,WAASlF,SAAT,CAAkBgB,EAAlB,EAAsB1C,EAAtB,EAA0B;AACxB,QAAIqB,MAAMqB,GAAG5C,SAAH,CAAa8J,GAAb,EAAV;AAAA,QAA8BlK,MAAM2B,OAAOqB,GAAGpD,IAAH,CAAQ+B,IAAIgI,IAAZ,CAA3C;AACA,QAAI,CAAC3J,GAAL,EAAU;AACV+J,WAAO/G,EAAP,EAAWX,QAAQW,EAAR,EAAY1C,GAAGgC,MAAH,EAAZ,CAAX,EAAqCtC,GAArC,EAA0C2B,IAAI6B,KAA9C,EAAqD7B,IAAIiC,GAAzD;AACD;;AAED,WAASmG,MAAT,CAAgB/G,EAAhB,EAAoBmH,MAApB,EAA4BnK,GAA5B,EAAiCwD,KAAjC,EAAwCI,GAAxC,EAA6C;AAC3C5D,QAAIA,GAAJ,CAAQoK,YAAR,CAAqB5G,KAArB,EAA4BI,GAA5B;AACA,QAAIuG,UAAUnK,GAAV,IAAiBgD,GAAGlE,OAAH,CAAWuL,WAAhC,EAA6C;AAC3C/I,oBAAc0B,EAAd;AACAA,SAAGlE,OAAH,CAAWuL,WAAX,CAAuBrK,IAAIR,IAA3B,EAAiCQ,IAAIA,GAArC;AACD;AACF;;AAED;AACA,WAAS8J,WAAT,CAAqB9J,GAArB,EAA0BU,IAA1B,EAAgC;AAC9B,QAAI4J,SAAS5J,KAAK6J,OAAL,CAAajB,KAAb,CAAmB,CAAnB,EAAsB5I,KAAK8J,aAA3B,EAA0CC,KAA1C,CAAgD,IAAhD,CAAb;AACA,QAAIC,YAAYhK,KAAK8C,KAAL,CAAWG,IAAX,IAAmB2G,OAAOxG,MAAP,GAAgB,CAAnC,CAAhB;AACA,QAAIN,QAAQX,IAAI6H,SAAJ,EAAe,CAACJ,OAAOxG,MAAP,IAAiB,CAAjB,GAAqBpD,KAAK8C,KAAL,CAAWmB,EAAhC,GAAqC3E,IAAIgI,OAAJ,CAAY0C,SAAZ,EAAuB5G,MAA7D,IAAuEwG,OAAO,CAAP,EAAUxG,MAAhG,CAAZ;;AAEA,QAAID,OAAO7D,IAAIgI,OAAJ,CAAY0C,SAAZ,EAAuBpB,KAAvB,CAA6B9F,MAAMmB,EAAnC,CAAX;AACA,SAAK,IAAIxB,MAAMuH,YAAY,CAA3B,EAA8BvH,MAAMnD,IAAI+D,SAAJ,EAAN,IAAyBF,KAAKC,MAAL,GAAcpD,KAAK6J,OAAL,CAAazG,MAAlF,EAA0F,EAAEX,GAA5F;AACEU,cAAQ,OAAO7D,IAAIgI,OAAJ,CAAY7E,GAAZ,CAAf;AADF,KAEA,IAAIU,KAAKyF,KAAL,CAAW,CAAX,EAAc5I,KAAK6J,OAAL,CAAazG,MAA3B,KAAsCpD,KAAK6J,OAA/C,EAAwD,OAAO7J,IAAP;;AAExD,QAAIiK,SAAS3K,IAAI4K,eAAJ,CAAoBlK,KAAK6J,OAAzB,EAAkC,CAAlC,EAAqC,KAArC,CAAb;AACA,QAAIM,OAAJ;AAAA,QAAaC,cAAcC,QAA3B;AACA,WAAOJ,OAAOK,QAAP,EAAP,EAA0B;AACxB,UAAItH,OAAOiH,OAAOjH,IAAP,EAAX;AAAA,UAA0BuH,OAAOpD,KAAKqD,GAAL,CAASxH,KAAKC,IAAL,GAAYH,MAAMG,IAA3B,IAAmC,KAApE;AACA,UAAI,CAACsH,IAAL,EAAWA,OAAOpD,KAAKqD,GAAL,CAASxH,KAAKiB,EAAL,GAAUnB,MAAMmB,EAAzB,CAAP;AACX,UAAIsG,OAAOH,WAAX,EAAwB;AAAED,kBAAUnH,IAAV,CAAgBoH,cAAcG,IAAd;AAAqB;AAChE;AACD,QAAI,CAACJ,OAAL,EAAc,OAAO,IAAP;;AAEd,QAAIP,OAAOxG,MAAP,IAAiB,CAArB,EACE+G,QAAQlG,EAAR,IAAc2F,OAAO,CAAP,EAAUxG,MAAxB,CADF,KAGE+G,UAAUhI,IAAIgI,QAAQlH,IAAR,IAAgB2G,OAAOxG,MAAP,GAAgB,CAAhC,CAAJ,EAAwCwG,OAAOA,OAAOxG,MAAP,GAAgB,CAAvB,EAA0BA,MAAlE,CAAV;AACF,QAAIpD,KAAK8C,KAAL,CAAWG,IAAX,IAAmBjD,KAAKkD,GAAL,CAASD,IAAhC,EACE,IAAIC,MAAMf,IAAIgI,QAAQlH,IAAZ,EAAkBkH,QAAQlG,EAAR,IAAcjE,KAAKkD,GAAL,CAASe,EAAT,GAAcjE,KAAK8C,KAAL,CAAWmB,EAAvC,CAAlB,CAAV,CADF,KAGE,IAAIf,MAAMf,IAAIgI,QAAQlH,IAAR,IAAgBjD,KAAKkD,GAAL,CAASD,IAAT,GAAgBjD,KAAK8C,KAAL,CAAWG,IAA3C,CAAJ,EAAsDjD,KAAKkD,GAAL,CAASe,EAA/D,CAAV;AACF,WAAO,EAACnB,OAAOqH,OAAR,EAAiBjH,KAAKA,GAAtB,EAAP;AACD;;AAED,WAASoG,uBAAT,CAAiC1J,EAAjC,EAAqC;AACnC,QAAIqB,MAAMrB,GAAG2G,SAAH,CAAa,KAAb,CAAV;AAAA,QAA+BkE,MAAM7K,GAAG0G,UAAH,CAAcrF,GAAd,CAArC;AACA,QAAIwJ,IAAI3H,KAAJ,GAAY7B,IAAIgD,EAAhB,KAAuBwG,IAAIjH,IAAJ,IAAY,SAAZ,IAAyBiH,IAAIjH,IAAJ,IAAY,QAA5D,CAAJ,EAA2E,OAAO,KAAP;AAC3E,WAAO,MAAK+B,IAAL,CAAU3F,GAAG0H,OAAH,CAAWrG,IAAIgC,IAAf,EAAqB2F,KAArB,CAA2BzB,KAAKC,GAAL,CAASnG,IAAIgD,EAAJ,GAAS,CAAlB,EAAqB,CAArB,CAA3B,EAAoDhD,IAAIgD,EAAJ,GAAS,CAA7D,CAAV;AAAP;AACD;;AAED;;AAEA,WAAS1C,OAAT,CAAgBe,EAAhB,EAAoB1C,EAApB,EAAwB;AACtB,QAAI8K,QAAQ9K,GAAG0G,UAAH,CAAc1G,GAAG2G,SAAH,EAAd,CAAZ;AACA,QAAI,CAAC,KAAKhB,IAAL,CAAUmF,MAAMC,MAAhB,CAAL,EAA8B,OAAO9G,UAAUvB,EAAV,EAAc1C,EAAd,EAAkB,mBAAlB,CAAP;AAC9B2J,WAAO3J,EAAP,EAAW,kBAAkB8K,MAAMC,MAAnC,EAA2C,UAASC,OAAT,EAAkB;AAC3DtI,SAAGb,OAAH,CAAW7B,EAAX,EAAe,EAAC4D,MAAM,QAAP,EAAiBoH,SAASA,OAA1B,EAAmCC,UAAU,IAA7C,EAAf,EAAmE,UAAS/I,KAAT,EAAgB9B,IAAhB,EAAsB;AACvF,YAAI8B,KAAJ,EAAW,OAAO+B,UAAUvB,EAAV,EAAc1C,EAAd,EAAkBkC,KAAlB,CAAP;AACXgJ,qBAAaxI,EAAb,EAAiBtC,KAAK+K,OAAtB;AACD,OAHD;AAID,KALD;AAMD;;AAED,WAASvJ,WAAT,CAAoBc,EAApB,EAAwB1C,EAAxB,EAA4B;AAC1B,QAAId,OAAO6C,QAAQW,EAAR,EAAY1C,GAAGN,GAAf,EAAoBR,IAA/B;AACAwD,OAAGb,OAAH,CAAW7B,EAAX,EAAe,EAAC4D,MAAM,MAAP,EAAf,EAA+B,UAAS1B,KAAT,EAAgB9B,IAAhB,EAAsB;AACnD,UAAI8B,KAAJ,EAAW,OAAO+B,UAAUvB,EAAV,EAAc1C,EAAd,EAAkBkC,KAAlB,CAAP;AACX,UAAIkJ,SAAS,EAAb;AAAA,UAAiBvI,MAAM,CAAvB;AACA,WAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI1C,KAAKiL,IAAL,CAAU7H,MAA9B,EAAsCV,GAAtC,EAA2C;AACzC,YAAIwI,MAAMlL,KAAKiL,IAAL,CAAUvI,CAAV,CAAV;AACA,YAAIwI,IAAIjC,IAAJ,IAAYnK,IAAhB,EAAsB;AACpBkM,iBAAO1G,IAAP,CAAY,EAAC6G,QAAQD,IAAIpI,KAAb,EAAoBsI,MAAMF,IAAIhI,GAA9B,EAAZ;AACA,cAAIL,OAAOJ,GAAP,EAAYyI,IAAIpI,KAAhB,KAA0B,CAA1B,IAA+BD,OAAOJ,GAAP,EAAYyI,IAAIhI,GAAhB,KAAwB,CAA3D,EACET,MAAMuI,OAAO5H,MAAP,GAAgB,CAAtB;AACH;AACF;AACDxD,SAAGyL,aAAH,CAAiBL,MAAjB,EAAyBvI,GAAzB;AACD,KAZD;AAaD;;AAED,MAAI6I,iBAAiB,CAArB;AACA,WAASR,YAAT,CAAsBxI,EAAtB,EAA0ByI,OAA1B,EAAmC;AACjC,QAAIQ,UAAUpM,OAAOC,MAAP,CAAc,IAAd,CAAd;AACA,SAAK,IAAIsD,IAAI,CAAb,EAAgBA,IAAIqI,QAAQ3H,MAA5B,EAAoC,EAAEV,CAAtC,EAAyC;AACvC,UAAIuB,KAAK8G,QAAQrI,CAAR,CAAT;AACA,OAAC6I,QAAQtH,GAAGgF,IAAX,MAAqBsC,QAAQtH,GAAGgF,IAAX,IAAmB,EAAxC,CAAD,EAA8C3E,IAA9C,CAAmDL,EAAnD;AACD;AACD,SAAK,IAAIgF,IAAT,IAAiBsC,OAAjB,EAA0B;AACxB,UAAIC,QAAQlJ,GAAGpD,IAAH,CAAQ+J,IAAR,CAAZ;AAAA,UAA2BwC,MAAMF,QAAQtC,IAAR,CAAjC,CAA+C;AAC/C,UAAI,CAACuC,KAAL,EAAY;AACZC,UAAIC,IAAJ,CAAS,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAAE,eAAO/I,OAAO+I,EAAE9I,KAAT,EAAgB6I,EAAE7I,KAAlB,CAAP;AAAkC,OAA5D;AACA,UAAI+I,SAAS,YAAa,EAAEP,cAA5B;AACA,WAAK,IAAI5I,IAAI,CAAb,EAAgBA,IAAI+I,IAAIrI,MAAxB,EAAgC,EAAEV,CAAlC,EAAqC;AACnC,YAAIuB,KAAKwH,IAAI/I,CAAJ,CAAT;AACA8I,cAAMlM,GAAN,CAAUwM,YAAV,CAAuB7H,GAAGd,IAA1B,EAAgCc,GAAGnB,KAAnC,EAA0CmB,GAAGf,GAA7C,EAAkD2I,MAAlD;AACD;AACF;AACF;;AAED;;AAEA,WAAShK,YAAT,CAAsBS,EAAtB,EAA0BhD,GAA1B,EAA+BoC,KAA/B,EAAsCT,GAAtC,EAA2C;AACzC,QAAIsC,QAAQ,EAAZ;AAAA,QAAgBwI,cAAc,CAA9B;AAAA,QAAiCC,iBAAiB,CAACtK,MAAMmJ,QAAzD;AACA,QAAI,CAACmB,cAAL,EAAqB,OAAOtK,MAAMmJ,QAAb;AACrB,QAAI,OAAOnJ,KAAP,IAAgB,QAApB,EAA8BA,QAAQ,EAAC8B,MAAM9B,KAAP,EAAR;AAC9BA,UAAMuK,iBAAN,GAA0B,IAA1B;AACA,QAAIvK,MAAMwB,GAAN,IAAa,IAAjB,EAAuB;AACrBxB,YAAMwB,GAAN,GAAYjC,OAAO3B,IAAIA,GAAJ,CAAQiH,SAAR,CAAkB,KAAlB,CAAnB;AACA,UAAIjH,IAAIA,GAAJ,CAAQ8G,iBAAR,EAAJ,EACE1E,MAAMoB,KAAN,GAAcxD,IAAIA,GAAJ,CAAQiH,SAAR,CAAkB,OAAlB,CAAd;AACH;AACD,QAAI2F,WAAWxK,MAAMoB,KAAN,IAAepB,MAAMwB,GAApC;;AAEA,QAAI5D,IAAIW,OAAR,EAAiB;AACf,UAAIX,IAAIA,GAAJ,CAAQ+D,SAAR,KAAsBhB,MAAtB,IAAgC2J,mBAAmB,KAAnD,IACA1M,IAAIW,OAAJ,CAAY8C,EAAZ,GAAiBzD,IAAIW,OAAJ,CAAY+C,IAA7B,GAAoC,GADpC,IAEA1D,IAAIW,OAAJ,CAAY+C,IAAZ,IAAoBkJ,SAASjJ,IAF7B,IAEqC3D,IAAIW,OAAJ,CAAY8C,EAAZ,GAAiBrB,MAAMwB,GAAN,CAAUD,IAFpE,EAE0E;AACxEM,cAAMe,IAAN,CAAW6H,kBAAkB7M,GAAlB,EAAuB4M,QAAvB,EAAiCxK,MAAMwB,GAAvC,CAAX;AACAxB,cAAMuH,IAAN,GAAa,IAAb;AACA,YAAI8C,cAAcxI,MAAM,CAAN,EAASwI,WAA3B;AACA,YAAIrK,MAAMoB,KAAN,IAAe,IAAnB,EAAyBpB,MAAMoB,KAAN,GAAcX,IAAIT,MAAMoB,KAAN,CAAYG,IAAZ,GAAmB,CAAC8I,WAAxB,EAAqCrK,MAAMoB,KAAN,CAAYmB,EAAjD,CAAd;AACzBvC,cAAMwB,GAAN,GAAYf,IAAIT,MAAMwB,GAAN,CAAUD,IAAV,GAAiB8I,WAArB,EAAkCrK,MAAMwB,GAAN,CAAUe,EAA5C,CAAZ;AACD,OARD,MAQO;AACLV,cAAMe,IAAN,CAAW,EAACd,MAAM,MAAP;AACC1E,gBAAMQ,IAAIR,IADX;AAECqE,gBAAMhD,SAASmC,EAAT,EAAahD,GAAb,CAFP,EAAX;AAGAoC,cAAMuH,IAAN,GAAa3J,IAAIR,IAAjB;AACAQ,YAAIW,OAAJ,GAAc,IAAd;AACD;AACF,KAhBD,MAgBO;AACLyB,YAAMuH,IAAN,GAAa3J,IAAIR,IAAjB;AACD;AACD,SAAK,IAAIA,IAAT,IAAiBwD,GAAGpD,IAApB,EAA0B;AACxB,UAAIuD,MAAMH,GAAGpD,IAAH,CAAQJ,IAAR,CAAV;AACA,UAAI2D,IAAIxC,OAAJ,IAAewC,OAAOnD,GAA1B,EAA+B;AAC7BiE,cAAMe,IAAN,CAAW,EAACd,MAAM,MAAP,EAAe1E,MAAM2D,IAAI3D,IAAzB,EAA+BqE,MAAMhD,SAASmC,EAAT,EAAaG,GAAb,CAArC,EAAX;AACAA,YAAIxC,OAAJ,GAAc,IAAd;AACD;AACF;;AAED,WAAO,EAACyB,OAAOA,KAAR,EAAe6B,OAAOA,KAAtB,EAAP;AACD;;AAED,WAAS4I,iBAAT,CAA2BnM,IAA3B,EAAiC8C,KAAjC,EAAwCI,GAAxC,EAA6C;AAC3C,QAAI5D,MAAMU,KAAKV,GAAf;AACA,QAAI8M,YAAY,IAAhB;AAAA,QAAsBC,UAAU,IAAhC;AAAA,QAAsCC,OAAtC;AAAA,QAA+CtF,UAAU,CAAzD;AACA,SAAK,IAAIuF,IAAIzJ,MAAMG,IAAN,GAAa,CAArB,EAAwBuJ,MAAMrF,KAAKC,GAAL,CAAS,CAAT,EAAYmF,IAAI,EAAhB,CAAnC,EAAwDA,KAAKC,GAA7D,EAAkE,EAAED,CAApE,EAAuE;AACrE,UAAItJ,OAAO3D,IAAIgI,OAAJ,CAAYiF,CAAZ,CAAX;AAAA,UAA2BE,KAAKxJ,KAAKyJ,MAAL,CAAY,cAAZ,CAAhC;AACA,UAAID,KAAK,CAAT,EAAY;AACZ,UAAIE,SAASzO,WAAW0O,WAAX,CAAuB3J,IAAvB,EAA6B,IAA7B,EAAmC+D,OAAnC,CAAb;AACA,UAAIoF,aAAa,IAAb,IAAqBA,aAAaO,MAAtC,EAA8C;AAC9CP,kBAAYO,MAAZ;AACAN,gBAAUE,CAAV;AACD;AACD,QAAIF,WAAW,IAAf,EAAqBA,UAAUG,GAAV;AACrB,QAAIpF,MAAMD,KAAKqF,GAAL,CAASlN,IAAIuN,QAAJ,EAAT,EAAyB3J,IAAID,IAAJ,GAAW,EAApC,CAAV;AACA,QAAImJ,aAAa,IAAb,IAAqBA,aAAalO,WAAW0O,WAAX,CAAuBtN,IAAIgI,OAAJ,CAAYxE,MAAMG,IAAlB,CAAvB,EAAgD,IAAhD,EAAsD+D,OAAtD,CAAtC,EACEsF,UAAUlF,GAAV,CADF,KAEK,KAAKkF,UAAUpJ,IAAID,IAAJ,GAAW,CAA1B,EAA6BqJ,UAAUlF,GAAvC,EAA4C,EAAEkF,OAA9C,EAAuD;AAC1D,UAAIK,SAASzO,WAAW0O,WAAX,CAAuBtN,IAAIgI,OAAJ,CAAYgF,OAAZ,CAAvB,EAA6C,IAA7C,EAAmDtF,OAAnD,CAAb;AACA,UAAI2F,UAAUP,SAAd,EAAyB;AAC1B;AACD,QAAIpJ,OAAOb,IAAIkK,OAAJ,EAAa,CAAb,CAAX;;AAEA,WAAO,EAAC7I,MAAM,MAAP;AACC1E,YAAMkB,KAAKlB,IADZ;AAECiN,mBAAa/I,KAAKC,IAFnB;AAGCE,YAAM7D,IAAI0E,QAAJ,CAAahB,IAAb,EAAmBb,IAAImK,OAAJ,EAAa,CAAb,CAAnB,CAHP,EAAP;AAID;;AAED;;AAEA,MAAIzJ,SAAS3E,WAAW2E,MAAxB;;AAEA,WAAS8C,GAAT,CAAamH,OAAb,EAAsB1K,GAAtB,CAA0B,cAA1B,EAA0C;AACxC,QAAI8E,IAAIrB,SAASkH,aAAT,CAAuBD,OAAvB,CAAR;AACA,QAAI1K,GAAJ,EAAS8E,EAAE/C,SAAF,GAAc/B,GAAd;AACT,SAAK,IAAIM,IAAI,CAAb,EAAgBA,IAAIsK,UAAU5J,MAA9B,EAAsC,EAAEV,CAAxC,EAA2C;AACzC,UAAIiD,MAAMqH,UAAUtK,CAAV,CAAV;AACA,UAAI,OAAOiD,GAAP,IAAc,QAAlB,EAA4BA,MAAME,SAASC,cAAT,CAAwBH,GAAxB,CAAN;AAC5BuB,QAAEtB,WAAF,CAAcD,GAAd;AACD;AACD,WAAOuB,CAAP;AACD;;AAED,WAASqC,MAAT,CAAgB3J,EAAhB,EAAoBuD,IAApB,EAA0B8J,CAA1B,EAA6B;AAC3B,QAAIrN,GAAGsN,UAAP,EACEtN,GAAGsN,UAAH,CAAc/J,OAAO,qBAArB,EAA4C8J,CAA5C,EADF,KAGEA,EAAEE,OAAOhK,IAAP,EAAa,EAAb,CAAF;AACH;;AAED;;AAEA,WAASgD,WAAT,CAAqBvG,EAArB,EAAyBiF,OAAzB,EAAkC;AAChC,QAAIjF,GAAGyG,KAAH,CAAS+G,WAAb,EAA0BzI,OAAO/E,GAAGyG,KAAH,CAAS+G,WAAhB;AAC1B,QAAIC,QAAQzN,GAAG0I,YAAH,EAAZ;AACA,QAAI5C,MAAM9F,GAAGyG,KAAH,CAAS+G,WAAT,GAAuBrI,YAAYsI,MAAMnI,KAAN,GAAc,CAA1B,EAA6BmI,MAAM9E,MAAnC,EAA2C1D,OAA3C,CAAjC;AACA,aAASyI,UAAT,GAAsB;AACpBC,YAAM,IAAN;AACA,UAAI,CAACC,UAAL,EAAiBC;AAClB;AACD,aAASA,KAAT,GAAiB;AACf7N,SAAGyG,KAAH,CAAS+G,WAAT,GAAuB,IAAvB;AACA,UAAI,CAAC1H,IAAIV,UAAT,EAAqB;AACrBpF,SAAGa,GAAH,CAAO,gBAAP,EAAyBgN,KAAzB;AACA7N,SAAGa,GAAH,CAAO,MAAP,EAAegN,KAAf;AACA7N,SAAGa,GAAH,CAAO,QAAP,EAAiBgN,KAAjB;AACAC,cAAQhI,GAAR;AACD;AACD,QAAI8H,aAAa,KAAjB;AAAA,QAAwBD,MAAM,KAA9B;AACArP,eAAWkC,EAAX,CAAcsF,GAAd,EAAmB,WAAnB,EAAgC,YAAW;AAAE8H,mBAAa,IAAb;AAAoB,KAAjE;AACAtP,eAAWkC,EAAX,CAAcsF,GAAd,EAAmB,UAAnB,EAA+B,UAASwB,CAAT,EAAY;AACzC,UAAI,CAAChJ,WAAWyP,QAAX,CAAoBjI,GAApB,EAAyBwB,EAAE0G,aAAF,IAAmB1G,EAAE2G,SAA9C,CAAL,EAA+D;AAC7D,YAAIN,GAAJ,EAASE,QAAT,KACKD,aAAa,KAAb;AACN;AACF,KALD;AAMAlK,eAAWgK,UAAX,EAAuB,IAAvB;AACA1N,OAAGQ,EAAH,CAAM,gBAAN,EAAwBqN,KAAxB;AACA7N,OAAGQ,EAAH,CAAM,MAAN,EAAcqN,KAAd;AACA7N,OAAGQ,EAAH,CAAM,QAAN,EAAgBqN,KAAhB;AACD;;AAED,WAAS1I,WAAT,CAAqB+I,CAArB,EAAwBC,CAAxB,EAA2BlJ,OAA3B,EAAoC;AAClC,QAAID,OAAOe,IAAI,KAAJ,EAAWvD,MAAM,SAAjB,EAA4ByC,OAA5B,CAAX;AACAD,SAAKoJ,KAAL,CAAWC,IAAX,GAAkBH,IAAI,IAAtB;AACAlJ,SAAKoJ,KAAL,CAAW5I,GAAX,GAAiB2I,IAAI,IAArB;AACAlI,aAASqI,IAAT,CAActI,WAAd,CAA0BhB,IAA1B;AACA,WAAOA,IAAP;AACD;;AAED,WAASD,MAAT,CAAgBC,IAAhB,EAAsB;AACpB,QAAI2H,IAAI3H,QAAQA,KAAKI,UAArB;AACA,QAAIuH,CAAJ,EAAOA,EAAE4B,WAAF,CAAcvJ,IAAd;AACR;;AAED,WAAS8I,OAAT,CAAiBhJ,OAAjB,EAA0B;AACxBA,YAAQsJ,KAAR,CAAcI,OAAd,GAAwB,GAAxB;AACA9K,eAAW,YAAW;AAAEqB,aAAOD,OAAP;AAAkB,KAA1C,EAA4C,IAA5C;AACD;;AAED,WAASb,SAAT,CAAmBvB,EAAnB,EAAuB1C,EAAvB,EAA2ByO,GAA3B,EAAgC;AAC9B,QAAI/L,GAAGlE,OAAH,CAAWyF,SAAf,EACEvB,GAAGlE,OAAH,CAAWyF,SAAX,CAAqBjE,EAArB,EAAyByO,GAAzB,EADF,KAGElI,YAAYvG,EAAZ,EAAgB0O,OAAOD,GAAP,CAAhB;AACH;;AAED,WAASzN,aAAT,CAAuB0B,EAAvB,EAA2B;AACzB,QAAIA,GAAG7C,cAAP,EAAuB;AAAEkF,aAAOrC,GAAG7C,cAAV,EAA2B6C,GAAG7C,cAAH,GAAoB,IAApB;AAA2B;AAChF;;AAED,WAASU,QAAT,CAAkBmC,EAAlB,EAAsBhD,GAAtB,EAA2B;AACzB,QAAIiP,MAAMjP,IAAIA,GAAJ,CAAQkP,QAAR,EAAV;AACA,QAAIlM,GAAGlE,OAAH,CAAWqQ,UAAf,EAA2BF,MAAMjM,GAAGlE,OAAH,CAAWqQ,UAAX,CAAsBF,GAAtB,EAA2BjP,IAAIR,IAA/B,EAAqCQ,IAAIA,GAAzC,CAAN;AAC3B,WAAOiP,GAAP;AACD;;AAED;;AAEA,WAAS7P,YAAT,CAAsB4D,EAAtB,EAA0B;AACxB,QAAIL,SAASK,GAAGL,MAAH,GAAY,IAAIyM,MAAJ,CAAWpM,GAAGlE,OAAH,CAAWuQ,YAAtB,CAAzB;AACA1M,WAAO2M,WAAP,CAAmB,EAACpL,MAAM,MAAP;AACCvE,YAAMqD,GAAGlE,OAAH,CAAWa,IADlB;AAECX,eAASgE,GAAGlE,OAAH,CAAWE,OAFrB;AAGCuQ,eAASvM,GAAGlE,OAAH,CAAW0Q,UAHrB,EAAnB;AAIA,QAAIC,QAAQ,CAAZ;AAAA,QAAeC,UAAU,EAAzB;;AAEA,aAASC,IAAT,CAAcjP,IAAd,EAAoBjB,CAApB,EAAuB;AACrB,UAAIA,CAAJ,EAAO;AACLiB,aAAKM,EAAL,GAAU,EAAEyO,KAAZ;AACAC,gBAAQD,KAAR,IAAiBhQ,CAAjB;AACD;AACDkD,aAAO2M,WAAP,CAAmB5O,IAAnB;AACD;AACDiC,WAAOiN,SAAP,GAAmB,UAAShI,CAAT,EAAY;AAC7B,UAAIlH,OAAOkH,EAAElH,IAAb;AACA,UAAIA,KAAKwD,IAAL,IAAa,SAAjB,EAA4B;AAC1B3E,iBAAQyD,EAAR,EAAYtC,KAAKlB,IAAjB,EAAuB,UAASqQ,GAAT,EAAchM,IAAd,EAAoB;AACzC8L,eAAK,EAACzL,MAAM,SAAP,EAAkB2L,KAAKb,OAAOa,GAAP,CAAvB,EAAoChM,MAAMA,IAA1C,EAAgD7C,IAAIN,KAAKM,EAAzD,EAAL;AACD,SAFD;AAGD,OAJD,MAIO,IAAIN,KAAKwD,IAAL,IAAa,OAAjB,EAA0B;AAC/BC,eAAOC,OAAP,CAAe0L,GAAf,CAAmBpP,KAAKqP,OAAxB;AACD,OAFM,MAEA,IAAIrP,KAAKM,EAAL,IAAW0O,QAAQhP,KAAKM,EAAb,CAAf,EAAiC;AACtC0O,gBAAQhP,KAAKM,EAAb,EAAiBN,KAAKmP,GAAtB,EAA2BnP,KAAKkO,IAAhC;AACA,eAAOc,QAAQhP,KAAKM,EAAb,CAAP;AACD;AACF,KAZD;AAaA2B,WAAOqN,OAAP,GAAiB,UAASpI,CAAT,EAAY;AAC3B,WAAK,IAAI5G,EAAT,IAAe0O,OAAf;AAAwBA,gBAAQ1O,EAAR,EAAY4G,CAAZ;AAAxB,OACA8H,UAAU,EAAV;AACD,KAHD;;AAKA,SAAK9O,OAAL,GAAe,UAASpB,IAAT,EAAeqE,IAAf,EAAqB;AAAE8L,WAAK,EAACzL,MAAM,KAAP,EAAc1E,MAAMA,IAApB,EAA0BqE,MAAMA,IAAhC,EAAL;AAA8C,KAApF;AACA,SAAKzC,OAAL,GAAe,UAAS5B,IAAT,EAAe;AAAEmQ,WAAK,EAACzL,MAAM,KAAP,EAAc1E,MAAMA,IAApB,EAAL;AAAkC,KAAlE;AACA,SAAK2C,OAAL,GAAe,UAASyM,IAAT,EAAenP,CAAf,EAAkB;AAAEkQ,WAAK,EAACzL,MAAM,KAAP,EAAc0K,MAAMA,IAApB,EAAL,EAAgCnP,CAAhC;AAAqC,KAAxE;AACD;AACF,CA3oBD","file":"tern.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n// Glue code between CodeMirror and Tern.\n//\n// Create a CodeMirror.TernServer to wrap an actual Tern server,\n// register open documents (CodeMirror.Doc instances) with it, and\n// call its methods to activate the assisting functions that Tern\n// provides.\n//\n// Options supported (all optional):\n// * defs: An array of JSON definition data structures.\n// * plugins: An object mapping plugin names to configuration\n//   options.\n// * getFile: A function(name, c) that can be used to access files in\n//   the project that haven't been loaded yet. Simply do c(null) to\n//   indicate that a file is not available.\n// * fileFilter: A function(value, docName, doc) that will be applied\n//   to documents before passing them on to Tern.\n// * switchToDoc: A function(name, doc) that should, when providing a\n//   multi-file view, switch the view or focus to the named file.\n// * showError: A function(editor, message) that can be used to\n//   override the way errors are displayed.\n// * completionTip: Customize the content in tooltips for completions.\n//   Is passed a single argument—the completion's data as returned by\n//   Tern—and may return a string, DOM node, or null to indicate that\n//   no tip should be shown. By default the docstring is shown.\n// * typeTip: Like completionTip, but for the tooltips shown for type\n//   queries.\n// * responseFilter: A function(doc, query, request, error, data) that\n//   will be applied to the Tern responses before treating them\n//\n//\n// It is possible to run the Tern server in a web worker by specifying\n// these additional options:\n// * useWorker: Set to true to enable web worker mode. You'll probably\n//   want to feature detect the actual value you use here, for example\n//   !!window.Worker.\n// * workerScript: The main script of the worker. Point this to\n//   wherever you are hosting worker.js from this directory.\n// * workerDeps: An array of paths pointing (relative to workerScript)\n//   to the Acorn and Tern libraries and any Tern plugins you want to\n//   load. Or, if you minified those into a single script and included\n//   them in the workerScript, simply leave this undefined.\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n  // declare global: tern\n\n  CodeMirror.TernServer = function(options) {\n    var self = this;\n    this.options = options || {};\n    var plugins = this.options.plugins || (this.options.plugins = {});\n    if (!plugins.doc_comment) plugins.doc_comment = true;\n    if (this.options.useWorker) {\n      this.server = new WorkerServer(this);\n    } else {\n      this.server = new tern.Server({\n        getFile: function(name, c) { return getFile(self, name, c); },\n        async: true,\n        defs: this.options.defs || [],\n        plugins: plugins\n      });\n    }\n    this.docs = Object.create(null);\n    this.trackChange = function(doc, change) { trackChange(self, doc, change); };\n\n    this.cachedArgHints = null;\n    this.activeArgHints = null;\n    this.jumpStack = [];\n\n    this.getHint = function(cm, c) { return hint(self, cm, c); };\n    this.getHint.async = true;\n  };\n\n  CodeMirror.TernServer.prototype = {\n    addDoc: function(name, doc) {\n      var data = {doc: doc, name: name, changed: null};\n      this.server.addFile(name, docValue(this, data));\n      CodeMirror.on(doc, \"change\", this.trackChange);\n      return this.docs[name] = data;\n    },\n\n    delDoc: function(id) {\n      var found = resolveDoc(this, id);\n      if (!found) return;\n      CodeMirror.off(found.doc, \"change\", this.trackChange);\n      delete this.docs[found.name];\n      this.server.delFile(found.name);\n    },\n\n    hideDoc: function(id) {\n      closeArgHints(this);\n      var found = resolveDoc(this, id);\n      if (found && found.changed) sendDoc(this, found);\n    },\n\n    complete: function(cm) {\n      cm.showHint({hint: this.getHint});\n    },\n\n    showType: function(cm, pos, c) { showContextInfo(this, cm, pos, \"type\", c); },\n\n    showDocs: function(cm, pos, c) { showContextInfo(this, cm, pos, \"documentation\", c); },\n\n    updateArgHints: function(cm) { updateArgHints(this, cm); },\n\n    jumpToDef: function(cm) { jumpToDef(this, cm); },\n\n    jumpBack: function(cm) { jumpBack(this, cm); },\n\n    rename: function(cm) { rename(this, cm); },\n\n    selectName: function(cm) { selectName(this, cm); },\n\n    request: function (cm, query, c, pos) {\n      var self = this;\n      var doc = findDoc(this, cm.getDoc());\n      var request = buildRequest(this, doc, query, pos);\n\n      this.server.request(request, function (error, data) {\n        if (!error && self.options.responseFilter)\n          data = self.options.responseFilter(doc, query, request, error, data);\n        c(error, data);\n      });\n    },\n\n    destroy: function () {\n      if (this.worker) {\n        this.worker.terminate();\n        this.worker = null;\n      }\n    }\n  };\n\n  var Pos = CodeMirror.Pos;\n  var cls = \"CodeMirror-Tern-\";\n  var bigDoc = 250;\n\n  function getFile(ts, name, c) {\n    var buf = ts.docs[name];\n    if (buf)\n      c(docValue(ts, buf));\n    else if (ts.options.getFile)\n      ts.options.getFile(name, c);\n    else\n      c(null);\n  }\n\n  function findDoc(ts, doc, name) {\n    for (var n in ts.docs) {\n      var cur = ts.docs[n];\n      if (cur.doc == doc) return cur;\n    }\n    if (!name) for (var i = 0;; ++i) {\n      n = \"[doc\" + (i || \"\") + \"]\";\n      if (!ts.docs[n]) { name = n; break; }\n    }\n    return ts.addDoc(name, doc);\n  }\n\n  function resolveDoc(ts, id) {\n    if (typeof id == \"string\") return ts.docs[id];\n    if (id instanceof CodeMirror) id = id.getDoc();\n    if (id instanceof CodeMirror.Doc) return findDoc(ts, id);\n  }\n\n  function trackChange(ts, doc, change) {\n    var data = findDoc(ts, doc);\n\n    var argHints = ts.cachedArgHints;\n    if (argHints && argHints.doc == doc && cmpPos(argHints.start, change.to) <= 0)\n      ts.cachedArgHints = null;\n\n    var changed = data.changed;\n    if (changed == null)\n      data.changed = changed = {from: change.from.line, to: change.from.line};\n    var end = change.from.line + (change.text.length - 1);\n    if (change.from.line < changed.to) changed.to = changed.to - (change.to.line - end);\n    if (end >= changed.to) changed.to = end + 1;\n    if (changed.from > change.from.line) changed.from = change.from.line;\n\n    if (doc.lineCount() > bigDoc && change.to - changed.from > 100) setTimeout(function() {\n      if (data.changed && data.changed.to - data.changed.from > 100) sendDoc(ts, data);\n    }, 200);\n  }\n\n  function sendDoc(ts, doc) {\n    ts.server.request({files: [{type: \"full\", name: doc.name, text: docValue(ts, doc)}]}, function(error) {\n      if (error) window.console.error(error);\n      else doc.changed = null;\n    });\n  }\n\n  // Completion\n\n  function hint(ts, cm, c) {\n    ts.request(cm, {type: \"completions\", types: true, docs: true, urls: true}, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      var completions = [], after = \"\";\n      var from = data.start, to = data.end;\n      if (cm.getRange(Pos(from.line, from.ch - 2), from) == \"[\\\"\" &&\n          cm.getRange(to, Pos(to.line, to.ch + 2)) != \"\\\"]\")\n        after = \"\\\"]\";\n\n      for (var i = 0; i < data.completions.length; ++i) {\n        var completion = data.completions[i], className = typeToIcon(completion.type);\n        if (data.guess) className += \" \" + cls + \"guess\";\n        completions.push({text: completion.name + after,\n                          displayText: completion.name,\n                          className: className,\n                          data: completion});\n      }\n\n      var obj = {from: from, to: to, list: completions};\n      var tooltip = null;\n      CodeMirror.on(obj, \"close\", function() { remove(tooltip); });\n      CodeMirror.on(obj, \"update\", function() { remove(tooltip); });\n      CodeMirror.on(obj, \"select\", function(cur, node) {\n        remove(tooltip);\n        var content = ts.options.completionTip ? ts.options.completionTip(cur.data) : cur.data.doc;\n        if (content) {\n          tooltip = makeTooltip(node.parentNode.getBoundingClientRect().right + window.pageXOffset,\n                                node.getBoundingClientRect().top + window.pageYOffset, content);\n          tooltip.className += \" \" + cls + \"hint-doc\";\n        }\n      });\n      c(obj);\n    });\n  }\n\n  function typeToIcon(type) {\n    var suffix;\n    if (type == \"?\") suffix = \"unknown\";\n    else if (type == \"number\" || type == \"string\" || type == \"bool\") suffix = type;\n    else if (/^fn\\(/.test(type)) suffix = \"fn\";\n    else if (/^\\[/.test(type)) suffix = \"array\";\n    else suffix = \"object\";\n    return cls + \"completion \" + cls + \"completion-\" + suffix;\n  }\n\n  // Type queries\n\n  function showContextInfo(ts, cm, pos, queryName, c) {\n    ts.request(cm, queryName, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      if (ts.options.typeTip) {\n        var tip = ts.options.typeTip(data);\n      } else {\n        var tip = elt(\"span\", null, elt(\"strong\", null, data.type || \"not found\"));\n        if (data.doc)\n          tip.appendChild(document.createTextNode(\" — \" + data.doc));\n        if (data.url) {\n          tip.appendChild(document.createTextNode(\" \"));\n          var child = tip.appendChild(elt(\"a\", null, \"[docs]\"));\n          child.href = data.url;\n          child.target = \"_blank\";\n        }\n      }\n      tempTooltip(cm, tip);\n      if (c) c();\n    }, pos);\n  }\n\n  // Maintaining argument hints\n\n  function updateArgHints(ts, cm) {\n    closeArgHints(ts);\n\n    if (cm.somethingSelected()) return;\n    var state = cm.getTokenAt(cm.getCursor()).state;\n    var inner = CodeMirror.innerMode(cm.getMode(), state);\n    if (inner.mode.name != \"javascript\") return;\n    var lex = inner.state.lexical;\n    if (lex.info != \"call\") return;\n\n    var ch, argPos = lex.pos || 0, tabSize = cm.getOption(\"tabSize\");\n    for (var line = cm.getCursor().line, e = Math.max(0, line - 9), found = false; line >= e; --line) {\n      var str = cm.getLine(line), extra = 0;\n      for (var pos = 0;;) {\n        var tab = str.indexOf(\"\\t\", pos);\n        if (tab == -1) break;\n        extra += tabSize - (tab + extra) % tabSize - 1;\n        pos = tab + 1;\n      }\n      ch = lex.column - extra;\n      if (str.charAt(ch) == \"(\") {found = true; break;}\n    }\n    if (!found) return;\n\n    var start = Pos(line, ch);\n    var cache = ts.cachedArgHints;\n    if (cache && cache.doc == cm.getDoc() && cmpPos(start, cache.start) == 0)\n      return showArgHints(ts, cm, argPos);\n\n    ts.request(cm, {type: \"type\", preferFunction: true, end: start}, function(error, data) {\n      if (error || !data.type || !(/^fn\\(/).test(data.type)) return;\n      ts.cachedArgHints = {\n        start: pos,\n        type: parseFnType(data.type),\n        name: data.exprName || data.name || \"fn\",\n        guess: data.guess,\n        doc: cm.getDoc()\n      };\n      showArgHints(ts, cm, argPos);\n    });\n  }\n\n  function showArgHints(ts, cm, pos) {\n    closeArgHints(ts);\n\n    var cache = ts.cachedArgHints, tp = cache.type;\n    var tip = elt(\"span\", cache.guess ? cls + \"fhint-guess\" : null,\n                  elt(\"span\", cls + \"fname\", cache.name), \"(\");\n    for (var i = 0; i < tp.args.length; ++i) {\n      if (i) tip.appendChild(document.createTextNode(\", \"));\n      var arg = tp.args[i];\n      tip.appendChild(elt(\"span\", cls + \"farg\" + (i == pos ? \" \" + cls + \"farg-current\" : \"\"), arg.name || \"?\"));\n      if (arg.type != \"?\") {\n        tip.appendChild(document.createTextNode(\":\\u00a0\"));\n        tip.appendChild(elt(\"span\", cls + \"type\", arg.type));\n      }\n    }\n    tip.appendChild(document.createTextNode(tp.rettype ? \") ->\\u00a0\" : \")\"));\n    if (tp.rettype) tip.appendChild(elt(\"span\", cls + \"type\", tp.rettype));\n    var place = cm.cursorCoords(null, \"page\");\n    ts.activeArgHints = makeTooltip(place.right + 1, place.bottom, tip);\n  }\n\n  function parseFnType(text) {\n    var args = [], pos = 3;\n\n    function skipMatching(upto) {\n      var depth = 0, start = pos;\n      for (;;) {\n        var next = text.charAt(pos);\n        if (upto.test(next) && !depth) return text.slice(start, pos);\n        if (/[{\\[\\(]/.test(next)) ++depth;\n        else if (/[}\\]\\)]/.test(next)) --depth;\n        ++pos;\n      }\n    }\n\n    // Parse arguments\n    if (text.charAt(pos) != \")\") for (;;) {\n      var name = text.slice(pos).match(/^([^, \\(\\[\\{]+): /);\n      if (name) {\n        pos += name[0].length;\n        name = name[1];\n      }\n      args.push({name: name, type: skipMatching(/[\\),]/)});\n      if (text.charAt(pos) == \")\") break;\n      pos += 2;\n    }\n\n    var rettype = text.slice(pos).match(/^\\) -> (.*)$/);\n\n    return {args: args, rettype: rettype && rettype[1]};\n  }\n\n  // Moving to the definition of something\n\n  function jumpToDef(ts, cm) {\n    function inner(varName) {\n      var req = {type: \"definition\", variable: varName || null};\n      var doc = findDoc(ts, cm.getDoc());\n      ts.server.request(buildRequest(ts, doc, req), function(error, data) {\n        if (error) return showError(ts, cm, error);\n        if (!data.file && data.url) { window.open(data.url); return; }\n\n        if (data.file) {\n          var localDoc = ts.docs[data.file], found;\n          if (localDoc && (found = findContext(localDoc.doc, data))) {\n            ts.jumpStack.push({file: doc.name,\n                               start: cm.getCursor(\"from\"),\n                               end: cm.getCursor(\"to\")});\n            moveTo(ts, doc, localDoc, found.start, found.end);\n            return;\n          }\n        }\n        showError(ts, cm, \"Could not find a definition.\");\n      });\n    }\n\n    if (!atInterestingExpression(cm))\n      dialog(cm, \"Jump to variable\", function(name) { if (name) inner(name); });\n    else\n      inner();\n  }\n\n  function jumpBack(ts, cm) {\n    var pos = ts.jumpStack.pop(), doc = pos && ts.docs[pos.file];\n    if (!doc) return;\n    moveTo(ts, findDoc(ts, cm.getDoc()), doc, pos.start, pos.end);\n  }\n\n  function moveTo(ts, curDoc, doc, start, end) {\n    doc.doc.setSelection(start, end);\n    if (curDoc != doc && ts.options.switchToDoc) {\n      closeArgHints(ts);\n      ts.options.switchToDoc(doc.name, doc.doc);\n    }\n  }\n\n  // The {line,ch} representation of positions makes this rather awkward.\n  function findContext(doc, data) {\n    var before = data.context.slice(0, data.contextOffset).split(\"\\n\");\n    var startLine = data.start.line - (before.length - 1);\n    var start = Pos(startLine, (before.length == 1 ? data.start.ch : doc.getLine(startLine).length) - before[0].length);\n\n    var text = doc.getLine(startLine).slice(start.ch);\n    for (var cur = startLine + 1; cur < doc.lineCount() && text.length < data.context.length; ++cur)\n      text += \"\\n\" + doc.getLine(cur);\n    if (text.slice(0, data.context.length) == data.context) return data;\n\n    var cursor = doc.getSearchCursor(data.context, 0, false);\n    var nearest, nearestDist = Infinity;\n    while (cursor.findNext()) {\n      var from = cursor.from(), dist = Math.abs(from.line - start.line) * 10000;\n      if (!dist) dist = Math.abs(from.ch - start.ch);\n      if (dist < nearestDist) { nearest = from; nearestDist = dist; }\n    }\n    if (!nearest) return null;\n\n    if (before.length == 1)\n      nearest.ch += before[0].length;\n    else\n      nearest = Pos(nearest.line + (before.length - 1), before[before.length - 1].length);\n    if (data.start.line == data.end.line)\n      var end = Pos(nearest.line, nearest.ch + (data.end.ch - data.start.ch));\n    else\n      var end = Pos(nearest.line + (data.end.line - data.start.line), data.end.ch);\n    return {start: nearest, end: end};\n  }\n\n  function atInterestingExpression(cm) {\n    var pos = cm.getCursor(\"end\"), tok = cm.getTokenAt(pos);\n    if (tok.start < pos.ch && (tok.type == \"comment\" || tok.type == \"string\")) return false;\n    return /\\w/.test(cm.getLine(pos.line).slice(Math.max(pos.ch - 1, 0), pos.ch + 1));\n  }\n\n  // Variable renaming\n\n  function rename(ts, cm) {\n    var token = cm.getTokenAt(cm.getCursor());\n    if (!/\\w/.test(token.string)) return showError(ts, cm, \"Not at a variable\");\n    dialog(cm, \"New name for \" + token.string, function(newName) {\n      ts.request(cm, {type: \"rename\", newName: newName, fullDocs: true}, function(error, data) {\n        if (error) return showError(ts, cm, error);\n        applyChanges(ts, data.changes);\n      });\n    });\n  }\n\n  function selectName(ts, cm) {\n    var name = findDoc(ts, cm.doc).name;\n    ts.request(cm, {type: \"refs\"}, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      var ranges = [], cur = 0;\n      for (var i = 0; i < data.refs.length; i++) {\n        var ref = data.refs[i];\n        if (ref.file == name) {\n          ranges.push({anchor: ref.start, head: ref.end});\n          if (cmpPos(cur, ref.start) >= 0 && cmpPos(cur, ref.end) <= 0)\n            cur = ranges.length - 1;\n        }\n      }\n      cm.setSelections(ranges, cur);\n    });\n  }\n\n  var nextChangeOrig = 0;\n  function applyChanges(ts, changes) {\n    var perFile = Object.create(null);\n    for (var i = 0; i < changes.length; ++i) {\n      var ch = changes[i];\n      (perFile[ch.file] || (perFile[ch.file] = [])).push(ch);\n    }\n    for (var file in perFile) {\n      var known = ts.docs[file], chs = perFile[file];;\n      if (!known) continue;\n      chs.sort(function(a, b) { return cmpPos(b.start, a.start); });\n      var origin = \"*rename\" + (++nextChangeOrig);\n      for (var i = 0; i < chs.length; ++i) {\n        var ch = chs[i];\n        known.doc.replaceRange(ch.text, ch.start, ch.end, origin);\n      }\n    }\n  }\n\n  // Generic request-building helper\n\n  function buildRequest(ts, doc, query, pos) {\n    var files = [], offsetLines = 0, allowFragments = !query.fullDocs;\n    if (!allowFragments) delete query.fullDocs;\n    if (typeof query == \"string\") query = {type: query};\n    query.lineCharPositions = true;\n    if (query.end == null) {\n      query.end = pos || doc.doc.getCursor(\"end\");\n      if (doc.doc.somethingSelected())\n        query.start = doc.doc.getCursor(\"start\");\n    }\n    var startPos = query.start || query.end;\n\n    if (doc.changed) {\n      if (doc.doc.lineCount() > bigDoc && allowFragments !== false &&\n          doc.changed.to - doc.changed.from < 100 &&\n          doc.changed.from <= startPos.line && doc.changed.to > query.end.line) {\n        files.push(getFragmentAround(doc, startPos, query.end));\n        query.file = \"#0\";\n        var offsetLines = files[0].offsetLines;\n        if (query.start != null) query.start = Pos(query.start.line - -offsetLines, query.start.ch);\n        query.end = Pos(query.end.line - offsetLines, query.end.ch);\n      } else {\n        files.push({type: \"full\",\n                    name: doc.name,\n                    text: docValue(ts, doc)});\n        query.file = doc.name;\n        doc.changed = null;\n      }\n    } else {\n      query.file = doc.name;\n    }\n    for (var name in ts.docs) {\n      var cur = ts.docs[name];\n      if (cur.changed && cur != doc) {\n        files.push({type: \"full\", name: cur.name, text: docValue(ts, cur)});\n        cur.changed = null;\n      }\n    }\n\n    return {query: query, files: files};\n  }\n\n  function getFragmentAround(data, start, end) {\n    var doc = data.doc;\n    var minIndent = null, minLine = null, endLine, tabSize = 4;\n    for (var p = start.line - 1, min = Math.max(0, p - 50); p >= min; --p) {\n      var line = doc.getLine(p), fn = line.search(/\\bfunction\\b/);\n      if (fn < 0) continue;\n      var indent = CodeMirror.countColumn(line, null, tabSize);\n      if (minIndent != null && minIndent <= indent) continue;\n      minIndent = indent;\n      minLine = p;\n    }\n    if (minLine == null) minLine = min;\n    var max = Math.min(doc.lastLine(), end.line + 20);\n    if (minIndent == null || minIndent == CodeMirror.countColumn(doc.getLine(start.line), null, tabSize))\n      endLine = max;\n    else for (endLine = end.line + 1; endLine < max; ++endLine) {\n      var indent = CodeMirror.countColumn(doc.getLine(endLine), null, tabSize);\n      if (indent <= minIndent) break;\n    }\n    var from = Pos(minLine, 0);\n\n    return {type: \"part\",\n            name: data.name,\n            offsetLines: from.line,\n            text: doc.getRange(from, Pos(endLine, 0))};\n  }\n\n  // Generic utilities\n\n  var cmpPos = CodeMirror.cmpPos;\n\n  function elt(tagname, cls /*, ... elts*/) {\n    var e = document.createElement(tagname);\n    if (cls) e.className = cls;\n    for (var i = 2; i < arguments.length; ++i) {\n      var elt = arguments[i];\n      if (typeof elt == \"string\") elt = document.createTextNode(elt);\n      e.appendChild(elt);\n    }\n    return e;\n  }\n\n  function dialog(cm, text, f) {\n    if (cm.openDialog)\n      cm.openDialog(text + \": <input type=text>\", f);\n    else\n      f(prompt(text, \"\"));\n  }\n\n  // Tooltips\n\n  function tempTooltip(cm, content) {\n    if (cm.state.ternTooltip) remove(cm.state.ternTooltip);\n    var where = cm.cursorCoords();\n    var tip = cm.state.ternTooltip = makeTooltip(where.right + 1, where.bottom, content);\n    function maybeClear() {\n      old = true;\n      if (!mouseOnTip) clear();\n    }\n    function clear() {\n      cm.state.ternTooltip = null;\n      if (!tip.parentNode) return;\n      cm.off(\"cursorActivity\", clear);\n      cm.off('blur', clear);\n      cm.off('scroll', clear);\n      fadeOut(tip);\n    }\n    var mouseOnTip = false, old = false;\n    CodeMirror.on(tip, \"mousemove\", function() { mouseOnTip = true; });\n    CodeMirror.on(tip, \"mouseout\", function(e) {\n      if (!CodeMirror.contains(tip, e.relatedTarget || e.toElement)) {\n        if (old) clear();\n        else mouseOnTip = false;\n      }\n    });\n    setTimeout(maybeClear, 1700);\n    cm.on(\"cursorActivity\", clear);\n    cm.on('blur', clear);\n    cm.on('scroll', clear);\n  }\n\n  function makeTooltip(x, y, content) {\n    var node = elt(\"div\", cls + \"tooltip\", content);\n    node.style.left = x + \"px\";\n    node.style.top = y + \"px\";\n    document.body.appendChild(node);\n    return node;\n  }\n\n  function remove(node) {\n    var p = node && node.parentNode;\n    if (p) p.removeChild(node);\n  }\n\n  function fadeOut(tooltip) {\n    tooltip.style.opacity = \"0\";\n    setTimeout(function() { remove(tooltip); }, 1100);\n  }\n\n  function showError(ts, cm, msg) {\n    if (ts.options.showError)\n      ts.options.showError(cm, msg);\n    else\n      tempTooltip(cm, String(msg));\n  }\n\n  function closeArgHints(ts) {\n    if (ts.activeArgHints) { remove(ts.activeArgHints); ts.activeArgHints = null; }\n  }\n\n  function docValue(ts, doc) {\n    var val = doc.doc.getValue();\n    if (ts.options.fileFilter) val = ts.options.fileFilter(val, doc.name, doc.doc);\n    return val;\n  }\n\n  // Worker wrapper\n\n  function WorkerServer(ts) {\n    var worker = ts.worker = new Worker(ts.options.workerScript);\n    worker.postMessage({type: \"init\",\n                        defs: ts.options.defs,\n                        plugins: ts.options.plugins,\n                        scripts: ts.options.workerDeps});\n    var msgId = 0, pending = {};\n\n    function send(data, c) {\n      if (c) {\n        data.id = ++msgId;\n        pending[msgId] = c;\n      }\n      worker.postMessage(data);\n    }\n    worker.onmessage = function(e) {\n      var data = e.data;\n      if (data.type == \"getFile\") {\n        getFile(ts, data.name, function(err, text) {\n          send({type: \"getFile\", err: String(err), text: text, id: data.id});\n        });\n      } else if (data.type == \"debug\") {\n        window.console.log(data.message);\n      } else if (data.id && pending[data.id]) {\n        pending[data.id](data.err, data.body);\n        delete pending[data.id];\n      }\n    };\n    worker.onerror = function(e) {\n      for (var id in pending) pending[id](e);\n      pending = {};\n    };\n\n    this.addFile = function(name, text) { send({type: \"add\", name: name, text: text}); };\n    this.delFile = function(name) { send({type: \"del\", name: name}); };\n    this.request = function(body, c) { send({type: \"req\", body: body}, c); };\n  }\n});\n"]}