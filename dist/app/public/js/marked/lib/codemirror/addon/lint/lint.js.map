{"version":3,"sources":["../../../../../../../../../app/public/js/marked/lib/codemirror/addon/lint/lint.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","GUTTER_ID","showTooltip","e","content","tt","document","createElement","className","appendChild","cloneNode","body","position","parentNode","off","style","top","Math","max","clientY","offsetHeight","left","clientX","on","opacity","rm","elt","removeChild","hideTooltip","setTimeout","showTooltipFor","node","tooltip","hide","poll","setInterval","n","nodeType","host","clearInterval","LintState","cm","options","hasGutter","marked","timeout","onMouseOver","parseOptions","Function","getAnnotations","getHelper","Pos","Error","clearMarks","state","lint","clearGutter","i","length","clear","makeMarker","labels","severity","multiple","tooltips","marker","inner","getMaxSeverity","a","b","groupByLine","annotations","lines","ann","line","from","push","annotationTooltip","tip","createTextNode","message","startLinting","passOptions","async","getValue","updateLinting","annotationsNotSorted","anns","maxSeverity","tipLabel","createDocumentFragment","formatAnnotation","to","markText","__annotation","setGutterMarker","onUpdateLinting","onChange","clearTimeout","delay","popupSpanTooltip","target","srcElement","test","box","getBoundingClientRect","x","right","y","bottom","spans","findMarksAt","coordsChar","defineOption","val","old","Init","getWrapperElement","gutters","getOption","hasLintGutter"],"mappings":"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","file":"lint.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n  var GUTTER_ID = \"CodeMirror-lint-markers\";\n\n  function showTooltip(e, content) {\n    var tt = document.createElement(\"div\");\n    tt.className = \"CodeMirror-lint-tooltip\";\n    tt.appendChild(content.cloneNode(true));\n    document.body.appendChild(tt);\n\n    function position(e) {\n      if (!tt.parentNode) return CodeMirror.off(document, \"mousemove\", position);\n      tt.style.top = Math.max(0, e.clientY - tt.offsetHeight - 5) + \"px\";\n      tt.style.left = (e.clientX + 5) + \"px\";\n    }\n    CodeMirror.on(document, \"mousemove\", position);\n    position(e);\n    if (tt.style.opacity != null) tt.style.opacity = 1;\n    return tt;\n  }\n  function rm(elt) {\n    if (elt.parentNode) elt.parentNode.removeChild(elt);\n  }\n  function hideTooltip(tt) {\n    if (!tt.parentNode) return;\n    if (tt.style.opacity == null) rm(tt);\n    tt.style.opacity = 0;\n    setTimeout(function() { rm(tt); }, 600);\n  }\n\n  function showTooltipFor(e, content, node) {\n    var tooltip = showTooltip(e, content);\n    function hide() {\n      CodeMirror.off(node, \"mouseout\", hide);\n      if (tooltip) { hideTooltip(tooltip); tooltip = null; }\n    }\n    var poll = setInterval(function() {\n      if (tooltip) for (var n = node;; n = n.parentNode) {\n        if (n && n.nodeType == 11) n = n.host;\n        if (n == document.body) return;\n        if (!n) { hide(); break; }\n      }\n      if (!tooltip) return clearInterval(poll);\n    }, 400);\n    CodeMirror.on(node, \"mouseout\", hide);\n  }\n\n  function LintState(cm, options, hasGutter) {\n    this.marked = [];\n    this.options = options;\n    this.timeout = null;\n    this.hasGutter = hasGutter;\n    this.onMouseOver = function(e) { onMouseOver(cm, e); };\n  }\n\n  function parseOptions(cm, options) {\n    if (options instanceof Function) return {getAnnotations: options};\n    if (!options || options === true) options = {};\n    if (!options.getAnnotations) options.getAnnotations = cm.getHelper(CodeMirror.Pos(0, 0), \"lint\");\n    if (!options.getAnnotations) throw new Error(\"Required option 'getAnnotations' missing (lint addon)\");\n    return options;\n  }\n\n  function clearMarks(cm) {\n    var state = cm.state.lint;\n    if (state.hasGutter) cm.clearGutter(GUTTER_ID);\n    for (var i = 0; i < state.marked.length; ++i)\n      state.marked[i].clear();\n    state.marked.length = 0;\n  }\n\n  function makeMarker(labels, severity, multiple, tooltips) {\n    var marker = document.createElement(\"div\"), inner = marker;\n    marker.className = \"CodeMirror-lint-marker-\" + severity;\n    if (multiple) {\n      inner = marker.appendChild(document.createElement(\"div\"));\n      inner.className = \"CodeMirror-lint-marker-multiple\";\n    }\n\n    if (tooltips != false) CodeMirror.on(inner, \"mouseover\", function(e) {\n      showTooltipFor(e, labels, inner);\n    });\n\n    return marker;\n  }\n\n  function getMaxSeverity(a, b) {\n    if (a == \"error\") return a;\n    else return b;\n  }\n\n  function groupByLine(annotations) {\n    var lines = [];\n    for (var i = 0; i < annotations.length; ++i) {\n      var ann = annotations[i], line = ann.from.line;\n      (lines[line] || (lines[line] = [])).push(ann);\n    }\n    return lines;\n  }\n\n  function annotationTooltip(ann) {\n    var severity = ann.severity;\n    if (!severity) severity = \"error\";\n    var tip = document.createElement(\"div\");\n    tip.className = \"CodeMirror-lint-message-\" + severity;\n    tip.appendChild(document.createTextNode(ann.message));\n    return tip;\n  }\n\n  function startLinting(cm) {\n    var state = cm.state.lint, options = state.options;\n    var passOptions = options.options || options; // Support deprecated passing of `options` property in options\n    if (options.async || options.getAnnotations.async)\n      options.getAnnotations(cm.getValue(), updateLinting, passOptions, cm);\n    else\n      updateLinting(cm, options.getAnnotations(cm.getValue(), passOptions, cm));\n  }\n\n  function updateLinting(cm, annotationsNotSorted) {\n    clearMarks(cm);\n    var state = cm.state.lint, options = state.options;\n\n    var annotations = groupByLine(annotationsNotSorted);\n\n    for (var line = 0; line < annotations.length; ++line) {\n      var anns = annotations[line];\n      if (!anns) continue;\n\n      var maxSeverity = null;\n      var tipLabel = state.hasGutter && document.createDocumentFragment();\n\n      for (var i = 0; i < anns.length; ++i) {\n        var ann = anns[i];\n        var severity = ann.severity;\n        if (!severity) severity = \"error\";\n        maxSeverity = getMaxSeverity(maxSeverity, severity);\n\n        if (options.formatAnnotation) ann = options.formatAnnotation(ann);\n        if (state.hasGutter) tipLabel.appendChild(annotationTooltip(ann));\n\n        if (ann.to) state.marked.push(cm.markText(ann.from, ann.to, {\n          className: \"CodeMirror-lint-mark-\" + severity,\n          __annotation: ann\n        }));\n      }\n\n      if (state.hasGutter)\n        cm.setGutterMarker(line, GUTTER_ID, makeMarker(tipLabel, maxSeverity, anns.length > 1,\n                                                       state.options.tooltips));\n    }\n    if (options.onUpdateLinting) options.onUpdateLinting(annotationsNotSorted, annotations, cm);\n  }\n\n  function onChange(cm) {\n    var state = cm.state.lint;\n    clearTimeout(state.timeout);\n    state.timeout = setTimeout(function(){startLinting(cm);}, state.options.delay || 500);\n  }\n\n  function popupSpanTooltip(ann, e) {\n    var target = e.target || e.srcElement;\n    showTooltipFor(e, annotationTooltip(ann), target);\n  }\n\n  function onMouseOver(cm, e) {\n    var target = e.target || e.srcElement;\n    if (!/\\bCodeMirror-lint-mark-/.test(target.className)) return;\n    var box = target.getBoundingClientRect(), x = (box.left + box.right) / 2, y = (box.top + box.bottom) / 2;\n    var spans = cm.findMarksAt(cm.coordsChar({left: x, top: y}, \"client\"));\n    for (var i = 0; i < spans.length; ++i) {\n      var ann = spans[i].__annotation;\n      if (ann) return popupSpanTooltip(ann, e);\n    }\n  }\n\n  CodeMirror.defineOption(\"lint\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      clearMarks(cm);\n      cm.off(\"change\", onChange);\n      CodeMirror.off(cm.getWrapperElement(), \"mouseover\", cm.state.lint.onMouseOver);\n      delete cm.state.lint;\n    }\n\n    if (val) {\n      var gutters = cm.getOption(\"gutters\"), hasLintGutter = false;\n      for (var i = 0; i < gutters.length; ++i) if (gutters[i] == GUTTER_ID) hasLintGutter = true;\n      var state = cm.state.lint = new LintState(cm, parseOptions(cm, val), hasLintGutter);\n      cm.on(\"change\", onChange);\n      if (state.options.tooltips != false)\n        CodeMirror.on(cm.getWrapperElement(), \"mouseover\", state.onMouseOver);\n\n      startLinting(cm);\n    }\n  });\n});\n"]}