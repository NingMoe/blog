{"version":3,"sources":["../../../../../../../app/public/js/marked/plugins/image-dialog/image-dialog.js"],"names":["factory","exports","pluginName","fn","imageDialog","_this","cm","lang","editor","settings","cursor","getCursor","selection","getSelection","imageLang","dialog","image","classPrefix","iframeName","dialogName","focus","loading","show","_loading","find","length","guid","Date","getTime","action","imageUploadURL","indexOf","crossDomainUpload","uploadCallbackURL","dialogContent","imageUpload","url","uploadButton","alt","link","createDialog","title","width","height","name","content","mask","dialogShowMask","drag","dialogDraggable","lockScreen","dialogLockScreen","maskStyle","opacity","dialogMaskOpacity","backgroundColor","dialogMaskBgColor","buttons","enter","val","alert","imageURLEmpty","altAttr","replaceSelection","setCursor","line","ch","hide","hideMask","cancel","attr","fileInput","bind","fileName","isImage","RegExp","imageFormats","join","uploadFileEmpty","test","formatNotAllowed","submitHandler","uploadIframe","document","getElementById","onload","body","contentWindow","contentDocument","json","innerText","textContent","JSON","parse","eval","success","message","trigger","require","module","define","amd","editormd","window"],"mappings":"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","file":"image-dialog.js","sourcesContent":["/*!\r\n * Image (upload) dialog plugin for Editor.md\r\n *\r\n * @file        image-dialog.js\r\n * @author      pandao\r\n * @version     1.3.4\r\n * @updateTime  2015-06-09\r\n * {@link       https://github.com/pandao/editor.md}\r\n * @license     MIT\r\n */\r\n\r\n(function() {\r\n\r\n    var factory = function (exports) {\r\n\r\n\t\tvar pluginName   = \"image-dialog\";\r\n\r\n\t\texports.fn.imageDialog = function() {\r\n\r\n            var _this       = this;\r\n            var cm          = this.cm;\r\n            var lang        = this.lang;\r\n            var editor      = this.editor;\r\n            var settings    = this.settings;\r\n            var cursor      = cm.getCursor();\r\n            var selection   = cm.getSelection();\r\n            var imageLang   = lang.dialog.image;\r\n            var classPrefix = this.classPrefix;\r\n            var iframeName  = classPrefix + \"image-iframe\";\r\n\t\t\tvar dialogName  = classPrefix + pluginName, dialog;\r\n\r\n\t\t\tcm.focus();\r\n\r\n            var loading = function(show) {\r\n                var _loading = dialog.find(\".\" + classPrefix + \"dialog-mask\");\r\n                _loading[(show) ? \"show\" : \"hide\"]();\r\n            };\r\n\r\n            if (editor.find(\".\" + dialogName).length < 1)\r\n            {\r\n                var guid   = (new Date).getTime();\r\n                var action = settings.imageUploadURL + (settings.imageUploadURL.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + \"guid=\" + guid;\r\n\r\n                if (settings.crossDomainUpload)\r\n                {\r\n                    action += \"&callback=\" + settings.uploadCallbackURL + \"&dialog_id=editormd-image-dialog-\" + guid;\r\n                }\r\n\r\n                var dialogContent = ( (settings.imageUpload) ? \"<form action=\\\"\" + action +\"\\\" target=\\\"\" + iframeName + \"\\\" method=\\\"post\\\" enctype=\\\"multipart/form-data\\\" class=\\\"\" + classPrefix + \"form\\\">\" : \"<div class=\\\"\" + classPrefix + \"form\\\">\" ) +\r\n                                        ( (settings.imageUpload) ? \"<iframe name=\\\"\" + iframeName + \"\\\" id=\\\"\" + iframeName + \"\\\" guid=\\\"\" + guid + \"\\\"></iframe>\" : \"\" ) +\r\n                                        \"<label>\" + imageLang.url + \"</label>\" +\r\n                                        \"<input type=\\\"text\\\" data-url />\" + (function(){\r\n                                            return (settings.imageUpload) ? \"<div class=\\\"\" + classPrefix + \"file-input\\\">\" +\r\n                                                                                \"<input type=\\\"file\\\" name=\\\"\" + classPrefix + \"image-file\\\" accept=\\\"image/*\\\" />\" +\r\n                                                                                \"<input type=\\\"submit\\\" value=\\\"\" + imageLang.uploadButton + \"\\\" />\" +\r\n                                                                            \"</div>\" : \"\";\r\n                                        })() +\r\n                                        \"<br/>\" +\r\n                                        \"<label>\" + imageLang.alt + \"</label>\" +\r\n                                        \"<input type=\\\"text\\\" value=\\\"\" + selection + \"\\\" data-alt />\" +\r\n                                        \"<br/>\" +\r\n                                        \"<label>\" + imageLang.link + \"</label>\" +\r\n                                        \"<input type=\\\"text\\\" value=\\\"http://\\\" data-link />\" +\r\n                                        \"<br/>\" +\r\n                                    ( (settings.imageUpload) ? \"</form>\" : \"</div>\");\r\n\r\n                //var imageFooterHTML = \"<button class=\\\"\" + classPrefix + \"btn \" + classPrefix + \"image-manager-btn\\\" style=\\\"float:left;\\\">\" + imageLang.managerButton + \"</button>\";\r\n\r\n                dialog = this.createDialog({\r\n                    title      : imageLang.title,\r\n                    width      : (settings.imageUpload) ? 465 : 380,\r\n                    height     : 254,\r\n                    name       : dialogName,\r\n                    content    : dialogContent,\r\n                    mask       : settings.dialogShowMask,\r\n                    drag       : settings.dialogDraggable,\r\n                    lockScreen : settings.dialogLockScreen,\r\n                    maskStyle  : {\r\n                        opacity         : settings.dialogMaskOpacity,\r\n                        backgroundColor : settings.dialogMaskBgColor\r\n                    },\r\n                    buttons : {\r\n                        enter : [lang.buttons.enter, function() {\r\n                            var url  = this.find(\"[data-url]\").val();\r\n                            var alt  = this.find(\"[data-alt]\").val();\r\n                            var link = this.find(\"[data-link]\").val();\r\n\r\n                            if (url === \"\")\r\n                            {\r\n                                alert(imageLang.imageURLEmpty);\r\n                                return false;\r\n                            }\r\n\r\n\t\t\t\t\t\t\tvar altAttr = (alt !== \"\") ? \" \\\"\" + alt + \"\\\"\" : \"\";\r\n\r\n                            if (link === \"\" || link === \"http://\")\r\n                            {\r\n                                cm.replaceSelection(\"![\" + alt + \"](\" + url + altAttr + \")\");\r\n                            }\r\n                            else\r\n                            {\r\n                                cm.replaceSelection(\"[![\" + alt + \"](\" + url + altAttr + \")](\" + link + altAttr + \")\");\r\n                            }\r\n\r\n                            if (alt === \"\") {\r\n                                cm.setCursor(cursor.line, cursor.ch + 2);\r\n                            }\r\n\r\n                            this.hide().lockScreen(false).hideMask();\r\n\r\n                            return false;\r\n                        }],\r\n\r\n                        cancel : [lang.buttons.cancel, function() {\r\n                            this.hide().lockScreen(false).hideMask();\r\n\r\n                            return false;\r\n                        }]\r\n                    }\r\n                });\r\n\r\n                dialog.attr(\"id\", classPrefix + \"image-dialog-\" + guid);\r\n\r\n\t\t\t\tif (!settings.imageUpload) {\r\n                    return ;\r\n                }\r\n\r\n\t\t\t\tvar fileInput  = dialog.find(\"[name=\\\"\" + classPrefix + \"image-file\\\"]\");\r\n\r\n\t\t\t\tfileInput.bind(\"change\", function() {\r\n\t\t\t\t\tvar fileName  = fileInput.val();\r\n\t\t\t\t\tvar isImage   = new RegExp(\"(\\\\.(\" + settings.imageFormats.join(\"|\") + \"))$\"); // /(\\.(webp|jpg|jpeg|gif|bmp|png))$/\r\n\r\n\t\t\t\t\tif (fileName === \"\")\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\talert(imageLang.uploadFileEmpty);\r\n\r\n                        return false;\r\n\t\t\t\t\t}\r\n\r\n                    if (!isImage.test(fileName))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\talert(imageLang.formatNotAllowed + settings.imageFormats.join(\", \"));\r\n\r\n                        return false;\r\n\t\t\t\t\t}\r\n\r\n                    loading(true);\r\n\r\n                    var submitHandler = function() {\r\n\r\n                        var uploadIframe = document.getElementById(iframeName);\r\n\r\n                        uploadIframe.onload = function() {\r\n\r\n                            loading(false);\r\n\r\n                            var body = (uploadIframe.contentWindow ? uploadIframe.contentWindow : uploadIframe.contentDocument).document.body;\r\n                            var json = (body.innerText) ? body.innerText : ( (body.textContent) ? body.textContent : null);\r\n\r\n                            json = (typeof JSON.parse !== \"undefined\") ? JSON.parse(json) : eval(\"(\" + json + \")\");\r\n\r\n                            if(!settings.crossDomainUpload)\r\n                            {\r\n                              if (json.success === 1)\r\n                              {\r\n                                  dialog.find(\"[data-url]\").val(json.url);\r\n                                  dialog.find(\"[data-link]\").val(json.url);\r\n                              }\r\n                              else\r\n                              {\r\n                                  alert(json.message);\r\n                              }\r\n                            }\r\n\r\n                            return false;\r\n                        };\r\n                    };\r\n\r\n                    dialog.find(\"[type=\\\"submit\\\"]\").bind(\"click\", submitHandler).trigger(\"click\");\r\n\t\t\t\t});\r\n            }\r\n\r\n\t\t\tdialog = editor.find(\".\" + dialogName);\r\n\t\t\tdialog.find(\"[type=\\\"text\\\"]\").val(\"\");\r\n\t\t\tdialog.find(\"[type=\\\"file\\\"]\").val(\"\");\r\n\t\t\tdialog.find(\"[data-link]\").val(\"http://\");\r\n\r\n\t\t\tthis.dialogShowMask(dialog);\r\n\t\t\tthis.dialogLockScreen();\r\n\t\t\tdialog.show();\r\n\r\n\t\t};\r\n\r\n\t};\r\n\r\n\t// CommonJS/Node.js\r\n\tif (typeof require === \"function\" && typeof exports === \"object\" && typeof module === \"object\")\r\n    {\r\n        module.exports = factory;\r\n    }\r\n\telse if (typeof define === \"function\")  // AMD/CMD/Sea.js\r\n    {\r\n\t\tif (define.amd) { // for Require.js\r\n\r\n\t\t\tdefine([\"editormd\"], function(editormd) {\r\n                factory(editormd);\r\n            });\r\n\r\n\t\t} else { // for Sea.js\r\n\t\t\tdefine(function(require) {\r\n                var editormd = require(\"./../../editormd\");\r\n                factory(editormd);\r\n            });\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n        factory(window.editormd);\r\n\t}\r\n\r\n})();\r\n"]}