{"version":3,"sources":["../../../app/routers/api.js"],"names":["require","exec","fs","express","request","requestPromise","md5","sillyDateTime","multer","Geetest","nodemailer","salt","crt_token","tools","router","Router","Users","Docs","Articles","Discuss","Tags","Slide","Photos","Collections","OneByDay","Apps","MailGroup","MailUser","emailRegexp","phoneRegexp","uoloader","NowDate","Date","downloadBasecDir","output","use","req","res","next","code","msg","ok","data","get","geetest_id","geetest_key","register","err","console","error","send","find","isDel","then","docs","json","slides","uid","query","findOne","_id","usersInfo","keyWord","keyword","reg","RegExp","$or","name","$regex","users","cookies","session","offset","parseInt","num","where","user_id","populate","path","select","token","all","permissions","skip","limit","articles","forEach","item","add_date","format","doc_id","id","count","findById","article","watch","save","cookie","maxAge","expires","Promise","user","spread","u","a","start","start_users","push","log","status","catch","post","body","password","form","validateCode","remember","test","email","phone","passwordConfirm","_scrf","findData","userInfo","t_salt","sex","nick","wechat","qq","avatar","signature","website","introduce","editors","follows","follow_users","email_verify","github_id","github","html_url","type","newUsers","userAdd","photos","describe","author","clearCookie","destroy","redirect","updateUserBasic","findByIdAndUpdate","runValidators","updateProfile","updateReward","rewardStatus","rewardDesc","contents","markDownText","markdownText","title","article_date","allArticles","dirname","existsSync","mkdirSync","writeFile","encoding","maxBuffer","stdout","stderr","tar_path","insert","doc_name","user_name","d","document","watch_users","fork","fork_users","issue","issue_contents","isRelease","article_id","discuss","single","ext","file","mimetype","split","filename","now_timer","buffer","originalname","fullpath","size","message","url","success","icon","admins","verify","follow","subscribe","include","coll","colls","articleArr","c","bf","in_array","resolve","reject","doc","follow_id","uids","state","getTime","getTokenOptations","uri","qs","client_id","client_secret","redirect_uri","headers","getGithubUsersOptaions","access_token","user_data","avatar_url","add","e","isSignin","transporter","createTransport","host","port","secure","auth","pass","verify_code","verify_data","href","encodeURI","html_str","mailOptions","from","to","subject","text","html","sendMail","info","close","date","options","response","app","app_id","secret_key","desc","owner","effective","is_del","new","list","apps","mail_group","mail_users","mail_user","group","mark","mailUser","module","exports"],"mappings":"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","file":"api.js","sourcesContent":["'use strict';\n\nconst { exec } = require('child_process');\nconst fs = require('fs');\nconst express = require('express');\nconst request = require('request');\nconst requestPromise = require('request-promise');\nconst md5 = require('md5');\nconst sillyDateTime = require('silly-datetime');\nconst multer = require('multer');\nconst Geetest = require('gt3-sdk');\nconst nodemailer = require('nodemailer');\nconst salt = require('../libs/salt');\nconst crt_token = require('../libs/ctr_token');\nconst tools = require('../libs/tools');\nconst router = express.Router();\nconst Users = require('../models/Users_model');\nconst Docs = require('../models/Document_model');\nconst Articles = require('../models/Articles_model');\nconst Discuss = require('../models/Discuss_model');\nconst Tags = require('../models/Tags_model');\nconst Slide = require('../models/Slide_model');\nconst Photos = require('../models/Photos_model');\nconst Collections = require('../models/Collections_model');\nconst OneByDay = require('../models/onebyday_model');\nconst Apps = require('../models/Apps');\nconst MailGroup = require('../models/mailGroup');\nconst MailUser = require('../models/mailUser');\nconst emailRegexp = /^[a-z0-9]+([._\\\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;\nconst phoneRegexp = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\\\d{8}$/;\nconst uoloader = multer(); //{dest: 'uploads/'}设置dest表示上传文件的目录，如果不设置上传的文件永远在内存之中不会保存到磁盘上。在此处为了在内存中取出文件并重命名所以不设置文件上传路径\nconst NowDate = new Date();\nconst downloadBasecDir = '/Users/bluelife/www/node/blog/app/download/';\nlet output = {};\n\nrouter.use(function(req, res, next) {\n    output = {\n        code: 0,\n        msg: '',\n        ok: false,\n        data: null\n    };\n    next();\n});\n\nrouter.get('/gettest', (req, res, next) => {\n    new Geetest({\n        geetest_id: 'e46e906d776dbd41c4e72f72499ca39f',\n        geetest_key: '30b094aad22445378f7fdc01b83215bb'\n    }).register(null, (err, data) => {\n        if (err) {\n            console.error(err);\n            return;\n        }\n        res.send(data);\n        // console.log(data);\n\n        // if (!data.success) {\n        //     // 进入 fallback，如果一直进入此模式，请检查服务器到极验服务器是否可访问\n        //     // 可以通过修改 hosts 把极验服务器 api.geetest.com 指到不可访问的地址\n        //     // 为以防万一，你可以选择以下两种方式之一：\n        //     // 1. 继续使用极验提供的failback备用方案\n        //     req.session.fallback = true;\n        //     res.send(data);\n        //     // 2. 使用自己提供的备用方案\n        //     // todo\n        // } else {\n        //     // 正常模式\n        //     req.session.fallback = false;\n        //     res.send(data);\n        // }\n    });\n});\n\n/**\n * 获取所有标签\n */\nrouter.get('/docs', (req, res, next) => {\n    // console.log(Tags);\n    // res.send();\n    Docs.find({ isDel: 0 }).then(docs => {\n        if (docs) {\n            output.code = 1;\n            output.msg = 'success';\n            output.ok = true;\n            output.data = docs;\n            res.json(output);\n            return;\n        } else {\n            output.code = 0;\n            output.msg = 'error';\n            output.ok = false;\n            output.data = {};\n            res.json(output);\n            return;\n        }\n    });\n});\n\n/**\n * 获取幻灯片\n */\nrouter.get('/slides', (req, res, next) => {\n    Slide.find().then(slides => {\n        if (slides) {\n            output.code = 1;\n            output.msg = 'success';\n            output.ok = true;\n            output.data = slides;\n            res.json(output);\n            return;\n        } else {\n            output.code = 0;\n            output.msg = 'error';\n            output.ok = false;\n            output.data = {};\n            res.json(output);\n            return;\n        }\n    });\n})\n\nrouter.get('/getUsers', (req, res, next) => {\n    let uid = req.query.uid;\n    Users.findOne({ _id: uid, isDel: 0 }).then(usersInfo => {\n        if (usersInfo) {\n            output.code = 1;\n            output.msg = 'success';\n            output.ok = true;\n            output.data = usersInfo;\n            res.json(output);\n        } else {\n            output.code = 0;\n            output.msg = 'error';\n            output.ok = false;\n            output.data = {};\n            res.json(output);\n        }\n    });\n});\n\nrouter.get('/allUsers', (req, res, next) => {\n    let keyWord = req.query.keyword;\n    const reg = new RegExp(keyWord, 'si') //不区分大小写\n    Users.find({\n        // name:{$regex : /keyWord/,$options: 'si'}\n        $or: [ //多条件，数组\n            { name: { $regex: reg } }\n        ]\n    }).then(users => {\n        if (users) {\n            output.code = 1;\n            output.msg = 'success';\n            output.ok = true;\n            output.data = users;\n            res.json(output);\n        } else {\n            output.code = 0;\n            output.msg = 'error';\n            output.ok = false;\n            output.data = {};\n            res.json(output);\n        }\n    });\n})\n\nrouter.get('/getDocLists', (req, res, next) => {\n    let uid = req.query.uid ? req.query.uid : (req.cookies.uid || req.session.uid);\n    let offset = req.query.offset ? parseInt(req.query.offset) : 1;\n    let num = req.query.num ? parseInt(req.query.num) : 20;\n    let where = uid ? { user_id: uid, isDel: 0 } : { isDel: 0 };\n    Docs.find(where).populate({ path: 'author', select: 'name nick avatar' }).exec().then(docs => {\n        if (docs) {\n            output.code = 1;\n            output.msg = 'success';\n            output.ok = true;\n            output.data = docs;\n            res.json(output);\n        } else {\n            output.code = 0;\n            output.msg = 'error';\n            output.ok = false;\n            output.data = {};\n            res.json(output);\n        }\n    });\n});\n\nrouter.get('/allArticles', (req, res, next) => {\n    let uid = req.query.uid ? req.query.uid : (req.cookies.token && req.cookies.uid);\n    let all = false;\n    let offset = req.query.offset ? parseInt(req.query.offset) : 0;\n    let num = req.query.num ? parseInt(req.query.num) : 10;\n    if (!uid) {\n        all = true;\n    }\n    let where = all ? { isDel: 0, permissions:1 } : { user_id: uid, isDel: 0 };\n    Articles.find(where).skip((offset ? (parseInt(offset-1)*num) :offset)).limit(num)\n        .populate([{\n            path: 'document',\n            select: 'name'\n        }, {\n            path: 'author',\n            select: 'name nick avatar'\n        }])\n        .exec()\n        .then(articles => {\n            if (articles) {\n                articles.forEach(item => {\n                    item.add_date = sillyDateTime.format(item.add_date, 'YYYY-MM-DD HH:mm:ss');\n                });\n                output.code = 1;\n                output.msg = 'success';\n                output.ok = true;\n                output.data = articles;\n                res.json(output);\n            } else {\n                output.code = 0;\n                output.msg = 'error';\n                output.ok = false;\n                output.data = {};\n                res.json(output);\n            }\n        });\n    // Articles.find(where).skip((offset == 0 ? offset : (offset - 1))).limit(num).then(alls => {\n    //     if (alls) {\n    //         alls.forEach(item => {\n    //             item.add_date = sillyDateTime.format(item.add_date, 'YYYY-MM-DD HH:mm:ss');\n    //         });\n    //         output.code = 1;\n    //         output.msg = 'success';\n    //         output.ok = true;\n    //         output.data = alls;\n    //         res.json(output);\n    //     } else {\n    //         output.code = 0;\n    //         output.msg = 'error';\n    //         output.ok = false;\n    //         output.data = {};\n    //         res.json(output);\n    //     }\n    // });\n})\n\nrouter.get('/getArticleLists', (req, res, next) => {\n    let doc_id = req.query.doc_id;\n    let offset = req.query.offset ? req.query.offset: 0;\n    let num = req.query.num ? req.query.num : 10;\n    Articles.find({\n        doc_id: doc_id,\n        isDel: 0,\n        permissions:1\n    }).skip((offset ? (parseInt(offset-1)*num) :offset)).limit(num).populate([{\n        path: 'author',\n        select: 'name'\n    }]).exec().then(articles => {\n        if (articles) {\n            output.code = 1;\n            output.msg = 'success';\n            output.ok = true;\n            output.data = articles;\n            res.json(output);\n        } else {\n            output.code = 0;\n            output.msg = 'error';\n            output.ok = false;\n            output.data = {};\n            res.json(output);\n        }\n    });\n});\n\nrouter.get('/getArticle', (req, res, next) => {\n    let id = req.query.id;\n    Articles.count((err,count)=>{\n        Articles.findById(id).populate([{\n            path: 'document',\n            select: 'name'\n        },\n            {\n                path: 'author',\n                select: 'name nick avatar rewardStatus rewardDesc'\n            },\n            {\n                path: 'issue_contents',\n                select: 'contents add_date permissions',\n                populate: {\n                    path: 'author',\n                    select: 'name nick avatar'\n                }\n            }\n        ]).exec().then(article => {\n            if (article) {\n                article.add_date = sillyDateTime.format(article.add_date, 'YYYY-MM-DD HH:mm:ss');\n                if (!req.cookies[id]) {\n                    //增加阅读数\n                    article.watch++;\n                    article.save();\n                    res.cookie(id, 'on', { maxAge: 1000 * 3600 * 10, expires: 1000 * 3600 * 10 });\n                }\n                output.code = 1;\n                output.msg = 'success';\n                output.ok = true;\n                output.data = {\n                    'article': article,\n                    'total': count,\n                    'offset': 2,\n                    'num': 1\n                };\n                res.json(output);\n\n            } else {\n                output.code = 0;\n                output.msg = 'error';\n                output.ok = false;\n                output.data = {};\n                res.json(output);\n            }\n        });\n    });\n});\n\nrouter.get('/article/start', (req, res, next)=>{\n    if(req.session.uid && req.cookies.uid){\n        let user_id = req.session.uid || req.cookies.uid;\n        let id = req.query.id;\n        Users.findById(user_id).then(user=>{\n            let article = Articles.findById(id);\n            return Promise.all([user,article]);\n        }).spread((u,a)=>{\n            a.start++;\n            a.start_users.push(u);\n            a.save().then(status=>{\n                console.log(status);\n                if(status) {\n                    output.code = 1;\n                    output.msg = 'success';\n                    output.ok = true;\n                    output.data = {\n                        start:a.start\n                    };\n                    res.json(output);\n                }\n            }).catch(err=>{\n                console.log(err);\n            });\n        }).catch(err=>{\n            console.log(err);\n        });\n    }else{\n        output.code = 3;\n        output.msg = 'success';\n        output.ok = true;\n        output.data = {};\n        res.json(output);\n    }\n})\n\nrouter.post('/signin', (req, res, next) => {\n    // let redirect = req.body.redirect ? req.body.redirect : '';\n    let name = req.body.name;\n    let password = req.body.password;\n    let form = req.body.form;\n    let validateCode = form == 'login' ? req.body.validateCode : '';\n    let remember = req.body.remember;\n    if (name == '') {\n        output.code = 0;\n        output.msg = '用户名不能为空';\n        res.json(output);\n        return;\n    }\n    if (password == '') {\n        output.code = 0;\n        output.msg = \"密码不能为空\";\n        res.json(output);\n        return;\n    }\n    if (form == 'login') {\n        if (validateCode == '') {\n            output.code = 0;\n            output.msg = \"请先通过验证\";\n            res.json(output);\n            return;\n        }\n    }\n    let user = {};\n    if (emailRegexp.test(name)) {\n        user.email = name;\n    } else if (phoneRegexp.test(name)) {\n        user.phone = name;\n    } else {\n        user.name = name;\n    }\n    Users.findOne(user).then(function(user) {\n        if (user) {\n            if (user.password == md5(password + user.salt)) {\n                res.cookie('uid', user._id, { maxAge: 1800000 });\n                req.session.uid = user._id;\n                if (remember) {\n                    res.cookie('name', name, { maxAge: 3600000 * 24 * 7 });\n                    res.cookie('password', password, { maxAge: 3600000 * 24 * 7 });\n                }\n                output.code = 1;\n                output.msg = \"success\";\n                output.ok = true;\n                output.data = user;\n                res.json(output);\n                return;\n            } else {\n                output.code = 0;\n                output.msg = \"登录失败，密码不正确\";\n                output.ok = false;\n                output.data = null;\n                res.json(output);\n            }\n        } else {\n            output.code = 2;\n            output.msg = \"您还没有帐号，请注册帐号\";\n            output.data = '';\n            res.json(output);\n        }\n    });\n});\n\nrouter.post('/signup', (req, res, next) => {\n    let name = req.body.name;\n    let phone = req.body.phone;\n    let password = req.body.password;\n    let passwordConfirm = req.body.passwordConfirm;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (name == '') {\n        output.code = 0;\n        output.msg = '用户名不能为空';\n        res.json(output);\n        return;\n    }\n    if (password == '') {\n        output.code = 0;\n        output.msg = \"密码不能为空\";\n        res.json(output);\n        return;\n    }\n\n    if (password != passwordConfirm) {\n        output.code = 0;\n        output.msg = \"两次输入密码不同\";\n        res.json(output);\n        return;\n    }\n\n    let findData = {};\n    if (emailRegexp.test(name)) {\n        findData.email = name;\n    } else if (phoneRegexp.test(name)) {\n        findData.phone = name;\n    } else {\n        findData.name = name;\n    }\n    Users.findOne(findData).then(userInfo => {\n        if (userInfo) {\n            output.code = 0;\n            output.ok = false;\n            output.msg = '帐号已存在，请注册新帐号';\n            output.data = null;\n            res.json(output);\n        } else {\n            let t_salt = salt();\n            let user = {\n                name: '',\n                phone: '',\n                email: '',\n                password: '',\n                salt: '',\n                sex: 3,\n                nick: '',\n                wechat: '',\n                qq: '',\n                avatar: '',\n                signature: '',\n                website: '',\n                introduce: '',\n                editors: 2,\n                follows: 0,\n                follow_users: [],\n                email_verify: false,\n                github_id: '',\n                github: {\n                    html_url: ''\n                },\n                add_date: sillyDateTime.format(new Date(), 'YYYY-MM-DD HH:mm:ss'),\n                isDel: 0,\n            };\n            if (emailRegexp.test(name)) {\n                user.email = name;\n                user.type = 3;\n            } else if (phoneRegexp.test(name)) {\n                user.phone = name;\n                user.type = 2;\n            } else {\n                user.name = name;\n                user.type = 1;\n            }\n            user.name = name;\n            user.salt = t_salt;\n            user.password = md5(password + t_salt);\n            let newUsers = new Users(user);\n            return newUsers.save();\n        }\n    }).then(userAdd => {\n        new Docs({\n            user_id: userAdd._id,\n            name: '随笔',\n            photos: '',\n            describe: '',\n            add_date: sillyDateTime.format(new Date(), 'YYYY-MM-DD HH:mm:ss'),\n            author: userAdd,\n            article: [],\n            permissions:1,\n            isDel: 0,\n        }).save();\n        if (userAdd) {\n            output.code = 1;\n            output.ok = true;\n            output.msg = '注册成功';\n            output.data = { id: userAdd._id };\n            res.json(output);\n        } else {\n            output.code = 2;\n            output.ok = true;\n            output.msg = '注册失败';\n            output.data = null;\n            res.json(output);\n        }\n    });\n});\n\nrouter.get('/signout', (req, res, next) => {\n    res.clearCookie('uid'); // 清除cookie中的uid\n    req.session.destroy(() => { // 销毁session中的uid\n        res.redirect(302, '/login');\n    });\n    // console.log(store);\n    // req.session.store.clear(()=>{\n    //     res.redirect(302,'/login');\n    // })\n});\n\nrouter.post('/updateUserBasic', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let updateUserBasic = {\n        nick: req.body.nick,\n        phone: req.body.phone,\n        email: req.body.email,\n        editors: req.body.editors,\n        avatar: req.body.avatar,\n        qq: req.body.qq,\n        wechat: req.body.wechat,\n        github: req.body.github\n    };\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '未登陆';\n        res.json(output);\n        return;\n    }\n    Users.findByIdAndUpdate(uid, updateUserBasic, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '用户基础信息修改成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        if (err) throw err;\n    });\n});\n\nrouter.post('/changeProfile', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let updateProfile = {\n        sex: req.body.sex,\n        introduce: req.body.introduce,\n        website: req.body.website\n    };\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '未登陆';\n        res.json(output);\n        return;\n    }\n    Users.findByIdAndUpdate(uid, updateProfile, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '用户个人资料修改成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        if (err) throw err;\n    });\n});\n\nrouter.post('/changeReward', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let updateReward = {\n        rewardStatus: req.body.rewardStatus,\n        rewardDesc: req.body.rewardDesc\n    };\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '未登陆';\n        res.json(output);\n        return;\n    }\n    Users.findByIdAndUpdate(uid, updateReward, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '赞赏修改成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        if (err) throw err;\n    });\n});\n\nrouter.post('/saveArticle', (req, res, next) => {\n    let id = req.body.id;\n    let contents = req.body.contents;\n    let markDownText = req.body.markdownText ? req.body.markdownText : null;\n    let title = req.body.title;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    let article_date = {\n        contents: contents,\n        title: title\n    };\n    if (markDownText) {\n        article_date.markDownText = markDownText;\n    }\n\n    Articles.findByIdAndUpdate(id, { title: title, contents: contents, markDownText: markDownText }, { runValidators: true }).then(status => {\n        if (!status) throw console.log(status);\n        output.code = 1;\n        output.ok = true;\n        output.msg = '文章保存成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        console.log(err);\n    });\n});\n\nrouter.get('/article/set_permissions',(req, res, next)=>{\n    let id = req.query.id;\n    let type = req.query.type;\n    Articles.findByIdAndUpdate(id, {permissions: type}, {runValidators: true}).then(status=>{\n        if (!status) throw console.log(status);\n        output.code = 1;\n        output.ok = true;\n        output.msg = '文章权限设置成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err=>{\n        console.log(err);\n        output.code = 0;\n        output.ok = false;\n        output.msg = '文章权限设置失败';\n        output.data = {};\n        res.json(output);\n    });\n});\n\nrouter.get('/downloadAllArticles', (req, res, next) => {\n    let uid = req.query.uid ? req.query.uid : req.cookies.uid;\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '未登陆';\n        output.data = {};\n        res.json(output);\n        return;\n    }\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    let allArticles = Articles.find({ uid: uid }).then(articles => {\n        return articles;\n    });\n    let dirname = downloadBasecDir + '/' + uid;\n    fs.existsSync(dirname) || fs.mkdirSync(dirname); // 下载目录不存在创建目录\n    allArticles.then(all => {\n        all.forEach(article => {\n            fs.writeFile('/Users/bluelife/www/node/blog/app/download/' + uid + '/' + article.title + '.md', article.markDownText, 'utf8', err => {\n                if (err) throw err;\n            });\n        });\n        exec('tar -czf ' + dirname + '.tar.gz' + ' ' + dirname, { encoding: 'utf8', maxBuffer: parseInt(200 * 1024) }, (error, stdout, stderr) => {\n            if (error) throw error;\n            output.code = 1;\n            output.ok = true;\n            output.msg = '所有文章打包下载完成';\n            output.data = { tar_path: 'http://blog.mcloudhub.com/download/' + uid + '.tar.gz' };\n            res.json(output);\n        });\n    });\n})\n\nrouter.post('/newDocument', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let name = req.body.name;\n    Users.findById(uid).then(user => {\n        new Docs({\n            user_id: user._id,\n            name: name,\n            photos: '',\n            describe: '',\n            add_date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss'),\n            author: user,\n            article: [],\n            permissions:1,\n            isDel: 0,\n        }).save().then(insert => {\n            output.code = 1;\n            output.ok = true;\n            output.msg = '文集创建成功';\n            output.data = { id: insert._id };\n            res.json(output);\n        });\n    });\n});\n\nrouter.post('/updateDocumentName', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let id = req.body.id;\n    let name = req.body.name;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Docs.findByIdAndUpdate(id, { name: name }, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '文集名称修改成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '文集名称修改失败';\n        output.data = {};\n        res.json(output);\n    });\n});\n\nrouter.post('/newArticle', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let doc_id = req.body.doc_id;\n    let doc_name = req.body.doc_name;\n    let user_name = req.body.user_name;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Docs.findById(doc_id).then(docs => {\n        let users = Users.findById(uid);\n        return Promise.all([users, docs]);\n    }).spread((u, d) => {\n        new Articles({\n            user_id: u._id,\n            doc_id: d._id,\n            author: u, // 文章所属用户\n            document: d, // 文章所属文集\n            title: sillyDateTime.format(new Date(), 'YYYY-MMM-DD'), // 文章标题\n            describe: '', // 文章描述\n            photos: '', // 文章图片\n            contents: '', // 文章内容\n            markDownText: '',\n            watch: 0,\n            watch_users: [],\n            start: 0,\n            start_users: [],\n            fork: 0,\n            fork_users: [],\n            issue: 0,\n            issue_contents: [],\n            follows: 0,\n            follow_users: [],\n            permissions:1,\n            add_date: sillyDateTime.format(new Date(), 'YYYY-MM-DD HH:mm:ss'),\n            isRelease: 0,\n            isDel: 0,\n        }).save().then(insert => {\n            d.article_id.push({ id: insert._id });\n            d.article.push(insert);\n            d.save();\n            u.article.push(insert);\n            u.save();\n            output.code = 1;\n            output.ok = true;\n            output.msg = '文章创建成功';\n            output.data = insert;\n            res.json(output);\n        }).catch(err => {\n            console.log(err);\n            output.code = 0;\n            output.ok = false;\n            output.msg = '文章创建失败';\n            output.data = {};\n            res.json(output);\n        });\n    })\n});\n\nrouter.get('/deleteDoc', (req, res, next) => {\n    let uid = req.query.uid;\n    let id = req.query.id;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Docs.findByIdAndUpdate(id, { isDel: 1 }, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '文集删除成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '文集删除失败';\n        output.data = {};\n        res.json(output);\n    });\n});\n\nrouter.get('/releaseArticle', (req, res, next) => {\n    let uid = req.query.uid;\n    let id = req.query.id;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Articles.findByIdAndUpdate(id, { isRelease: 1 }, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '文章已发布';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '文章已失败';\n        output.data = {};\n        res.json(output);\n    })\n});\n\nrouter.get('/deleteArticle', (req, res, next) => {\n    let uid = req.query.uid;\n    let id = req.query.id;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Articles.findByIdAndUpdate(id, { isDel: 1 }, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '文章删除成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '文章删除失败';\n        output.data = {};\n        res.json(output);\n    });\n});\n\nrouter.post('/changeAticleTitle', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let id = req.body.id;\n    let title = req.body.title;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Articles.findByIdAndUpdate(id, { title: title }, { runValidators: true }).then(status => {\n        if (!status) throw console.log(status);\n        output.code = 1;\n        output.ok = true;\n        output.msg = '文章修改成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '文章修改失败';\n        output.data = {};\n        res.json(output);\n    });\n});\n\nrouter.post('/postDiscuss', (req, res, next) => {\n    let id = req.body.id;\n    let contents = req.body.contents;\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let permissions = req.body.permissions ? parseInt(req.body.permissions) : 1;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '您尚未登录';\n        res.json(output);\n        return;\n    }\n    Articles.findById(id).then(article => {\n        let users = Users.findById(uid);\n        return Promise.all([users, article]);\n    }).spread((u, a) => {\n        new Discuss({\n            uid: u._id,\n            article_id: a._id,\n            author: u,\n            article: a,\n            contents: contents,\n            permissions: permissions,\n            add_date: sillyDateTime.format(new Date(), 'YYYY-MM-DD HH:mm:ss'),\n            isDel: 0\n        }).save().then(status => {\n            a.issue++;\n            a.issue_contents.push(status);\n            a.save();\n            output.code = 1;\n            output.ok = true;\n            output.msg = '评论成功';\n            output.data = {};\n            res.json(output);\n        });\n    });\n});\n\nrouter.get('/getDiscuss', (req, res, next) => {\n    let id = req.query.id;\n    Discuss.find({ article_id: id }).then(discuss => {\n        if (!discuss) throw console.log(discuss);\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = discuss;\n        res.json(output);\n    });\n});\n\nrouter.post('/uploader', uoloader.single('editormd-image-file'), (req, res, next) => {\n    let uid = req.session.uid && req.cookies.uid;\n    let ext = req.file.mimetype.split('/')[1];\n    let filename = sillyDateTime.format(new Date(), 'YYYYMMMDDHHmmss') + '_' + crt_token() + '.' + ext;\n    let now_timer = sillyDateTime.format(new Date(), 'YYYYMMMDD');\n    let dirname = '/Users/bluelife/www/node/blog/app/public/images/uploads/' + now_timer + '/';\n    fs.existsSync(dirname) || fs.mkdirSync(dirname); // 目录不存在创建目录\n    fs.writeFile(dirname + filename, req.file.buffer, err => {\n        if (!err) {\n            Users.findById(uid).then(user => {\n                new Photos({\n                    user_id: user._id,\n                    author: user,\n                    originalname: req.file.originalname,\n                    filename: filename,\n                    path: dirname,\n                    fullpath: dirname + filename,\n                    encoding: req.file.encoding,\n                    mimetype: req.file.mimetype,\n                    size: req.file.size,\n                    add_date: sillyDateTime.format(new Date(), 'YYYY-MM-DD HH:mm:ss'),\n                    isDel: 0\n                }).save().then(insert => {\n                    if (!insert) throw console.log(insert);\n                    res.json({\n                        message: '图片上传成功',\n                        url: 'https://blog.mcloudhub.com/public/images/uploads/' + now_timer + '/' + filename,\n                        success: 1\n                    });\n                });\n            });\n        }\n    });\n});\n\nrouter.post('/collection/new', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let icon = req.body.icon;\n    let name = req.body.name;\n    let describe = req.body.describe;\n    let push = req.body.push;\n    let admins = req.body.admins;\n    let verify = req.body.verify;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '您尚未登录';\n        res.json(output);\n        return;\n    }\n    Users.findById(uid).then(user => {\n        new Collections({\n            user_id: user._id,\n            author: user,\n            article: [],\n            name: name, // 集合名称\n            type: 1, // 集合类型\n            icon: icon, // 集合图标\n            describe: describe, // 集合描述\n            add_date: sillyDateTime.format(new Date(), 'YYYY-MM-DD HH:mm:ss'), // 集合添加时间,\n            admins: admins, // 其他管理员\n            push: push, // 是否允许投稿\n            follow: 0, //关注数\n            subscribe: [],\n            include: 0, //收录文章数\n            verify: verify, // 是否需要审核\n            isDel: 0\n        }).save().then(coll => {\n            if (!coll) {\n                output.code = 0;\n                output.ok = false;\n                output.msg = '文集添加失败';\n                output.data = {};\n                res.json(output);\n            } else {\n                output.code = 1;\n                output.ok = true;\n                output.msg = '文集添加成功';\n                output.data = coll;\n                res.json(output);\n            }\n\n        });\n    });\n});\n\nrouter.post('/collection/update', (req, res, next) => {\n    let id = req.body.id;\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let icon = req.body.icon;\n    let name = req.body.name;\n    let describe = req.body.describe;\n    let push = req.body.push;\n    let admins = req.body.admins;\n    let verify = req.body.verify;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '您尚未登录';\n        res.json(output);\n        return;\n    }\n    Collections.findByIdAndUpdate(id, {\n        icon: icon,\n        name: name,\n        describe: describe,\n        push: push,\n        verify: verify,\n        admins: admins\n    }, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '专题已修改';\n        output.data = status;\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '专题修改失败';\n        output.data = {};\n        res.json(output);\n    });\n});\n\nrouter.get('/get_collections', (req, res, next) => {\n    let offset = req.query.offset ? parseInt(req.query.offset) : 0;\n    let num = req.query.num ? parseInt(req.query.num) : 10;\n    let where = { isDel: 0 };\n    Collections.find(where).skip((offset ? (parseInt(offset-1)*num) :offset)).limit(num).populate([{\n            path: 'author',\n            select: 'name avatar nick',\n        },\n        {\n            path: 'admins',\n            select: 'name avatar nick',\n        },\n        {\n            path: 'subscribe',\n            select: 'name avatar nick',\n        },\n        {\n            path: 'article',\n            select: 'title contents markDownText watch start fork issue follows',\n            populate: [{\n                path: 'author',\n                select: 'name nick avatar'\n            }, {\n                path: 'document',\n                select: 'name'\n            }]\n        }\n    ]).exec().then(colls => {\n        if (!colls) throw console.log(colls);\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = colls;\n        res.json(output);\n    });\n});\n\nrouter.get('/getCollectionById', (req, res, next) => {\n    let id = req.query.id;\n    let articleArr = [];\n    Collections.findOne({ _id: id, isDel: 0 }).populate([{\n            path: 'author',\n            select: 'name avatar nick',\n        },\n        {\n            path: 'admins',\n            select: 'name avatar nick',\n        },\n        {\n            path: 'subscribe',\n            select: 'name avatar nick',\n        },\n        {\n            path: 'article',\n            select: 'title contents markDownText watch start fork issue follows',\n            populate: [{\n                    path: 'author',\n                    select: 'name nick avatar'\n                },\n                {\n                    path: 'document',\n                    select: 'name'\n                }\n            ]\n        }\n    ]).exec().then(coll => {\n        if (!coll) throw console.log(coll);\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = coll;\n        res.json(output);\n    }).catch(err => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = [];\n        res.json(output);\n    });\n});\n\nrouter.get('/collectionFollow', (req, res, next) => {\n    let uid = req.query.uid;\n    let id = req.query.id;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n\n    Collections.findById(id).then(coll => {\n        let user = Users.findById(uid);\n        return Promise.all([user, coll]);\n    }).spread((u, c) => {\n        c.follow++;\n        c.subscribe = u;\n        return c.save();\n    }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '关注成功';\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '关注失败';\n        res.json(output);\n    });\n});\n\nrouter.get('/articlePush', (req, res, next) => {\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let article_id = req.query.article_id;\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Collections.findById(id).then(coll => {\n        let user = Users.findById(uid);\n        let article = Articles.findById(article_id);\n        return Promise.all([user, article, coll]);\n    }).spread((u, a, c) => {\n        let bf = tools.in_array(a._id, c.article_id);\n        if (bf) {\n            return new Promise((resolve, reject) => {\n                resolve('exists');\n                reject(null);\n            })\n        } else {\n            c.article_id.push({ id: article_id });\n            c.include++;\n            c.article.push(a);\n            return c.save();\n        }\n    }).then(status => {\n        if (status == 'exists') {\n            output.code = 2;\n            output.ok = true;\n            output.msg = '此文章已投稿，请另选一篇文章再投。';\n            res.json(output);\n        } else {\n            output.code = 1;\n            output.ok = true;\n            output.msg = '投稿成功';\n            res.json(output);\n        }\n    }).catch(err => {\n        console.log(err);\n        output.code = 0;\n        output.ok = false;\n        output.msg = '投稿失败';\n        res.json(output);\n    });\n});\n\nrouter.post('/updateIntroduce', (req, res, next) => {\n    let uid = req.body.uid ? req.body.uid : req.session.uid;\n    let introduce = req.body.introduce;\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '未登陆';\n        res.json(output);\n        return;\n    }\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Users.findByIdAndUpdate(uid, { introduce: introduce }, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '用户个人介绍修改成功';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        if (err) throw err;\n    });\n});\n\nrouter.get('/documents/get', (req, res, next) => {\n    let uid = req.query.uid ? req.query.uid : '';\n    let id = req.query.id ? req.query.id : '';\n    let where = uid ? { _id: id, user_id: uid, isDel: 0 } : { _id: id, isDel: 0 };\n    Docs.findOne(where).populate([{\n            path: 'author',\n            select: 'name nick avatar'\n        },\n        {\n            path: 'article',\n            select: 'title contents markDownText watch start fork issue follows',\n            populate: [{\n                path: 'author',\n                select: 'name nick avatar'\n            }, {\n                path: 'document',\n                select: 'name'\n            }]\n        }\n    ]).exec().then(doc => {\n        if (!doc) throw console.log(doc);\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = doc;\n        res.json(output);\n    }).catch(err => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = {};\n        res.json(output);\n    });\n})\n\nrouter.get('/collections/delete', (req, res, next) => {\n    let uid = req.query.uid ? req.query.uid : '';\n    let id = req.query.id ? req.query.id : '';\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '未登陆';\n        res.json(output);\n        return;\n    }\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    Collections.findByIdAndUpdate(id, { isDel: 1 }, { runValidators: true }).then(status => {\n        output.code = 1;\n        output.ok = true;\n        output.msg = '专题已删除';\n        output.data = {};\n        res.json(output);\n    }).catch(err => {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '专题删除失败，请稍后再试';\n        output.data = {};\n        res.json(output);\n    });\n});\n\nrouter.get('/users/follow', (req, res, next) => {\n    let uid = req.query.uid ? req.query.uid : '';\n    let follow_id = req.query.follow_id ? req.query.follow_id : '';\n    if (req.session.uid == '') {\n        output.code = 0;\n        output.msg = '未登陆';\n        res.json(output);\n        return;\n    }\n    if (req.cookies._scrf == '') {\n        output.code = 0;\n        output.msg = '非法请求';\n        res.json(output);\n        return;\n    }\n    if (follow_id) {\n        Users.findOne({ _id: follow_id }).then(user => {\n            user.follow++;\n            user.uids.push({ id: uid });\n            user.save();\n            output.code = 1;\n            output.ok = true;\n            output.msg = '关注成功';\n            res.json(output);\n            return;\n        });\n    } else {\n        output.code = 0;\n        output.ok = false;\n        output.msg = '关注失败';\n        res.json(output);\n        return;\n    }\n\n});\n\nrouter.get('/github', (req, res, next) => {\n    let code = req.query.code;\n    let state = NowDate.getTime();\n    let getTokenOptations = {\n        uri: 'https://github.com/login/oauth/access_token',\n        qs: {\n            client_id: '5fe59ee126edbea8f3df',\n            client_secret: 'eaf2f8a2d1b0e21ebdf4ca75628a1dd6c9fdbeff',\n            code: code,\n            redirect_uri: 'https://blog.mcloudhub.com/api/github',\n            state: state,\n        },\n        headers: {\n            'User-Agent': 'Request-Promise'\n        },\n        json: true // Automatically parses the JSON string in the response\n    }\n\n    requestPromise(getTokenOptations).then(token => {\n        let getGithubUsersOptaions = {\n            uri: 'https://api.github.com/user',\n            headers: {\n                'User-Agent': 'Request-Promise',\n                'Authorization': 'token ' + token.access_token,\n            },\n            json: true\n        }\n        requestPromise(getGithubUsersOptaions).then(github => {\n            console.log(github);\n            if (github) {\n                Users.findOne({ github_id: github.id }).then(user => {\n                    if (!user) {\n                        let user_data = {\n                            name: github.name,\n                            phone: '',\n                            email: github.email,\n                            password: '',\n                            salt: '',\n                            sex: 3,\n                            nick: github.name,\n                            wechat: '',\n                            qq: '',\n                            avatar: github.avatar_url,\n                            signature: '',\n                            website: '',\n                            introduce: '',\n                            editors: 2,\n                            follow: 0,\n                            github_id: github.id,\n                            github: github,\n                            add_date: sillyDateTime.format(new Date(), 'YYYY-MM-DD HH:mm:ss'),\n                            isDel: 0,\n                        };\n                        new Users(user_data).save().then(add => {\n                            try {\n                                res.cookie('uid', add._id);\n                                req.session.uid = add._id;\n                                res.redirect(302, '/');\n                            } catch (e) {\n                                console.log(e);\n                                res.redirect(302, '/');\n                            }\n                        });\n                    } else {\n                        res.cookie('uid', user._id);\n                        req.session.uid = user._id;\n                        res.redirect(302, '/');\n                    }\n                });\n            }\n        }).catch(err => {\n            console.log(err);\n            res.redirect(302, '/');\n        });\n        // https://api.github.com/user?access_token=...\n        // Authorization: token OAUTH-TOKEN\n    }).catch(err => {\n        console.log(err);\n        res.redirect(302, '/');\n    });\n    // console.log(code);\n    // res.json({code:code});\n});\n\nrouter.get('/check_signin', (req, res, next) => {\n    if (req.session.uid && req.cookies.uid) {\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = {\n            isSignin: true\n        }\n        res.json(output);\n    } else {\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = {\n            isSignin: false\n        }\n        res.json(output);\n    }\n});\n\n\nrouter.get('/send_maile', (req, res, next) => {\n    // Generate test SMTP service account from ethereal.email\n    // Only needed if you don't have a real mail account for testing\n    // nodemailer.createTestAccount((err, account) => {\n    // console.log(account);\n    // create reusable transporter object using the default SMTP transport\n    let transporter = nodemailer.createTransport({\n        host: 'smtp.163.com',\n        port: 465, // defaults to 587 is secure is false or 465 if true\n        secure: true, // true for 465, false for other ports\n        auth: {\n            user: 'thebulelife@163.com', // generated ethereal user\n            pass: 'xx19890907' // generated ethereal password\n        }\n    });\n\n    // verify connection configuration\n    transporter.verify((error, success) => {\n        if (error) {\n            console.log(error);\n        }\n    });\n\n    // var htmlstream = fs.createReadStream('');\n    let verify_code = md5(NowDate.getTime());\n    req.session.verify_code = verify_code;\n    let verify_data = sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss');\n    let href = encodeURI('https://blog.mcloudhub.com/api/verify_email?u=' + req.session.uid + '&code=' + verify_code + '&data=' + verify_data);\n    let html_str = '<a href=\"' + href + '\" style=\"font-size:16px;font-weight:700;padding:15px 40px;color:#fff;background-color:#2595ff;border-color:#0b89ff;text-decoration:none;display:inline-block;margin-bottom: 0;text-align: center;vertical-align: middle;touch-action: manipulation;cursor: pointer;background-image: none;border: 1px solid transparent;white-space: nowrap;line-height: 1.428571429;border-radius: 4px;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;\">请验证您的邮箱地址</a>';\n    // setup email data with unicode symbols\n    let mailOptions = {\n        from: '\"thebulelife@163.com', // sender address\n        to: '703294267@qq.com', // list of receivers\n        subject: '邮箱验证', // Subject line\n        text: '您好：', // plain text body\n        html: html_str // html body\n    };\n\n    // send mail with defined transport object\n    transporter.sendMail(mailOptions, (error, info) => {\n        if (error) {\n            return console.log(error);\n        }\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = null;\n        res.json(output);\n        // console.log(info);\n        // console.log('Message sent: %s', info.messageId);\n        // // Preview only available when sending through an Ethereal account\n        // console.log('Preview URL: %s', nodemailer.getTestMessageUrl(info));\n\n        // Message sent: <b658f8ca-6296-ccf4-8306-87d57a0b4321@example.com>\n        // Preview URL: https://ethereal.email/message/WaQKMgKddxQDoou...\n    });\n\n    transporter.close();\n    // });\n\n});\n\nrouter.get('/verify_email', (req, res, next) => {\n    let uid = req.query.u;\n    let verify_code = req.query.code;\n    if (req.session.verify_code == verify_code) {\n        Users.findById(uid).then(user => {\n            user.email_verify = true;\n            return user.save();\n        }).then(status => {\n            res.redirect(302, '/setting/basic');\n        });\n    }\n});\n\nrouter.get('/one_by_day', (req, res, next)=>{\n    let date = sillyDateTime.format(new Date(), 'YYYY-MMM-DD');\n    OneByDay.findOne({date:date}).then(data=>{\n        if(!data){\n            let options = {\n                uri: 'https://open.iciba.com/dsapi/',\n                qs: {\n                    file: 'json',\n                    date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD'),\n                    type: ''\n                },\n                headers: {\n                    'User-Agent': 'Request-Promise'\n                },\n                json: true // Automatically parses the JSON string in the response\n            };\n            requestPromise(options).then(response=>{\n                response.add_date = sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss');\n                response.date = sillyDateTime.format(new Date(), 'YYYY-MMM-DD');\n                response.isDel = 0;\n                new OneByDay(response).save().then(status=>{\n                    res.json(status);\n                }).catch(err=>{\n                    console.log(err);\n                });\n            }).catch(err=>{\n                console.log(err);\n            });\n        }else{\n            res.json(data);\n        }\n    });\n\n});\n\nrouter.post('/applaction/new', (req, res, next)=>{\n    let app = req.body.app;\n    let user_id = req.session.uid && req.cookies.uid;\n    let app_id = NowDate.getTime();\n    let secret_key = md5(NowDate.getTime());\n    app.type = app.type == 'PC应用' ? 1 : 2;          // 将APP应用类型由数字转换成数字\n    Users.findById(user_id).then(user=>{\n        return Promise.all([user]);\n    }).spread((user)=>{\n        new Apps({\n            user_id: user._id,\n            name: app.name,\n            desc: app.desc,\n            avatar: app.avatar,\n            owner:user,\n            type: app.type,               // 应用类型，1：pc，2：app\n            app_id: app_id,\n            secret_key: secret_key,\n            status: 1,             // 应用状态，1：开启，2：暂停\n            effective: true,         // 应用是否有效\n            is_del: false,\n            add_date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss')\n        }).save().then(status=>{\n            output.code = 1;\n            output.ok = true;\n            output.msg = 'SUCCESS';\n            output.data = status;\n            res.json(output);\n        }).catch(err=>{\n            console.log(err);\n        });\n    });\n});\n\nrouter.post('/applaction/update', (req, res, next)=>{\n    let app = req.body.app;\n    let id = req.body.id;\n    console.log(app);\n    Apps.findByIdAndUpdate(id, {name:app.name,type:parseInt(app.type),desc:app.desc,avatar:app.avatar}, {new:true, runValidators:true}).then(status=>{\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = status;\n        res.json(output);\n    }).catch(err=>{\n        console.log(err);\n    });\n});\n\nrouter.get('/apps/list', (req, res, next)=>{\n    let offset = parseInt(req.query.offset) || 1;\n    let num = parseInt(req.query.num) || 10;\n    let user_id = req.query.user_id;\n    Apps.count((err,count)=>{\n        Apps.find({user_id:user_id}).skip((offset ? parseInt((offset-1)*num) : parseInt(offset*num))).limit(num).then(apps=>{\n            output.code = 1;\n            output.ok = true;\n            output.msg = 'SUCCESS';\n            output.data = {count:count,list:apps};\n            res.json(output);\n        }).catch(err=>{\n            console.log(err);\n        });\n    });\n});\n\nrouter.get('/apps/get', (req, res, next)=>{\n    let id = req.query.id;\n    Apps.findById(id).then(app=>{\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = app;\n        res.json(output);\n    }).catch(err=>{\n        console.log(err);\n    });\n});\n\nrouter.get('/mail/group/list', (req, res, next)=>{\n    MailGroup.find().then(mail_group=>{\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = mail_group;\n        res.json(output);\n    }).catch(err=>{\n        console.log(err);\n    });\n});\n\nrouter.get('/mail/group/get', (req, res, next)=>{\n    let id = req.query.id;\n    MailGroup.findById(id).then(mail_group=>{\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = mail_group;\n        res.json(output);\n    }).catch(err=>{\n        console.log(err);\n    });\n});\n\nrouter.post('/mail/group/add', (req, res, next)=>{\n    let name = req.body.name;\n    MailGroup.findOne({name:name}).then(status=>{\n        if(!status){\n            new MailGroup({\n                name: name,\n                add_date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss'),\n                isDel: false\n            }).save().then(insert=>{\n                output.code = 1;\n                output.ok = true;\n                output.msg = 'SUCCESS';\n                output.data = insert;\n                res.json(output);\n            });\n        }else{\n            output.code = 2;\n            output.ok = true;\n            output.msg = 'SUCCESS';\n            output.data = insert;\n            res.json(output);\n        }\n    }).catch(err=>{\n        console.log(err);\n    });\n});\n\nrouter.get('/mail/user/list', (req, res, next)=>{\n    let offset = req.query.offset ? parseInt(req.query.offset) : 1;\n    let num = req.query.num ? parseInt(req.query.num) : 20;\n    MailUser.count((err,count)=>{\n        if(err){\n            console.log(err);\n        }else{\n            MailUser.find({ isDel:false }).skip(offset ? parseInt((offset-1)*num) : offset).limit(num).populate({\n                path: 'group',\n                select: 'name'\n            }).exec().then(mail_users=>{\n                output.code = 1;\n                output.ok = true;\n                output.msg = 'SUCCESS';\n                output.data = {\n                    count: count,\n                    list: mail_users\n                };\n                res.json(output);\n            }).catch(err=>{\n                console.log(err);\n            });\n        }\n    });\n});\n\nrouter.post('/mail/user/add', (req, res, next)=>{\n    let mail_user = req.body.mail_user;\n    MailGroup.findById(mail_user.group).then(group=>{\n        new MailUser({\n            name: mail_user.name,\n            email: mail_user.email,\n            phone: mail_user.phone,\n            group: group,\n            mark: mail_user.mark,\n            add_date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss'),\n            isDel: false\n        }).save().then(insert=>{\n            output.code = 1;\n            output.ok = true;\n            output.msg = 'SUCCESS';\n            output.data = insert;\n            res.json(output);\n        }).catch(err=>{\n            console.log(err);\n        });\n    });\n});\n\nrouter.get('/mail/move_user_to_group', (req, res, next)=>{\n    let user_id = req.query.user_id;\n    let id = req.query.id;\n    MailUser.findById(user_id).then(mailUser=>{\n        MailGroup.findById(id).then(group=>{\n            mailUser.group = group;\n            mailUser.save();\n            output.code = 1;\n            output.ok = true;\n            output.msg = 'SUCCESS';\n            output.data = null;\n            res.json(output);\n        }).catch(err=>{\n            console.log(err);\n        });\n    }).catch(err=>{\n        console.log(err);\n    });\n});\n\nrouter.get('/mail/user/delete', (req, res, next)=>{\n    let user_id = req.query.user_id;\n    MailUser.findByIdAndUpdate(user_id,{isDel:true},{ runValidators: true }).then(status=>{\n        output.code = 1;\n        output.ok = true;\n        output.msg = 'SUCCESS';\n        output.data = null;\n        res.json(output);\n    }).catch(err=>{\n        console.log(err);\n    });\n});\n\nmodule.exports = router;\n"]}