{"version":3,"sources":["../../routers/api.js"],"names":["fs","require","express","md5","sillyDateTime","multer","Geetest","salt","crt_token","router","Router","Users","Docs","Articles","Discuss","Tags","Slide","Photos","Collections","emailRegexp","phoneRegexp","uoloader","NowDate","Date","responseData","use","req","res","next","code","msg","ok","data","get","captcha","geetest_id","geetest_key","register","err","console","error","send","cookies","token","json","find","then","tags","slides","uid","query","findOne","_id","isDel","usersInfo","keyWord","keyword","reg","RegExp","$or","name","$regex","users","docs","all","offset","parseInt","num","where","skip","limit","alls","doc_id","articles","id","article","watch","save","set","maxAge","expires","article_id","discuss","post","body","password","form","validateCode","remember","user","test","email","phone","userInfo","passwordConfirm","findData","t_salt","sex","nick","wechat","qq","avatar","signature","website","introduce","editors","add_date","format","type","newUsers","inser","photos","describe","redirect","updateUserBasic","update","multi","log","updateProfile","updateReward","rewardStatus","rewardDesc","contents","markDownText","markdownText","title","article_date","insert","doc_name","user_name","author","start","fork","isRelease","article_uid","single","ext","file","mimetype","split","filename","now_timer","dirname","exists","mkdir","writeFile","buffer","originalname","path","fullpath","encoding","size","message","url","success","icon","push","admins","verify","collections","follow","subscribe","include","article_ids","coll","colls","result","articlesArr","length","forEach","ids","module","exports"],"mappings":"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","file":"api.js","sourcesContent":["'use strict';\n\nvar fs = require('fs');\nvar express = require('express');\nvar md5 = require('md5');\nvar sillyDateTime = require('silly-datetime');\nvar multer = require('multer');\nvar Geetest = require('gt3-sdk');\nvar salt = require('../libs/salt');\nvar crt_token = require('../libs/ctr_token');\nvar router = express.Router();\nvar Users = require('../models/Users_model');\nvar Docs = require('../models/Document_model');\nvar Articles = require('../models/Articles_model');\nvar Discuss = require('../models/Discuss_model');\nvar Tags = require('../models/Tags_model');\nvar Slide = require('../models/Slide_model');\nvar Photos = require('../models/Photos_model');\nvar Collections = require('../models/Collections_model');\nvar emailRegexp = /^[a-z0-9]+([._\\\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;\nvar phoneRegexp = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\\\d{8}$/;\nvar uoloader = multer(); //{dest: 'uploads/'}设置dest表示上传文件的目录，如果不设置上传的文件永远在内存之中不会保存到磁盘上。在此处为了在内存中取出文件并重命名所以不设置文件上传路径\nvar NowDate = new Date();\n\nvar responseData = {};\n\nrouter.use(function (req, res, next) {\n    responseData = {\n        code: 0,\n        msg: '',\n        ok: false,\n        data: null\n    };\n    next();\n});\n\nrouter.get('/gettest', function (req, res, next) {\n    var captcha = new Geetest({\n        geetest_id: 'e46e906d776dbd41c4e72f72499ca39f',\n        geetest_key: '30b094aad22445378f7fdc01b83215bb'\n    }).register(null, function (err, data) {\n        if (err) {\n            console.error(err);\n            return;\n        }\n        res.send(data);\n        // console.log(data);\n\n        // if (!data.success) {\n        //     // 进入 fallback，如果一直进入此模式，请检查服务器到极验服务器是否可访问\n        //     // 可以通过修改 hosts 把极验服务器 api.geetest.com 指到不可访问的地址\n        //     // 为以防万一，你可以选择以下两种方式之一：\n        //     // 1. 继续使用极验提供的failback备用方案\n        //     req.session.fallback = true;\n        //     res.send(data);\n        //     // 2. 使用自己提供的备用方案\n        //     // todo\n        // } else {\n        //     // 正常模式\n        //     req.session.fallback = false;\n        //     res.send(data);\n        // }\n    });\n});\n\n/**\n * 获取TOKEN\n */\nrouter.get('/gettoken', function (req, res, next) {\n    responseData.code = 1;\n    responseData.msg = 'success';\n    responseData.ok = true;\n    if (req.cookies.get('token') && req.cookies.get('token') != '') {\n        responseData.data = {\n            token: req.cookies.get('token')\n        };\n    } else {\n        var token = crt_token();\n        responseData.data = {\n            token: crt_token\n        };\n    }\n    res.json(responseData);\n    return;\n});\n\n/**\n * 获取所有标签\n */\nrouter.get('/tags', function (req, res, next) {\n    // console.log(Tags);\n    // res.send();\n    Tags.find().then(function (tags) {\n        if (tags) {\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = tags;\n            res.json(responseData);\n            return;\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n            return;\n        }\n    });\n});\n\n/**\n * 获取幻灯片\n */\nrouter.get('/slides', function (req, res, next) {\n    Slide.find().then(function (slides) {\n        if (slides) {\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = slides;\n            res.json(responseData);\n            return;\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n            return;\n        }\n    });\n});\n\nrouter.get('/getUsers', function (req, res, next) {\n    var uid = req.query.uid;\n    Users.findOne({ _id: uid, isDel: 0 }).then(function (usersInfo) {\n        if (usersInfo) {\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = usersInfo;\n            res.json(responseData);\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/allUsers', function (req, res, next) {\n    var keyWord = req.query.keyword;\n    var reg = new RegExp(keyWord, 'si'); //不区分大小写\n    Users.find({\n        // name:{$regex : /keyWord/,$options: 'si'}\n        $or: [//多条件，数组\n        { name: { $regex: reg } }]\n    }).then(function (users) {\n        if (users) {\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = users;\n            res.json(responseData);\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/getDocLists', function (req, res, next) {\n    var uid = req.query.uid;\n    Docs.find({ uid: uid, isDel: 0 }).then(function (docs) {\n        if (docs) {\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = docs;\n            res.json(responseData);\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/allArticles', function (req, res, next) {\n    var uid = '';\n    var all = false;\n    var offset = req.query.offset ? parseInt(req.query.offset) : 0;\n    var num = req.query.num ? parseInt(req.query.num) : 10;\n    if (req.cookies.get('token') && req.cookies.get('uid')) {\n        uid = req.cookies.get('uid');\n    } else {\n        all = true;\n    }\n    var where = all ? { isDel: 0 } : { uid: uid, isDel: 0 };\n    Articles.find(where).skip(offset == 0 ? offset : offset - 1).limit(num).then(function (alls) {\n        if (alls) {\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = alls;\n            res.json(responseData);\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/getArticleLists', function (req, res, next) {\n    var doc_id = req.query.doc_id;\n    Articles.find({\n        doc_id: doc_id,\n        isDel: 0\n    }).then(function (articles) {\n        // console.log(articles);\n        if (articles) {\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = articles;\n            res.json(responseData);\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/getArticle', function (req, res, next) {\n    var id = req.query.id;\n    Articles.findOne({ _id: id }).then(function (article) {\n        if (article) {\n            if (!req.cookies.get(id)) {\n                //增加阅读数\n                article.watch++;\n                article.save();\n                req.cookies.set(id, 'on', { maxAge: 1000 * 3600 * 10, expires: 1000 * 3600 * 10 });\n            }\n\n            Discuss.find({ article_id: article._id }).then(function (discuss) {\n                responseData.code = 1;\n                responseData.msg = 'success';\n                responseData.ok = true;\n                responseData.data = {\n                    'article': article,\n                    'discuss': discuss\n                };\n                res.json(responseData);\n            });\n        } else {\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.post('/signin', function (req, res, next) {\n    var name = req.body.name;\n    var password = req.body.password;\n    var form = req.body.form;\n    var validateCode = form == 'login' ? req.body.validateCode : '';\n    var remember = req.body.remember;\n    if (name == '') {\n        responseData.code = 0;\n        responseData.msg = '用户名不能为空';\n        res.json(responseData);\n        return;\n    }\n    if (password == '') {\n        responseData.code = 0;\n        responseData.msg = \"密码不能为空\";\n        res.json(responseData);\n        return;\n    }\n    if (form == 'login') {\n        if (validateCode == '') {\n            responseData.code = 0;\n            responseData.msg = \"请先通过验证\";\n            res.json(responseData);\n            return;\n        }\n    }\n    var user = {};\n    if (emailRegexp.test(name)) {\n        user.email = name;\n    } else if (phoneRegexp.test(name)) {\n        user.phone = name;\n    } else {\n        user.name = name;\n    }\n    Users.findOne(user).then(function (userInfo) {\n        if (userInfo) {\n            if (userInfo.password == md5(password + userInfo.salt)) {\n                responseData.code = 1;\n                responseData.msg = \"success\";\n                responseData.ok = true;\n                responseData.data = userInfo;\n                req.cookies.set('uid', userInfo._id, { maxAge: 1000 * 3600 * 10, expires: 1000 * 3600 * 10 });\n                req.cookies.set('token', crt_token(), { maxAge: 1000 * 3600 * 10, expires: 1000 * 3600 * 10 });\n                res.json(responseData);\n                return;\n            } else {\n                responseData.code = 2;\n                responseData.msg = \"登录失败，密码不正确\";\n                responseData.ok = false;\n                responseData.data = null;\n                res.json(responseData);\n            }\n        } else {\n            responseData.code = 0;\n            responseData.msg = \"您还没有帐号，请注册帐号\";\n            responseData.data = '';\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.post('/signup', function (req, res, next) {\n    var name = req.body.name;\n    var phone = req.body.phone;\n    var password = req.body.password;\n    var passwordConfirm = req.body.passwordConfirm;\n    var token = req.body.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    if (name == '') {\n        responseData.code = 0;\n        responseData.msg = '用户名不能为空';\n        res.json(responseData);\n        return;\n    }\n    if (password == '') {\n        responseData.code = 0;\n        responseData.msg = \"密码不能为空\";\n        res.json(responseData);\n        return;\n    }\n\n    if (password != passwordConfirm) {\n        responseData.code = 0;\n        responseData.msg = \"两次输入密码不同\";\n        res.json(responseData);\n        return;\n    }\n\n    var findData = {};\n    if (emailRegexp.test(name)) {\n        findData.email = name;\n    } else if (phoneRegexp.test(name)) {\n        findData.phone = name;\n    } else {\n        findData.name = name;\n    }\n    Users.findOne(findData).then(function (userInfo) {\n        if (userInfo) {\n            responseData.code = 0;\n            responseData.ok = false;\n            responseData.msg = '帐号已存在，请注册新帐号';\n            responseData.data = null;\n            res.json(responseData);\n        } else {\n            var t_salt = salt();\n            var user = {\n                name: '',\n                phone: '',\n                email: '',\n                password: '',\n                salt: '',\n                sex: 3,\n                nick: '',\n                wechat: '',\n                qq: '',\n                avatar: '',\n                signature: '',\n                website: '',\n                introduce: '',\n                editors: 2,\n                add_date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss'),\n                isDel: 0\n            };\n            if (emailRegexp.test(name)) {\n                user.email = name;\n                user.type = 3;\n            } else if (phoneRegexp.test(name)) {\n                user.phone = name;\n                user.type = 2;\n            } else {\n                user.name = name;\n                user.type = 1;\n            }\n            user.name = name;\n            user.salt = t_salt;\n            user.password = md5(password + t_salt);\n            var newUsers = new Users(user);\n            return newUsers.save();\n        }\n    }).then(function (inser) {\n        new Docs({\n            uid: inser._id,\n            name: '随笔',\n            photos: '',\n            describe: '',\n            add_date: new Date(),\n            isDel: 0\n        }).save();\n        if (inser) {\n            responseData.code = 1;\n            responseData.ok = true;\n            responseData.msg = '注册成功';\n            responseData.data = { id: inser._id };\n            res.json(responseData);\n        } else {\n            responseData.code = 2;\n            responseData.ok = true;\n            responseData.msg = '注册失败';\n            responseData.data = null;\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/signout', function (req, res, next) {\n    req.cookies.set('token', '');\n    req.cookies.set('uid', '');\n    req.token = '';\n    req.userInfo = null;\n    res.redirect(302, '/login');\n});\n\nrouter.post('/updateUserBasic', function (req, res, next) {\n    var token = req.body.token;\n    var uid = req.body.uid;\n    var updateUserBasic = {\n        nick: req.body.nick,\n        phone: req.body.phone,\n        email: req.body.email,\n        editors: req.body.editors,\n        avatar: req.body.avatar,\n        qq: req.body.qq,\n        wechat: req.body.wechat\n    };\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({ _id: uid }, updateUserBasic, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '用户基础信息修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeProfile', function (req, res, next) {\n    var token = req.body.token;\n    var uid = req.body.uid;\n    var updateProfile = {\n        sex: req.body.sex,\n        introduce: req.body.introduce,\n        website: req.body.website\n    };\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({ _id: uid }, updateProfile, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '用户个人资料修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeReward', function (req, res, next) {\n    var token = req.body.token;\n    var uid = req.body.uid;\n    var updateReward = {\n        rewardStatus: req.body.rewardStatus,\n        rewardDesc: req.body.rewardDesc\n    };\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({ _id: uid }, updateReward, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '赞赏修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/saveArticle', function (req, res, next) {\n    var token = req.body.token;\n    var id = req.body.id;\n    var contents = req.body.contents;\n    var markDownText = req.body.markdownText ? req.body.markdownText : null;\n    var title = req.body.title;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    var article_date = {\n        contents: contents,\n        title: title\n    };\n    if (markDownText) {\n        article_date.markDownText = markDownText;\n    }\n    Articles.update({ _id: id }, article_date, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/downloadAllArticles', function (req, res, next) {\n    responseData.code = 1;\n    responseData.ok = true;\n    responseData.msg = '所有文章打包下载完成';\n    responseData.data = {};\n    res.json(responseData);\n});\n\nrouter.post('/newDocument', function (req, res, next) {\n    var uid = req.body.uid;\n    var name = req.body.name;\n    var docs = new Docs({\n        uid: uid,\n        name: name,\n        photos: '',\n        describe: '',\n        add_date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss'),\n        isDel: 0\n    });\n    docs.save().then(function (insert) {\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集创建成功';\n        responseData.data = { id: insert._id };\n        res.json(responseData);\n    });\n});\n\nrouter.post('/updateDocumentName', function (req, res, next) {\n    var uid = req.body.uid;\n    var id = req.body.id;\n    var token = req.body.token;\n    var name = req.body.name;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Docs.update({ _id: id, uid: uid }, { name: name }, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集名称修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/newArticle', function (req, res, next) {\n    var uid = req.body.uid;\n    var doc_id = req.body.doc_id;\n    var doc_name = req.body.doc_name;\n    var user_name = req.body.user_name;\n    var token = req.body.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    var article = new Articles({\n        uid: uid,\n        doc_id: doc_id, // 文章所属文档id\n        doc_name: doc_name, // 文集名称\n        author: user_name, //文章作者\n        title: sillyDateTime.format(new Date(), 'YYYY-MMM-DD'), // 文章标题\n        describe: '', // 文章描述\n        photos: '', // 文章图片\n        contents: '', // 文章内容\n        watch: 0,\n        start: 0,\n        fork: 0,\n        add_date: sillyDateTime.format(new Date(), 'YYYY-MMM-DD HH:mm:ss'),\n        isRelease: 0,\n        isDel: 0\n    });\n    article.save().then(function (insert) {\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章创建成功';\n        responseData.data = { id: insert._id };\n        res.json(responseData);\n    });\n});\n\nrouter.get('/deleteDoc', function (req, res, next) {\n    var uid = req.query.uid;\n    var id = req.query.id;\n    var token = req.query.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Docs.update({ _id: id, uid: uid }, { isDel: 1 }, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/releaseArticle', function (req, res, next) {\n    var uid = req.query.uid;\n    var id = req.query.id;\n    var token = req.query.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({ _id: id, uid: uid }, { isRelease: 1 }, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章已发布';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/deleteArticle', function (req, res, next) {\n    var uid = req.query.uid;\n    var id = req.query.id;\n    var token = req.query.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({ _id: id, uid: uid }, { isDel: 1 }, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeAticleTitle', function (req, res, next) {\n    var uid = req.body.uid;\n    var token = req.body.token;\n    var id = req.body.id;\n    var title = req.body.title;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({ _id: id, uid: uid }, { title: title }, { multi: false }, function (err, docs) {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/postDiscuss', function (req, res, next) {\n    var id = req.body.id;\n    var contents = req.body.contents;\n    var uid = req.body.uid;\n    var token = req.body.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    if (req.cookies.get('uid') == '' && req.cookies.get('token') == '') {\n        responseData.code = 0;\n        responseData.msg = '您尚未登录';\n        res.json(responseData);\n        return;\n    }\n    Articles.findOne({ _id: id }).then(function (article) {\n        var data = {\n            uid: uid, //评论的用户id\n            article_id: article._id, //评论的文章id\n            article_uid: article.uid, //评论的文章的用户id\n            contents: contents, //评论的内容\n            add_date: new Date(), //评论时间\n            isDel: 0\n        };\n        new Discuss(data).save();\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '评论成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/getDiscuss', function (req, res, next) {\n    var id = req.query.id;\n    var token = req.query.token;\n    Discuss.find({ article_id: id }).then(function (discuss) {\n        if (!discuss) throw console.log(discuss);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = 'SUCCESS';\n        responseData.data = discuss;\n        res.json(responseData);\n    });\n});\n\nrouter.post('/uploader', uoloader.single('editormd-image-file'), function (req, res, next) {\n    // console.log(req.file);\n    var ext = req.file.mimetype.split('/')[1];\n    var filename = sillyDateTime.format(new Date(), 'YYYYMMMDDHHmmss') + '_' + crt_token() + '.' + ext;\n    var now_timer = sillyDateTime.format(new Date(), 'YYYYMMMDD');\n    var dirname = '/Users/bluelife/www/node/blog/public/images/uploads/' + now_timer + '/';\n\n    fs.exists(dirname, function (exists) {\n        //如果目录不存在创建目录\n        if (!exists) {\n            fs.mkdir(dirname, function (err) {\n                if (!err) throw console.log(err);\n            });\n        }\n        fs.writeFile(dirname + filename, req.file.buffer, function (err) {\n            if (!err) {\n                new Photos({\n                    originalname: req.file.originalname,\n                    filename: filename,\n                    path: dirname,\n                    fullpath: dirname + filename,\n                    encoding: req.file.encoding,\n                    mimetype: req.file.mimetype,\n                    size: req.file.size,\n                    add_date: new Date(),\n                    isDel: 0\n                }).save().then(function (insert) {\n                    if (!insert) throw console.log(insert);\n                    res.json({\n                        message: '图片上传成功',\n                        url: 'https://blog.mcloudhub.com/public/images/uploads/' + now_timer + '/' + filename,\n                        success: 1\n                    });\n                });\n            }\n        });\n    });\n});\n\nrouter.post('/collection/new', function (req, res, next) {\n    var uid = req.body.uid;\n    var token = req.body.token;\n    var icon = req.body.icon;\n    var name = req.body.name;\n    var describe = req.body.describe;\n    var push = req.body.push;\n    var admins = req.body.admins;\n    var verify = req.body.verify;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    var collections = new Collections({\n        uid: uid,\n        name: name, // 集合名称\n        type: 1, // 集合类型\n        icon: icon, // 集合图标\n        describe: describe, // 集合描述\n        add_date: new Date(), // 集合添加时间,\n        admins: admins, // 其他管理员\n        push: push, // 是否允许投稿\n        follow: 0, //关注数\n        subscribe: [],\n        include: 0, //收录文章数\n        article_ids: [],\n        verify: verify, // 是否需要审核\n        isDel: 0\n    });\n    collections.save().then(function (coll) {\n        if (!coll) {\n            responseData.code = 0;\n            responseData.ok = false;\n            responseData.msg = '文集添加失败';\n            responseData.data = {};\n            res.json(responseData);\n        } else {\n            responseData.code = 1;\n            responseData.ok = true;\n            responseData.msg = '文集添加成功';\n            responseData.data = coll;\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/get_collections', function (req, res, next) {\n    var uid = req.query.uid;\n    var token = req.query.token;\n    var offset = req.query.offset ? parseInt(req.query.offset) : 0;\n    var num = req.query.num ? parseInt(req.query.num) : 10;\n    var where = uid === void 0 ? { isDel: 0, uid: uid } : { isDel: 0 };\n    Collections.find(where).skip((offset == 0 ? offset : offset - 1) * num).limit(num).then(function (colls) {\n        if (!colls) throw console.log(colls);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = 'SUCCESS';\n        responseData.data = colls;\n        res.json(responseData);\n    });\n});\n\nrouter.get('/getCollectionById', function (req, res, next) {\n    var id = req.query.id;\n    var token = req.query.token;\n    Collections.findOne({ _id: id }).then(function (coll) {\n        if (!coll) throw console.log(coll);\n        var result = {};\n        var articlesArr = [];\n        if (coll.article_ids.length > 0) {\n            coll.article_ids.forEach(function (ids) {\n                Articles.findOne({ _id: ids.id }).then(function (article) {\n                    articlesArr.push(article);\n                });\n            });\n        }\n        result.articles = articlesArr;\n        result.icon = coll.icon;\n        result.follow = coll.follow;\n        result.describe = coll.describe;\n        result.include = coll.include;\n        result.name = coll.name;\n        result.push = coll.push;\n        result.subscribe = coll.subscribe;\n        result.admins = coll.admins;\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = 'SUCCESS';\n        responseData.data = result;\n        res.json(responseData);\n    });\n});\n\nrouter.get('/collectionFollow', function (req, res, next) {\n    var uid = req.query.uid;\n    var id = req.query.id;\n    var token = req.query.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Collections.findOne({ _id: id }).then(function (coll) {\n        coll.follow++;\n        coll.subscribe.push({ uid: uid });\n        coll.save();\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '关注成功';\n        res.json(responseData);\n    });\n});\n\nrouter.get('/articlePush', function (req, res, next) {\n    var uid = req.query.uid;\n    var id = req.query.id;\n    var article_id = req.query.article_id;\n    var token = req.query.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Collections.findOne({ _id: id }).then(function (coll) {\n        coll.include++;\n        if (coll.article_ids.length > 0) {\n            coll.article_ids.forEach(function (ids) {\n                if (ids.id == article_id) {\n                    responseData.code = 0;\n                    responseData.ok = false;\n                    responseData.msg = '此文章已投稿，请另选一篇文章再投。';\n                    res.json(responseData);\n                } else {\n                    coll.article_ids.push({ id: article_id });\n                    coll.save();\n                    responseData.code = 1;\n                    responseData.ok = true;\n                    responseData.msg = '投稿成功';\n                    res.json(responseData);\n                }\n                return;\n            });\n        } else {\n            coll.article_ids.push({ id: article_id });\n            coll.save();\n            responseData.code = 1;\n            responseData.ok = true;\n            responseData.msg = '投稿成功';\n            res.json(responseData);\n            return;\n        }\n    });\n});\n\nrouter.get('/zhi', function (req, res, next) {\n    res.json(req.query);\n});\n\nmodule.exports = router;\n//# sourceMappingURL=api.js.map"]}