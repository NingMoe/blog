{"version":3,"sources":["../../routers/api.js"],"names":["express","require","md5","sillyDateTime","salt","crt_token","router","Router","Users","Docs","Articles","Tags","Slide","Geetest","emailRegexp","phoneRegexp","responseData","use","req","res","next","code","msg","ok","data","get","captcha","geetest_id","geetest_key","register","err","console","error","send","cookies","token","json","find","then","tags","slides","uid","query","findOne","_id","isDel","usersInfo","docs","all","where","alls","doc_id","articles","id","article","post","name","body","password","form","validateCode","remember","user","test","email","phone","userInfo","set","passwordConfirm","findData","t_salt","sex","nick","wechat","qq","avatar","signature","website","introduce","editors","add_date","format","Date","type","newUsers","save","inser","photos","describe","redirect","updateUserBasic","update","multi","log","updateProfile","updateReward","rewardStatus","rewardDesc","contents","markDownText","markdownText","title","article_date","insert","doc_name","user_name","author","watch","start","fork","isRelease","module","exports"],"mappings":"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","file":"api.js","sourcesContent":["const express = require('express');\nconst md5 = require('md5');\nconst sillyDateTime = require('silly-datetime');\nconst salt = require('../libs/salt');\nconst crt_token = require('../libs/ctr_token');\nconst router = express.Router();\nconst Users = require('../models/Users_model');\nconst Docs = require('../models/Document_model');\nconst Articles = require('../models/Articles_model');\nconst Tags = require('../models/Tags_model');\nconst Slide = require('../models/Slide_model');\nconst Geetest = require('gt3-sdk');\nconst emailRegexp = /^[a-z0-9]+([._\\\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;\nconst phoneRegexp = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\\\d{8}$/;\n\nlet responseData = {};\n\nrouter.use(function(req, res, next) {\n    responseData = {\n        code: 0,\n        msg: '',\n        ok:false,\n        data: null\n    };\n    next();\n});\n\nrouter.get('/gettest',(req,res,next)=>{\n    let captcha = new Geetest({\n        geetest_id: 'e46e906d776dbd41c4e72f72499ca39f',\n        geetest_key: '30b094aad22445378f7fdc01b83215bb'\n    }).register(null,(err,data)=>{\n        if (err) {\n            console.error(err);\n            return;\n        }\n        res.send(data);\n        // console.log(data);\n\n        // if (!data.success) {\n        //     // 进入 fallback，如果一直进入此模式，请检查服务器到极验服务器是否可访问\n        //     // 可以通过修改 hosts 把极验服务器 api.geetest.com 指到不可访问的地址\n        //     // 为以防万一，你可以选择以下两种方式之一：\n        //     // 1. 继续使用极验提供的failback备用方案\n        //     req.session.fallback = true;\n        //     res.send(data);\n        //     // 2. 使用自己提供的备用方案\n        //     // todo\n        // } else {\n        //     // 正常模式\n        //     req.session.fallback = false;\n        //     res.send(data);\n        // }\n    });\n});\n\n/**\n * 获取TOKEN\n */\nrouter.get('/gettoken',(req, res, next)=>{\n    responseData.code = 1;\n    responseData.msg = 'success';\n    responseData.ok = true;\n    if(req.cookies.get('token') && req.cookies.get('token') != ''){\n        responseData.data = {\n            token:req.cookies.get('token')\n        };\n    }else{\n        let token = crt_token();\n        responseData.data = {\n            token:crt_token\n        };\n    }\n    res.json(responseData);\n    return;\n})\n\n/**\n * 获取所有标签\n */\nrouter.get('/tags',(req, res, next)=>{\n    // console.log(Tags);\n    // res.send();\n    Tags.find().then(tags=>{\n        if(tags){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = tags;\n            res.json(responseData);\n            return;\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n            return;\n        }\n    });\n});\n\n/**\n * 获取幻灯片\n */\nrouter.get('/slides',(req, res, next)=>{\n    Slide.find().then(slides=>{\n        if(slides){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = slides;\n            res.json(responseData);\n            return;\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n            return;\n        }\n    });\n})\n\nrouter.get('/getUsers',(req, res, next)=>{\n    let uid = req.query.uid;\n    Users.findOne({_id:uid, isDel:0}).then(usersInfo=>{\n        if(usersInfo){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = usersInfo;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/getDocLists',(req, res, next)=>{\n    let uid = req.query.uid;\n    Docs.find({uid:uid,isDel:0}).then(docs=>{\n        if(docs){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = docs;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/allArticles',(req, res, next)=>{\n    let uid = '';\n    let all = false;\n    if(req.cookies.get('token') && req.cookies.get('uid')){\n        uid = req.cookies.get('uid');\n    }else{\n        all = true;\n    }\n    let where = all ? {}: {uid:uid};\n    Articles.find(where).then(alls=>{\n        if(alls){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = alls;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n})\n\nrouter.get('/getArticleLists',(req, res, next)=>{\n    let doc_id = req.query.doc_id;\n    Articles.find({\n        doc_id:doc_id,\n        isDel:0\n    }).then(articles=>{\n        // console.log(articles);\n        if(articles){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = articles;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/getArticle',(req, res, next)=>{\n    let id = req.query.id;\n    Articles.findOne({_id:id}).then(article=>{\n        if(article){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = article;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n})\n\nrouter.post('/signin', (req, res, next) => {\n    let name = req.body.name;\n    let password = req.body.password;\n    let form = req.body.form;\n    let validateCode = form == 'login' ? req.body.validateCode : '';\n    let remember = req.body.remember;\n    if (name == '') {\n        responseData.code = 0;\n        responseData.msg = '用户名不能为空';\n        res.json(responseData);\n        return;\n    }\n    if (password == '') {\n        responseData.code = 0;\n        responseData.msg = \"密码不能为空\";\n        res.json(responseData);\n        return;\n    }\n    if(form == 'login'){\n        if(validateCode == ''){\n            responseData.code = 0;\n            responseData.msg = \"请先通过验证\";\n            res.json(responseData);\n            return;\n        }\n    }\n    let user = {};\n    if(emailRegexp.test(name)){\n        user.email = name;\n    }else if(phoneRegexp.test(name)){\n        user.phone = name;\n    }else{\n        user.name = name;\n    }\n    Users.findOne(user).then(function(userInfo) {\n        if (userInfo) {\n            if(userInfo.password == md5(password+userInfo.salt)){\n                responseData.code = 1;\n                responseData.msg = \"success\";\n                responseData.ok = true;\n                responseData.data = userInfo;\n                req.cookies.set('uid',userInfo._id);\n                req.cookies.set('token',crt_token());\n                res.json(responseData);\n                return;\n            }else{\n                responseData.code = 2;\n                responseData.msg = \"登录失败，密码不正确\";\n                responseData.ok = false;\n                responseData.data = null;\n                res.json(responseData);\n            }\n        } else {\n            responseData.code = 0;\n            responseData.msg = \"您还没有帐号，请注册帐号\";\n            responseData.data = '';\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.post('/signup',(req, res, next)=>{\n    let name = req.body.name;\n    let phone = req.body.phone;\n    let password = req.body.password;\n    let passwordConfirm = req.body.passwordConfirm;\n    let token = req.body.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    if (name == '') {\n        responseData.code = 0;\n        responseData.msg = '用户名不能为空';\n        res.json(responseData);\n        return;\n    }\n    if (password == '') {\n        responseData.code = 0;\n        responseData.msg = \"密码不能为空\";\n        res.json(responseData);\n        return;\n    }\n\n    if(password != passwordConfirm){\n        responseData.code = 0;\n        responseData.msg = \"两次输入密码不同\";\n        res.json(responseData);\n        return;\n    }\n\n    let findData = {};\n    if(emailRegexp.test(name)){\n        findData.email = name;\n    }else if(phoneRegexp.test(name)){\n        findData.phone = name;\n    }else{\n        findData.name = name;\n    }\n    Users.findOne(findData).then(userInfo=>{\n        if(userInfo){\n            responseData.code = 0;\n            responseData.ok = false;\n            responseData.msg = '帐号已存在，请注册新帐号';\n            responseData.data = null;\n            res.json(responseData);\n        }else{\n            let t_salt = salt();\n            let user = {\n                name:'',\n                phone : '',\n                email : '',\n                password:'',\n                salt : '',\n                sex: 3,\n                nick: '',\n                wechat: '',\n                qq: '',\n                avatar: '',\n                signature:'',\n                website: '',\n                introduce : '',\n                editors : 2,\n                add_date : sillyDateTime.format(new Date(),'YYYY-MMM-DD HH:mm:ss'),\n                isDel : 0,\n            };\n            if(emailRegexp.test(name)){\n                user.email = name;\n                user.type = 3;\n            }else if(phoneRegexp.test(name)){\n                user.phone = name;\n                user.type = 2;\n            }else{\n                user.name = name;\n                user.type = 1;\n            }\n            user.name = name;\n            user.salt = t_salt;\n            user.password = md5(password+t_salt);\n            let newUsers = new Users(user);\n            return newUsers.save();\n        }\n    }).then(inser => {\n        new Docs({\n            uid: inser._id,\n            name: '随笔',\n            photos: '',\n            describe: '',\n            add_date: new Date(),\n            isDel: 0,\n        }).save();\n        if(inser){\n            responseData.code = 1;\n            responseData.ok = true;\n            responseData.msg = '注册成功';\n            responseData.data = {id:inser._id};\n            res.json(responseData);\n        }else{\n            responseData.code = 2;\n            responseData.ok = true;\n            responseData.msg = '注册失败';\n            responseData.data = null;\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/signout',(req,res,next)=>{\n    req.cookies.set('token','');\n    req.cookies.set('uid','');\n    req.token = '';\n    req.userInfo = null;\n    res.redirect(302,'/login');\n});\n\nrouter.post('/updateUserBasic',(req,res,next)=>{\n    let token = req.body.token;\n    let uid = req.body.uid;\n    let updateUserBasic = {\n        nick: req.body.nick,\n        phone: req.body.phone,\n        email: req.body.email,\n        editors: req.body.editors,\n        avatar: req.body.avatar,\n        qq:req.body.qq,\n        wechat:req.body.wechat\n    };\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({_id:uid},updateUserBasic,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '用户基础信息修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeProfile',(req,res,next)=>{\n    let token = req.body.token;\n    let uid = req.body.uid;\n    let updateProfile = {\n        sex:req.body.sex,\n        introduce:req.body.introduce,\n        website:req.body.website\n    };\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({_id:uid},updateProfile,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '用户个人资料修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeReward',(req,res,next)=>{\n    let token = req.body.token;\n    let uid = req.body.uid;\n    let updateReward = {\n        rewardStatus:req.body.rewardStatus,\n        rewardDesc:req.body.rewardDesc\n    };\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({_id:uid},updateReward,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '赞赏修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/saveArticle',(req,res,next)=>{\n    let token = req.body.token;\n    let id = req.body.id;\n    let contents = req.body.contents;\n    let markDownText = req.body.markdownText ? req.body.markdownText:null;\n    let title = req.body.title;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    let article_date = {\n        contents:contents,\n        title:title\n    };\n    if(markDownText){\n        article_date.markDownText = markDownText;\n    }\n    Articles.update({_id:id},article_date,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/downloadAllArticles',(req,res,next)=>{\n    responseData.code = 1;\n    responseData.ok = true;\n    responseData.msg = '所有文章打包下载完成';\n    responseData.data = {};\n    res.json(responseData);\n})\n\nrouter.post('/newDocument',(req,res,next)=>{\n    let uid = req.body.uid;\n    let name = req.body.name;\n    let docs = new Docs({\n        uid:uid,\n        name: name,\n        photos: '',\n        describe: '',\n        add_date: sillyDateTime.format(new Date(),'YYYY-MMM-DD HH:mm:ss'),\n        isDel: 0,\n    });\n    docs.save().then(insert=>{\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集创建成功';\n        responseData.data = {id:insert._id};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/updateDocumentName',(req,res,next)=>{\n    let uid = req.body.uid;\n    let id = req.body.id;\n    let token = req.body.token;\n    let name = req.body.name;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Docs.update({_id:id,uid:uid},{name:name},{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集名称修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    })\n})\n\nrouter.post('/newArticle',(req,res,next)=>{\n    let uid = req.body.uid;\n    let doc_id = req.body.doc_id;\n    let doc_name = req.body.doc_name;\n    let user_name = req.body.user_name;\n    let token = req.body.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    let article = new Articles({\n        uid: uid,\n        doc_id:doc_id,  // 文章所属文档id\n        doc_name:doc_name, // 文集名称\n        author: user_name, //文章作者\n        title: sillyDateTime.format(new Date(),'YYYY-MMM-DD'), // 文章标题\n        describe: '', // 文章描述\n        photos: '', // 文章图片\n        contents: '', // 文章内容\n        watch: 0,\n        start: 0,\n        fork: 0,\n        add_date: sillyDateTime.format(new Date(),'YYYY-MMM-DD HH:mm:ss'),\n        isRelease: 0,\n        isDel: 0,\n    });\n    article.save().then(insert =>{\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章创建成功';\n        responseData.data = {id:insert._id};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/deleteDoc',(req,res,next)=>{\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let token = req.query.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Docs.update({_id:id,uid:uid}, {isDel:1}, {multi:false}, (err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    })\n});\n\nrouter.get('/releaseArticle',(req,res,next)=> {\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let token = req.query.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({_id: id, uid: uid}, {isRelease: 1}, {multi: false}, (err, docs) => {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章已发布';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/deleteArticle',(req,res,next)=>{\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let token = req.query.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({_id:id,uid:uid}, {isDel:1}, {multi:false}, (err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeAticleTitle',(req,res,next)=>{\n    let uid = req.body.uid;\n    let token = req.body.token;\n    let id = req.body.id;\n    let title = req.body.title;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({_id:id,uid:uid}, {title:title}, {multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nmodule.exports = router;"]}