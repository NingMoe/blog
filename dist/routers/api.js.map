{"version":3,"sources":["../../routers/api.js"],"names":["fs","require","express","md5","sillyDateTime","multer","Geetest","salt","crt_token","router","Router","Users","Docs","Articles","Discuss","Tags","Slide","Photos","Collections","emailRegexp","phoneRegexp","uoloader","NowDate","Date","responseData","use","req","res","next","code","msg","ok","data","get","captcha","geetest_id","geetest_key","register","err","console","error","send","cookies","token","json","find","then","tags","slides","uid","query","findOne","_id","isDel","usersInfo","keyWord","keyword","reg","RegExp","$or","name","$regex","users","docs","all","offset","parseInt","num","where","skip","limit","alls","doc_id","articles","id","article","watch","save","set","maxAge","expires","article_id","discuss","post","body","password","form","validateCode","remember","user","test","email","phone","userInfo","passwordConfirm","findData","t_salt","sex","nick","wechat","qq","avatar","signature","website","introduce","editors","add_date","format","type","newUsers","inser","photos","describe","redirect","updateUserBasic","update","multi","log","updateProfile","updateReward","rewardStatus","rewardDesc","contents","markDownText","markdownText","title","article_date","insert","doc_name","user_name","author","start","fork","isRelease","article_uid","single","ext","file","mimetype","split","filename","now_timer","dirname","exists","mkdir","writeFile","buffer","originalname","path","fullpath","encoding","size","message","url","success","icon","push","admins","verify","collections","follow","subscribe","include","article_ids","coll","colls","result","articlesArr","length","forEach","ids","module","exports"],"mappings":"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","file":"api.js","sourcesContent":["const fs = require('fs');\nconst express = require('express');\nconst md5 = require('md5');\nconst sillyDateTime = require('silly-datetime');\nconst multer  = require('multer');\nconst Geetest = require('gt3-sdk');\nconst salt = require('../libs/salt');\nconst crt_token = require('../libs/ctr_token');\nconst router = express.Router();\nconst Users = require('../models/Users_model');\nconst Docs = require('../models/Document_model');\nconst Articles = require('../models/Articles_model');\nconst Discuss = require('../models/Discuss_model');\nconst Tags = require('../models/Tags_model');\nconst Slide = require('../models/Slide_model');\nconst Photos = require('../models/Photos_model');\nconst Collections = require('../models/Collections_model');\nconst emailRegexp = /^[a-z0-9]+([._\\\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;\nconst phoneRegexp = /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\\\d{8}$/;\nconst uoloader = multer(); //{dest: 'uploads/'}设置dest表示上传文件的目录，如果不设置上传的文件永远在内存之中不会保存到磁盘上。在此处为了在内存中取出文件并重命名所以不设置文件上传路径\nconst NowDate = new Date();\n\nlet responseData = {};\n\nrouter.use(function(req, res, next) {\n    responseData = {\n        code: 0,\n        msg: '',\n        ok:false,\n        data: null\n    };\n    next();\n});\n\nrouter.get('/gettest',(req,res,next)=>{\n    let captcha = new Geetest({\n        geetest_id: 'e46e906d776dbd41c4e72f72499ca39f',\n        geetest_key: '30b094aad22445378f7fdc01b83215bb'\n    }).register(null,(err,data)=>{\n        if (err) {\n            console.error(err);\n            return;\n        }\n        res.send(data);\n        // console.log(data);\n\n        // if (!data.success) {\n        //     // 进入 fallback，如果一直进入此模式，请检查服务器到极验服务器是否可访问\n        //     // 可以通过修改 hosts 把极验服务器 api.geetest.com 指到不可访问的地址\n        //     // 为以防万一，你可以选择以下两种方式之一：\n        //     // 1. 继续使用极验提供的failback备用方案\n        //     req.session.fallback = true;\n        //     res.send(data);\n        //     // 2. 使用自己提供的备用方案\n        //     // todo\n        // } else {\n        //     // 正常模式\n        //     req.session.fallback = false;\n        //     res.send(data);\n        // }\n    });\n});\n\n/**\n * 获取TOKEN\n */\nrouter.get('/gettoken',(req, res, next)=>{\n    responseData.code = 1;\n    responseData.msg = 'success';\n    responseData.ok = true;\n    if(req.cookies.get('token') && req.cookies.get('token') != ''){\n        responseData.data = {\n            token:req.cookies.get('token')\n        };\n    }else{\n        let token = crt_token();\n        responseData.data = {\n            token:crt_token\n        };\n    }\n    res.json(responseData);\n    return;\n})\n\n/**\n * 获取所有标签\n */\nrouter.get('/tags',(req, res, next)=>{\n    // console.log(Tags);\n    // res.send();\n    Tags.find().then(tags=>{\n        if(tags){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = tags;\n            res.json(responseData);\n            return;\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n            return;\n        }\n    });\n});\n\n/**\n * 获取幻灯片\n */\nrouter.get('/slides',(req, res, next)=>{\n    Slide.find().then(slides=>{\n        if(slides){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = slides;\n            res.json(responseData);\n            return;\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n            return;\n        }\n    });\n})\n\nrouter.get('/getUsers',(req, res, next)=>{\n    let uid = req.query.uid;\n    Users.findOne({_id:uid, isDel:0}).then(usersInfo=>{\n        if(usersInfo){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = usersInfo;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/allUsers',(req,res,next)=>{\n    let keyWord = req.query.keyword;\n    const reg = new RegExp(keyWord, 'si') //不区分大小写\n    Users.find({\n        // name:{$regex : /keyWord/,$options: 'si'}\n        $or : [ //多条件，数组\n            {name : {$regex : reg}}\n        ]\n    }).then(users=>{\n        if(users){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = users;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n})\n\nrouter.get('/getDocLists',(req, res, next)=>{\n    let uid = req.query.uid;\n    Docs.find({uid:uid,isDel:0}).then(docs=>{\n        if(docs){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = docs;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/allArticles',(req, res, next)=>{\n    let uid = '';\n    let all = false;\n    let offset = req.query.offset ? parseInt(req.query.offset) : 0;\n    let num = req.query.num ? parseInt(req.query.num) : 10;\n    if(req.cookies.get('token') && req.cookies.get('uid')){\n        uid = req.cookies.get('uid');\n    }else{\n        all = true;\n    }\n    let where = all ? {isDel:0}: {uid:uid,isDel:0};\n    Articles.find(where).skip((offset == 0 ? offset : (offset-1))).limit(num).then(alls=>{\n        if(alls){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = alls;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n})\n\nrouter.get('/getArticleLists',(req, res, next)=>{\n    let doc_id = req.query.doc_id;\n    Articles.find({\n        doc_id:doc_id,\n        isDel:0\n    }).then(articles=>{\n        // console.log(articles);\n        if(articles){\n            responseData.code = 1;\n            responseData.msg = 'success';\n            responseData.ok = true;\n            responseData.data = articles;\n            res.json(responseData);\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/getArticle',(req, res, next)=>{\n    let id = req.query.id;\n    Articles.findOne({_id:id}).then(article=>{\n        if(article){\n            if(!req.cookies.get(id)){\n                //增加阅读数\n                article.watch++;\n                article.save();\n                req.cookies.set(id,'on',{maxAge:1000*3600*10,expires:1000*3600*10});\n            }\n\n            Discuss.find({article_id:article._id}).then(discuss=>{\n                responseData.code = 1;\n                responseData.msg = 'success';\n                responseData.ok = true;\n                responseData.data = {\n                    'article' : article,\n                    'discuss' : discuss\n                };\n                res.json(responseData);\n            });\n\n        }else{\n            responseData.code = 0;\n            responseData.msg = 'error';\n            responseData.ok = false;\n            responseData.data = {};\n            res.json(responseData);\n        }\n    });\n})\n\nrouter.post('/signin', (req, res, next) => {\n    let name = req.body.name;\n    let password = req.body.password;\n    let form = req.body.form;\n    let validateCode = form == 'login' ? req.body.validateCode : '';\n    let remember = req.body.remember;\n    if (name == '') {\n        responseData.code = 0;\n        responseData.msg = '用户名不能为空';\n        res.json(responseData);\n        return;\n    }\n    if (password == '') {\n        responseData.code = 0;\n        responseData.msg = \"密码不能为空\";\n        res.json(responseData);\n        return;\n    }\n    if(form == 'login'){\n        if(validateCode == ''){\n            responseData.code = 0;\n            responseData.msg = \"请先通过验证\";\n            res.json(responseData);\n            return;\n        }\n    }\n    let user = {};\n    if(emailRegexp.test(name)){\n        user.email = name;\n    }else if(phoneRegexp.test(name)){\n        user.phone = name;\n    }else{\n        user.name = name;\n    }\n    Users.findOne(user).then(function(userInfo) {\n        if (userInfo) {\n            if(userInfo.password == md5(password+userInfo.salt)){\n                responseData.code = 1;\n                responseData.msg = \"success\";\n                responseData.ok = true;\n                responseData.data = userInfo;\n                req.cookies.set('uid',userInfo._id,{maxAge:1000*3600*10,expires:1000*3600*10});\n                req.cookies.set('token',crt_token(),{maxAge:1000*3600*10,expires:1000*3600*10});\n                res.json(responseData);\n                return;\n            }else{\n                responseData.code = 2;\n                responseData.msg = \"登录失败，密码不正确\";\n                responseData.ok = false;\n                responseData.data = null;\n                res.json(responseData);\n            }\n        } else {\n            responseData.code = 0;\n            responseData.msg = \"您还没有帐号，请注册帐号\";\n            responseData.data = '';\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.post('/signup',(req, res, next)=>{\n    let name = req.body.name;\n    let phone = req.body.phone;\n    let password = req.body.password;\n    let passwordConfirm = req.body.passwordConfirm;\n    let token = req.body.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    if (name == '') {\n        responseData.code = 0;\n        responseData.msg = '用户名不能为空';\n        res.json(responseData);\n        return;\n    }\n    if (password == '') {\n        responseData.code = 0;\n        responseData.msg = \"密码不能为空\";\n        res.json(responseData);\n        return;\n    }\n\n    if(password != passwordConfirm){\n        responseData.code = 0;\n        responseData.msg = \"两次输入密码不同\";\n        res.json(responseData);\n        return;\n    }\n\n    let findData = {};\n    if(emailRegexp.test(name)){\n        findData.email = name;\n    }else if(phoneRegexp.test(name)){\n        findData.phone = name;\n    }else{\n        findData.name = name;\n    }\n    Users.findOne(findData).then(userInfo=>{\n        if(userInfo){\n            responseData.code = 0;\n            responseData.ok = false;\n            responseData.msg = '帐号已存在，请注册新帐号';\n            responseData.data = null;\n            res.json(responseData);\n        }else{\n            let t_salt = salt();\n            let user = {\n                name:'',\n                phone : '',\n                email : '',\n                password:'',\n                salt : '',\n                sex: 3,\n                nick: '',\n                wechat: '',\n                qq: '',\n                avatar: '',\n                signature:'',\n                website: '',\n                introduce : '',\n                editors : 2,\n                add_date : sillyDateTime.format(new Date(),'YYYY-MMM-DD HH:mm:ss'),\n                isDel : 0,\n            };\n            if(emailRegexp.test(name)){\n                user.email = name;\n                user.type = 3;\n            }else if(phoneRegexp.test(name)){\n                user.phone = name;\n                user.type = 2;\n            }else{\n                user.name = name;\n                user.type = 1;\n            }\n            user.name = name;\n            user.salt = t_salt;\n            user.password = md5(password+t_salt);\n            let newUsers = new Users(user);\n            return newUsers.save();\n        }\n    }).then(inser => {\n        new Docs({\n            uid: inser._id,\n            name: '随笔',\n            photos: '',\n            describe: '',\n            add_date: new Date(),\n            isDel: 0,\n        }).save();\n        if(inser){\n            responseData.code = 1;\n            responseData.ok = true;\n            responseData.msg = '注册成功';\n            responseData.data = {id:inser._id};\n            res.json(responseData);\n        }else{\n            responseData.code = 2;\n            responseData.ok = true;\n            responseData.msg = '注册失败';\n            responseData.data = null;\n            res.json(responseData);\n        }\n    });\n});\n\nrouter.get('/signout',(req,res,next)=>{\n    req.cookies.set('token','');\n    req.cookies.set('uid','');\n    req.token = '';\n    req.userInfo = null;\n    res.redirect(302,'/login');\n});\n\nrouter.post('/updateUserBasic',(req,res,next)=>{\n    let token = req.body.token;\n    let uid = req.body.uid;\n    let updateUserBasic = {\n        nick: req.body.nick,\n        phone: req.body.phone,\n        email: req.body.email,\n        editors: req.body.editors,\n        avatar: req.body.avatar,\n        qq:req.body.qq,\n        wechat:req.body.wechat\n    };\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({_id:uid},updateUserBasic,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '用户基础信息修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeProfile',(req,res,next)=>{\n    let token = req.body.token;\n    let uid = req.body.uid;\n    let updateProfile = {\n        sex:req.body.sex,\n        introduce:req.body.introduce,\n        website:req.body.website\n    };\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({_id:uid},updateProfile,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '用户个人资料修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeReward',(req,res,next)=>{\n    let token = req.body.token;\n    let uid = req.body.uid;\n    let updateReward = {\n        rewardStatus:req.body.rewardStatus,\n        rewardDesc:req.body.rewardDesc\n    };\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Users.update({_id:uid},updateReward,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '赞赏修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/saveArticle',(req,res,next)=>{\n    let token = req.body.token;\n    let id = req.body.id;\n    let contents = req.body.contents;\n    let markDownText = req.body.markdownText ? req.body.markdownText:null;\n    let title = req.body.title;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    let article_date = {\n        contents:contents,\n        title:title\n    };\n    if(markDownText){\n        article_date.markDownText = markDownText;\n    }\n    Articles.update({_id:id},article_date,{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/downloadAllArticles',(req,res,next)=>{\n    responseData.code = 1;\n    responseData.ok = true;\n    responseData.msg = '所有文章打包下载完成';\n    responseData.data = {};\n    res.json(responseData);\n})\n\nrouter.post('/newDocument',(req,res,next)=>{\n    let uid = req.body.uid;\n    let name = req.body.name;\n    let docs = new Docs({\n        uid:uid,\n        name: name,\n        photos: '',\n        describe: '',\n        add_date: sillyDateTime.format(new Date(),'YYYY-MMM-DD HH:mm:ss'),\n        isDel: 0,\n    });\n    docs.save().then(insert=>{\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集创建成功';\n        responseData.data = {id:insert._id};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/updateDocumentName',(req,res,next)=>{\n    let uid = req.body.uid;\n    let id = req.body.id;\n    let token = req.body.token;\n    let name = req.body.name;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Docs.update({_id:id,uid:uid},{name:name},{multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集名称修改成功';\n        responseData.data = {};\n        res.json(responseData);\n    })\n})\n\nrouter.post('/newArticle',(req,res,next)=>{\n    let uid = req.body.uid;\n    let doc_id = req.body.doc_id;\n    let doc_name = req.body.doc_name;\n    let user_name = req.body.user_name;\n    let token = req.body.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    let article = new Articles({\n        uid: uid,\n        doc_id:doc_id,  // 文章所属文档id\n        doc_name:doc_name, // 文集名称\n        author: user_name, //文章作者\n        title: sillyDateTime.format(new Date(),'YYYY-MMM-DD'), // 文章标题\n        describe: '', // 文章描述\n        photos: '', // 文章图片\n        contents: '', // 文章内容\n        watch: 0,\n        start: 0,\n        fork: 0,\n        add_date: sillyDateTime.format(new Date(),'YYYY-MMM-DD HH:mm:ss'),\n        isRelease: 0,\n        isDel: 0,\n    });\n    article.save().then(insert =>{\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章创建成功';\n        responseData.data = {id:insert._id};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/deleteDoc',(req,res,next)=>{\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let token = req.query.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Docs.update({_id:id,uid:uid}, {isDel:1}, {multi:false}, (err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文集删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    })\n});\n\nrouter.get('/releaseArticle',(req,res,next)=> {\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let token = req.query.token;\n    if (token == '') {\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({_id: id, uid: uid}, {isRelease: 1}, {multi: false}, (err, docs) => {\n        if (err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章已发布';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/deleteArticle',(req,res,next)=>{\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let token = req.query.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({_id:id,uid:uid}, {isDel:1}, {multi:false}, (err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/changeAticleTitle',(req,res,next)=>{\n    let uid = req.body.uid;\n    let token = req.body.token;\n    let id = req.body.id;\n    let title = req.body.title;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Articles.update({_id:id,uid:uid}, {title:title}, {multi:false},(err,docs)=>{\n        if(err) throw console.log(err);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '文章删除成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.post('/postDiscuss',(req,res,next)=>{\n    let id = req.body.id;\n    let contents = req.body.contents;\n    let uid = req.body.uid;\n    let token = req.body.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    if(req.cookies.get('uid') == '' && req.cookies.get('token') == ''){\n        responseData.code = 0;\n        responseData.msg = '您尚未登录';\n        res.json(responseData);\n        return;\n    }\n    Articles.findOne({_id:id}).then(article=>{\n        let data = {\n            uid: uid,    //评论的用户id\n            article_id: article._id, //评论的文章id\n            article_uid: article.uid, //评论的文章的用户id\n            contents: contents,   //评论的内容\n            add_date: new Date(),     //评论时间\n            isDel: 0,\n        };\n        new Discuss(data).save();\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '评论成功';\n        responseData.data = {};\n        res.json(responseData);\n    });\n});\n\nrouter.get('/getDiscuss',(req,res,next)=>{\n    let id=req.query.id;\n    let token = req.query.token;\n    Discuss.find({article_id:id}).then(discuss=>{\n        if(!discuss) throw console.log(discuss);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = 'SUCCESS';\n        responseData.data = discuss;\n        res.json(responseData);\n    });\n})\n\nrouter.post('/uploader',uoloader.single('editormd-image-file'),(req,res,next)=>{\n    // console.log(req.file);\n    let ext = req.file.mimetype.split('/')[1];\n    let filename = sillyDateTime.format(new Date(),'YYYYMMMDDHHmmss')+'_'+crt_token()+'.'+ext;\n    let now_timer = sillyDateTime.format(new Date(),'YYYYMMMDD');\n    let dirname = '/Users/bluelife/www/node/blog/public/images/uploads/'+now_timer+'/';\n\n    fs.exists(dirname,exists=>{ //如果目录不存在创建目录\n        if(!exists){\n            fs.mkdir(dirname,err=>{\n                if(!err) throw console.log(err);\n            });\n        }\n        fs.writeFile(dirname+filename,req.file.buffer,err=>{\n            if(!err){\n                new Photos({\n                    originalname:req.file.originalname,\n                    filename: filename,\n                    path: dirname,\n                    fullpath: dirname+filename,\n                    encoding: req.file.encoding,\n                    mimetype: req.file.mimetype,\n                    size: req.file.size,\n                    add_date: new Date(),\n                    isDel: 0\n                }).save().then(insert=>{\n                    if(!insert) throw console.log(insert);\n                    res.json({\n                        message:'图片上传成功',\n                        url:'https://blog.mcloudhub.com/public/images/uploads/'+now_timer+'/'+filename,\n                        success:1\n                    });\n                });\n            }\n        });\n    });\n});\n\nrouter.post('/collection/new',(req,res,next)=>{\n    let uid = req.body.uid;\n    let token = req.body.token;\n    let icon = req.body.icon;\n    let name = req.body.name;\n    let describe = req.body.describe;\n    let push = req.body.push;\n    let admins = req.body.admins;\n    let verify = req.body.verify;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    let collections = new Collections({\n        uid: uid,\n        name: name,           // 集合名称\n        type: 1,           // 集合类型\n        icon: icon,           // 集合图标\n        describe: describe,       // 集合描述\n        add_date : new Date(),        // 集合添加时间,\n        admins: admins,         // 其他管理员\n        push: push,           // 是否允许投稿\n        follow:0,               //关注数\n        subscribe:[],\n        include:0,              //收录文章数\n        article_ids:[],\n        verify: verify,          // 是否需要审核\n        isDel : 0\n    });\n    collections.save().then(coll=>{\n        if(!coll) {\n            responseData.code = 0;\n            responseData.ok = false;\n            responseData.msg = '文集添加失败';\n            responseData.data = {};\n            res.json(responseData);\n        }else{\n            responseData.code = 1;\n            responseData.ok = true;\n            responseData.msg = '文集添加成功';\n            responseData.data = coll;\n            res.json(responseData);\n        }\n\n    });\n});\n\nrouter.get('/get_collections',(req,res,next)=>{\n    let uid = req.query.uid;\n    let token = req.query.token;\n    let offset = req.query.offset ? parseInt(req.query.offset) : 0;\n    let num = req.query.num ? parseInt(req.query.num) : 10;\n    let where = uid === void(0) ? {isDel:0,uid:uid} : {isDel:0};\n    Collections.find(where).skip((offset == 0 ? offset :(offset-1))*num).limit(num).then(colls=>{\n        if(!colls) throw console.log(colls);\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = 'SUCCESS';\n        responseData.data = colls;\n        res.json(responseData);\n    });\n});\n\nrouter.get('/getCollectionById',(req,res,next)=>{\n    let id = req.query.id;\n    let token = req.query.token;\n    Collections.findOne({_id:id}).then(coll=>{\n        if(!coll) throw console.log(coll);\n        let result = {};\n        var articlesArr = [];\n        if(coll.article_ids.length > 0){\n            coll.article_ids.forEach(ids=>{\n                Articles.findOne({_id:ids.id}).then(article=>{\n                    articlesArr.push(article);\n                });\n            })\n        }\n        result.articles = articlesArr;\n        result.icon = coll.icon;\n        result.follow = coll.follow;\n        result.describe = coll.describe;\n        result.include = coll.include;\n        result.name = coll.name;\n        result.push = coll.push;\n        result.subscribe = coll.subscribe;\n        result.admins = coll.admins;\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = 'SUCCESS';\n        responseData.data = result;\n        res.json(responseData);\n    });\n});\n\nrouter.get('/collectionFollow',(req,res,next)=>{\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let token = req.query.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Collections.findOne({_id:id}).then(coll=>{\n        coll.follow++;\n        coll.subscribe.push({uid:uid});\n        coll.save();\n        responseData.code = 1;\n        responseData.ok = true;\n        responseData.msg = '关注成功';\n        res.json(responseData);\n    });\n});\n\nrouter.get('/articlePush',(req,res,next)=>{\n    let uid = req.query.uid;\n    let id = req.query.id;\n    let article_id = req.query.article_id;\n    let token = req.query.token;\n    if(token == ''){\n        responseData.code = 0;\n        responseData.msg = '非法请求';\n        res.json(responseData);\n        return;\n    }\n    Collections.findOne({_id:id}).then(coll=>{\n        coll.include++;\n        if(coll.article_ids.length > 0){\n            coll.article_ids.forEach(ids=>{\n                if(ids.id == article_id){\n                    responseData.code = 0;\n                    responseData.ok = false;\n                    responseData.msg = '此文章已投稿，请另选一篇文章再投。';\n                    res.json(responseData);\n                }else{\n                    coll.article_ids.push({id:article_id});\n                    coll.save();\n                    responseData.code = 1;\n                    responseData.ok = true;\n                    responseData.msg = '投稿成功';\n                    res.json(responseData);\n                }\n                return;\n            })\n        }else{\n            coll.article_ids.push({id:article_id});\n            coll.save();\n            responseData.code = 1;\n            responseData.ok = true;\n            responseData.msg = '投稿成功';\n            res.json(responseData);\n            return;\n        }\n    });\n});\n\n\nrouter.get('/zhi',(req,res,next)=>{\n    res.json(req.query);\n});\n\nmodule.exports = router;"]}